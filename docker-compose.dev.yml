services:
  # Dev-only overrides (keep loopback wiring for local Docker workflows).
  # Usage: docker compose -f docker-compose.yml -f docker-compose.dev.yml up -d --build
  # Optional: override the admin-api bind port (default 3080).
  # Example: ADMIN_API_PORT=3082 docker compose -f docker-compose.yml -f docker-compose.dev.yml up -d --build
  admin-api:
    environment:
      DISCORD_REDIRECT_URI: http://localhost:${ADMIN_UI_PORT:-3001}/api/auth/discord/callback
      SESSION_COOKIE_DOMAIN: .localhost
      COOKIE_DOMAIN: .localhost
      CORS_ORIGIN: http://localhost:3000
      CLIENT_URL: http://localhost:3000

  web:
    build:
      args:
        NEXT_PUBLIC_ADMIN_API_BASE: http://localhost:${ADMIN_API_PORT:-3080}
    environment:
      NEXT_PUBLIC_ADMIN_API_BASE: http://localhost:${ADMIN_API_PORT:-3080}

  admin-ui:
    build:
      args:
        ALLOW_LOCALHOST_PUBLIC_ENV: "1"
        NEXT_PUBLIC_ADMIN_API_BASE: http://localhost:${ADMIN_API_PORT:-3080}
        NEXT_PUBLIC_ADMIN_API_PUBLIC_URL: http://localhost:${ADMIN_API_PORT:-3080}
    environment:
      NEXT_PUBLIC_ADMIN_API_BASE: http://localhost:${ADMIN_API_PORT:-3080}
      NEXT_PUBLIC_ADMIN_API_PUBLIC_URL: http://localhost:${ADMIN_API_PORT:-3080}
      ALLOW_LOCALHOST_OAUTH: "1"
