# NUC2 Pre-Flight Status Scan

Report: docs/reports/STATUS_2025-12-17_1549_nuc2.md

Safety: no secrets/tokens/cookies printed (presence-only env checks).

## 1) Identity + git

### date -u
Wed Dec 17 03:49:56 PM UTC 2025

### hostname
slimy-nuc2

### pwd
/opt/slimy/slimy-monorepo

### git rev-parse --abbrev-ref HEAD
nuc2/verify-role-b33e616

### git status -sb
## nuc2/verify-role-b33e616
 M .gitignore
 M apps/admin-api/.env.admin
 M apps/admin-api/.env.local
 M apps/admin-api/src/routes/discord.js
 M apps/admin-api/src/routes/guilds.js
 M apps/web/app/(marketing)/components/CTA.tsx
 M apps/web/app/(marketing)/components/ChatWidget.simple.bak
 M apps/web/app/(marketing)/components/Nav.tsx
 M apps/web/components/auth/login-button.tsx
 M docker-compose.yml
 M package.json
 M scripts/dev/migrate-admin-api-db.sh
 M scripts/smoke/docker-smoke.sh
?? apps/admin-api/tests/discord-guilds.test.js
?? apps/admin-api/tests/guild-connect.test.js
?? config/
?? docs/buglog/BUG_2025-12-14_guilds-filter-user-intersect-slimyai-bot.md
?? docs/buglog/BUG_2025-12-14_guilds-owned-visible_connect-shared-only.md
?? docs/buglog/BUG_2025-12-17_port-3080-collision-and-slimyai-bot-token.md
?? docs/reports/
?? scripts/env-check.ts
?? scripts/env-sync.ts

### git diff --name-only
.gitignore
apps/admin-api/.env.admin
apps/admin-api/.env.local
apps/admin-api/src/routes/discord.js
apps/admin-api/src/routes/guilds.js
apps/web/app/(marketing)/components/CTA.tsx
apps/web/app/(marketing)/components/ChatWidget.simple.bak
apps/web/app/(marketing)/components/Nav.tsx
apps/web/components/auth/login-button.tsx
docker-compose.yml
package.json
scripts/dev/migrate-admin-api-db.sh
scripts/smoke/docker-smoke.sh

## 2) Port 3080 collision guard (legacy containers)

### ss -ltnp | rg ':3080' || true
LISTEN 0      4096         0.0.0.0:3080       0.0.0.0:*                                                 
LISTEN 0      4096            [::]:3080          [::]:*                                                 

### docker ps --format 'table {{.Names}}\t{{.Ports}}' | rg '3080' || echo 'No running containers publishing 3080'
slimy-monorepo-admin-api-1   0.0.0.0:3080->3080/tcp, [::]:3080->3080/tcp

### docker ps -a --format 'table {{.Names}}\t{{.Status}}\t{{.Ports}}' | rg '3080|slimy-admin-api|admin-api' || true
slimy-admin-api              Created                    
slimy-monorepo-admin-api-1   Up 7 minutes (healthy)     0.0.0.0:3080->3080/tcp, [::]:3080->3080/tcp

### docker rm -f slimy-admin-api || true (only if it exists)
slimy-admin-api

## 3) Env presence-only (NO VALUES)

### pnpm env:check

> slimy-monorepo@ env:check /opt/slimy/slimy-monorepo
> tsx scripts/env-check.ts

env:check OK (3 required keys present; no values printed).

### DISCORD_BOT_TOKEN presence
DISCORD_BOT_TOKEN present

### SLIMYAI_BOT_TOKEN presence
SLIMYAI_BOT_TOKEN present

## 4) Baseline stack

### pnpm smoke:docker

> slimy-monorepo@ smoke:docker /opt/slimy/slimy-monorepo
> bash scripts/smoke/docker-smoke.sh


---
## Continuation (previous run timed out during smoke:docker)

## 4) Baseline stack (re-run)

### pnpm smoke:docker

> slimy-monorepo@ smoke:docker /opt/slimy/slimy-monorepo
> bash scripts/smoke/docker-smoke.sh

â€‰ELIFECYCLEâ€‰ Command failed with exit code 141.

---
## Continuation (tee-free capture to avoid SIGPIPE)

## 2b) Port 3080 re-check (post legacy cleanup)

### ss -ltnp | rg ':3080' || true
LISTEN 0      4096         0.0.0.0:3080       0.0.0.0:*                                                 
LISTEN 0      4096            [::]:3080          [::]:*                                                 

### docker ps --format 'table {{.Names}}\t{{.Ports}}' | rg '3080' || echo 'No running containers publishing 3080'
slimy-admin-api       0.0.0.0:3080->3080/tcp, [::]:3080->3080/tcp

### docker ps -a --format 'table {{.Names}}\t{{.Status}}\t{{.Ports}}' | rg '3080|slimy-admin-api|admin-api' || true
slimy-admin-api              Up 2 seconds (health: starting)   0.0.0.0:3080->3080/tcp, [::]:3080->3080/tcp
slimy-monorepo-admin-api-1   Exited (137) About a minute ago   

### docker rm -f slimy-admin-api || true (only if it exists)
slimy-admin-api

## 4) Baseline stack (re-run)

### pnpm smoke:docker

> slimy-monorepo@ smoke:docker /opt/slimy/slimy-monorepo
> bash scripts/smoke/docker-smoke.sh

 Container slimy-monorepo-admin-api-1  Stopping
 Container slimy-monorepo-admin-api-1  Stopped
 Container slimy-monorepo-admin-api-1  Removing
 Container slimy-monorepo-admin-api-1  Removed
 Container slimy-monorepo-db-1  Stopping
 Container slimy-monorepo-db-1  Stopped
 Container slimy-monorepo-db-1  Removing
 Container slimy-monorepo-db-1  Removed
 Network slimy-monorepo_slimy-network  Removing
 Network slimy-monorepo_slimy-network  Removed
Port 3000 in use by legacy container slimy-web; removing container
Bringing up baseline stack (db admin-api web admin-ui)...
#0 building with "default" instance using docker driver

#1 [admin-api internal] load build definition from Dockerfile
#1 transferring dockerfile: 3.35kB done
#1 DONE 0.0s

#2 [admin-api internal] load metadata for docker.io/library/node:20-alpine
#2 DONE 0.2s

#3 [admin-api internal] load .dockerignore
#3 transferring context: 2.44kB done
#3 DONE 0.0s

#4 [admin-api base 1/3] FROM docker.io/library/node:20-alpine@sha256:643e7036aa985317ebfee460005e322aa550c6b6883000d01daefb58689a58e2
#4 DONE 0.0s

#5 [admin-api internal] load build context
#5 transferring context: 618.60kB 0.1s done
#5 DONE 0.2s

#6 [admin-api deps 1/7] COPY pnpm-workspace.yaml ./
#6 CACHED

#7 [admin-api runner 13/14] COPY apps/admin-api/server.js ./apps/admin-api/server.js
#7 CACHED

#8 [admin-api runner 10/14] COPY --from=builder /app/apps/admin-api/node_modules/.prisma ./apps/admin-api/node_modules/.prisma
#8 CACHED

#9 [admin-api base 3/3] WORKDIR /app
#9 CACHED

#10 [admin-api deps 2/7] COPY pnpm-lock.yaml ./
#10 CACHED

#11 [admin-api runner  7/14] COPY --from=deps /app/packages ./packages
#11 CACHED

#12 [admin-api base 2/3] RUN npm install -g pnpm@latest
#12 CACHED

#13 [admin-api runner  5/14] COPY --from=deps /app/package.json ./
#13 CACHED

#14 [admin-api builder 1/2] COPY apps/admin-api/prisma/ ./apps/admin-api/prisma/
#14 CACHED

#15 [admin-api deps 6/7] COPY apps/admin-api/vendor/ ./apps/admin-api/vendor/
#15 CACHED

#16 [admin-api runner 11/14] COPY apps/admin-api/ ./apps/admin-api/
#16 CACHED

#17 [admin-api deps 3/7] COPY package.json ./
#17 CACHED

#18 [admin-api runner  6/14] COPY --from=deps /app/node_modules ./node_modules
#18 CACHED

#19 [admin-api runner  9/14] COPY --from=deps /app/apps/admin-api/vendor ./apps/admin-api/vendor
#19 CACHED

#20 [admin-api runner  8/14] COPY --from=deps /app/apps/admin-api/node_modules ./apps/admin-api/node_modules
#20 CACHED

#21 [admin-api deps 7/7] RUN pnpm install --frozen-lockfile --filter @slimy/admin-api...
#21 CACHED

#22 [admin-api deps 5/7] COPY apps/admin-api/package.json ./apps/admin-api/
#22 CACHED

#23 [admin-api runner  4/14] COPY --from=deps /app/pnpm-workspace.yaml ./
#23 CACHED

#24 [admin-api builder 2/2] RUN cd apps/admin-api && pnpm prisma:generate
#24 CACHED

#25 [admin-api runner 12/14] COPY apps/admin-api/src ./apps/admin-api/src
#25 CACHED

#26 [admin-api deps 4/7] COPY packages/ ./packages/
#26 CACHED

#27 [admin-api runner 14/14] WORKDIR /app/apps/admin-api
#27 CACHED

#28 [admin-api] exporting to image
#28 exporting layers done
#28 writing image sha256:3a34eabf69b7dc8575caecc71e81086a503ecdc8072bec8ca5e833b1ed60e0c5 done
#28 naming to docker.io/library/slimy-monorepo-admin-api done
#28 DONE 0.0s

#29 [web internal] load build definition from Dockerfile
#29 transferring dockerfile: 3.38kB done
#29 DONE 0.0s

#30 [admin-ui internal] load build definition from Dockerfile
#30 transferring dockerfile: 3.05kB done
#30 DONE 0.0s

#31 [admin-ui internal] load metadata for docker.io/library/node:22-slim
#31 DONE 0.1s

#32 [admin-ui internal] load .dockerignore
#32 transferring context: 2.44kB done
#32 DONE 0.0s

#33 [web internal] load .dockerignore
#33 transferring context: 2.44kB done
#33 DONE 0.1s

#34 [web base 1/3] FROM docker.io/library/node:22-slim@sha256:773413f36941ce1e4baf74b4a6110c03dcc4f968daffc389d4caef3f01412d2a
#34 DONE 0.0s

#35 [web internal] load build context
#35 ...

#36 [admin-ui internal] load build context
#36 transferring context: 49.52MB 0.7s done
#36 DONE 0.7s

#35 [web internal] load build context
#35 transferring context: 26.96MB 0.9s done
#35 DONE 0.9s

#37 [admin-ui deps 2/9] RUN corepack enable && corepack prepare pnpm@10.22.0 --activate
#37 CACHED

#38 [admin-ui deps 9/9] RUN pnpm install --frozen-lockfile --prod=false
#38 CACHED

#39 [admin-ui base 2/3] RUN apt-get update -y && apt-get install -y openssl
#39 CACHED

#40 [admin-ui deps 7/9] COPY apps/web/package.json ./apps/web/
#40 CACHED

#41 [admin-ui deps 3/9] COPY package.json pnpm-lock.yaml pnpm-workspace.yaml ./
#41 CACHED

#42 [admin-ui deps 1/9] WORKDIR /app
#42 CACHED

#43 [admin-ui base 3/3] RUN corepack enable && corepack prepare pnpm@10.22.0 --activate
#43 CACHED

#44 [admin-ui deps 8/9] COPY apps/bot/package.json ./apps/bot/
#44 CACHED

#45 [admin-ui deps 6/9] COPY apps/admin-api/vendor ./apps/admin-api/vendor
#45 CACHED

#46 [admin-ui deps 4/9] COPY apps/admin-ui/package.json ./apps/admin-ui/
#46 CACHED

#47 [admin-ui deps 5/9] COPY apps/admin-api/package.json ./apps/admin-api/
#47 CACHED

#48 [admin-ui builder 3/8] COPY --from=deps /app/node_modules ./node_modules
#48 CACHED

#49 [web deps  7/10] COPY apps/admin-api/vendor ./apps/admin-api/vendor
#49 CACHED

#50 [web deps 10/10] RUN pnpm install --frozen-lockfile --prod=false
#50 CACHED

#43 [web base 3/3] RUN corepack enable && corepack prepare pnpm@10.22.0 --activate
#43 CACHED

#51 [web deps  4/10] COPY apps/web/package.json ./apps/web/
#51 CACHED

#52 [web deps  8/10] COPY apps/admin-ui/package.json ./apps/admin-ui/
#52 CACHED

#53 [web builder  5/11] COPY packages ./packages
#53 CACHED

#42 [web deps 1/9] WORKDIR /app
#42 CACHED

#54 [web builder  4/11] COPY apps/web ./apps/web
#54 CACHED

#55 [web deps  6/10] COPY apps/admin-api/package.json ./apps/admin-api/
#55 CACHED

#37 [web deps 2/9] RUN corepack enable && corepack prepare pnpm@10.22.0 --activate
#37 CACHED

#56 [web deps  5/10] COPY apps/web/prisma ./apps/web/prisma
#56 CACHED

#57 [web deps  9/10] COPY apps/bot/package.json ./apps/bot/
#57 CACHED

#58 [web deps  3/10] COPY package.json pnpm-lock.yaml pnpm-workspace.yaml ./
#58 CACHED

#59 [web builder  3/11] COPY --from=deps /app/node_modules ./node_modules
#59 CACHED

#39 [web base 2/3] RUN apt-get update -y && apt-get install -y openssl
#39 CACHED

#60 [web builder  6/11] COPY package.json pnpm-lock.yaml pnpm-workspace.yaml ./
#60 CACHED

#61 [web builder  7/11] RUN pnpm install --frozen-lockfile --prefer-offline 2>&1 | tail -20 || true
#61 ...

#62 [admin-ui builder 4/8] COPY apps/admin-ui ./apps/admin-ui
#62 DONE 0.6s

#63 [admin-ui builder 5/8] COPY packages ./packages
#63 DONE 0.1s

#64 [admin-ui builder 6/8] COPY package.json pnpm-lock.yaml pnpm-workspace.yaml ./
#64 DONE 0.1s

#61 [web builder  7/11] RUN pnpm install --frozen-lockfile --prefer-offline 2>&1 | tail -20 || true
#61 ...

#65 [admin-ui builder 7/8] RUN pnpm install --frozen-lockfile --prefer-offline 2>&1 | tail -20 || true
#65 3.854 Scope: all 7 workspace projects
#65 3.854 Lockfile is up to date, resolution step is skipped
#65 3.854 Already up to date
#65 3.854 
#65 3.854 â•­ Warning â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•®
#65 3.854 â”‚                                                                              â”‚
#65 3.854 â”‚   Ignored build scripts: msgpackr-extract.                                   â”‚
#65 3.854 â”‚   Run "pnpm approve-builds" to pick which dependencies should be allowed     â”‚
#65 3.854 â”‚   to run scripts.                                                            â”‚
#65 3.854 â”‚                                                                              â”‚
#65 3.854 â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯
#65 3.854 
#65 3.854 . prepare$ husky
#65 3.854 . prepare: .git can't be found
#65 3.854 . prepare: Done
#65 3.854 Done in 3.4s using pnpm v10.22.0
#65 DONE 4.0s

#61 [web builder  7/11] RUN pnpm install --frozen-lockfile --prefer-offline 2>&1 | tail -20 || true
#61 4.901 Scope: all 7 workspace projects
#61 4.901 Lockfile is up to date, resolution step is skipped
#61 4.901 Already up to date
#61 4.901 
#61 4.901 â•­ Warning â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•®
#61 4.901 â”‚                                                                              â”‚
#61 4.901 â”‚   Ignored build scripts: msgpackr-extract.                                   â”‚
#61 4.901 â”‚   Run "pnpm approve-builds" to pick which dependencies should be allowed     â”‚
#61 4.901 â”‚   to run scripts.                                                            â”‚
#61 4.901 â”‚                                                                              â”‚
#61 4.901 â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯
#61 4.901 
#61 4.901 . prepare$ husky
#61 4.901 . prepare: .git can't be found
#61 4.901 . prepare: Done
#61 4.901 Done in 4.5s using pnpm v10.22.0
#61 DONE 4.9s

#66 [web builder  8/11] RUN pnpm --filter @slimy/web run db:generate
#66 0.787 
#66 0.787 > @slimy/web@0.1.0 db:generate /app/apps/web
#66 0.787 > prisma generate
#66 0.787 
#66 2.140 Environment variables loaded from .env
#66 2.143 Prisma schema loaded from prisma/schema.prisma
#66 4.048 
#66 4.048 âœ” Generated Prisma Client (v6.19.0) to ./../../node_modules/.pnpm/@prisma+client@6.19.0_prisma@6.19.0_typescript@5.9.3__typescript@5.9.3/node_modules/@prisma/client in 335ms
#66 4.048 
#66 4.048 Start by importing your Prisma Client (See: https://pris.ly/d/importing-client)
#66 4.048 
#66 4.048 Tip: Interested in query caching in just a few lines of code? Try Accelerate today! https://pris.ly/tip-3-accelerate
#66 4.048 
#66 DONE 4.1s

#67 [web builder  9/11] COPY apps/web/tailwind.config.ts ./apps/web/
#67 DONE 0.1s

#68 [admin-ui builder 8/8] RUN pnpm --filter @slimy/admin-ui build
#68 0.796 
#68 0.796 > @slimy/admin-ui@ build /app/apps/admin-ui
#68 0.796 > next build
#68 0.796 
#68 1.639 Attention: Next.js now collects completely anonymous telemetry regarding usage.
#68 1.639 This information is used to shape Next.js' roadmap and prioritize features.
#68 1.639 You can learn more, including how to opt-out if you'd not like to participate in this anonymous program, by visiting the following URL:
#68 1.640 https://nextjs.org/telemetry
#68 1.640 
#68 1.753   â–² Next.js 14.2.5
#68 1.753   - Environments: .env.local
#68 1.753 
#68 1.754    Linting and checking validity of types ...
#68 ...

#69 [web builder 10/11] COPY apps/web/postcss.config.mjs ./apps/web/
#69 DONE 0.1s

#70 [web builder 11/11] RUN pnpm --filter @slimy/web build
#70 0.900 
#70 0.900 > @slimy/web@0.1.0 build /app/apps/web
#70 0.900 > next build
#70 0.900 
#70 1.335 [baseline-browser-mapping] The data in this module is over two months old.  To ensure accurate Baseline data, please update: `npm i baseline-browser-mapping@latest -D`
#70 1.870  âš  `eslint` configuration in next.config.js is no longer supported. See more info here: https://nextjs.org/docs/app/api-reference/cli/next#next-lint-options
#70 1.878  âš  Invalid next.config.js options detected: 
#70 1.878  âš      Unrecognized key(s) in object: 'eslint'
#70 1.879  âš  See more info here: https://nextjs.org/docs/messages/invalid-next-config
#70 3.255 Attention: Next.js now collects completely anonymous telemetry regarding usage.
#70 3.255 This information is used to shape Next.js' roadmap and prioritize features.
#70 3.255 You can learn more, including how to opt-out if you'd not like to participate in this anonymous program, by visiting the following URL:
#70 3.255 https://nextjs.org/telemetry
#70 3.255 
#70 3.279    â–² Next.js 16.0.1 (Turbopack)
#70 3.279    - Environments: .env.local, .env
#70 3.280 
#70 3.346  âš  The "middleware" file convention is deprecated. Please use "proxy" instead. Learn more: https://nextjs.org/docs/messages/middleware-to-proxy
#70 3.436    Creating an optimized production build ...
#70 3.749 [baseline-browser-mapping] The data in this module is over two months old.  To ensure accurate Baseline data, please update: `npm i baseline-browser-mapping@latest -D`
#70 ...

#68 [admin-ui builder 8/8] RUN pnpm --filter @slimy/admin-ui build
#68 5.586    Creating an optimized production build ...
#68 28.55  âœ“ Compiled successfully
#68 28.55    Collecting page data ...
#68 30.10    Generating static pages (0/20) ...
#68 30.44    Generating static pages (5/20) 
#68 30.73    Generating static pages (10/20) 
#68 30.80    Generating static pages (15/20) 
#68 30.84  âœ“ Generating static pages (20/20)
#68 ...

#70 [web builder 11/11] RUN pnpm --filter @slimy/web build
#70 26.94 Turbopack build encountered 1 warnings:
#70 26.94 [externals]/@prisma/client
#70 26.94 unexpected export *
#70 26.94 export * used with module [externals]/@prisma/client [external] (@prisma/client, cjs) which is a CommonJS module with exports only available at runtime
#70 26.94 List all export names manually (`export { a, b, c } from "...") or rewrite the module to ESM, to avoid the additional runtime code.`
#70 26.94 
#70 26.94 Import trace:
#70 26.94   external:
#70 26.94     [externals]/@prisma/client [external]
#70 26.94     ./apps/web/lib/repositories/club-analytics.repository.ts [App Route]
#70 26.94     ./apps/web/app/api/club/analyze/route.ts [App Route]
#70 26.94 
#70 26.94 
#70 26.96  âœ“ Compiled successfully in 22.9s
#70 26.99    Skipping validation of types
#70 27.32    Collecting page data ...
#70 28.16 [baseline-browser-mapping] The data in this module is over two months old.  To ensure accurate Baseline data, please update: `npm i baseline-browser-mapping@latest -D`
#70 28.17 [baseline-browser-mapping] The data in this module is over two months old.  To ensure accurate Baseline data, please update: `npm i baseline-browser-mapping@latest -D`
#70 28.18 [baseline-browser-mapping] The data in this module is over two months old.  To ensure accurate Baseline data, please update: `npm i baseline-browser-mapping@latest -D`
#70 28.91  âš  Using edge runtime on a page currently disables static generation for that page
#70 29.58    Generating static pages (0/45) ...
#70 29.90 [baseline-browser-mapping] The data in this module is over two months old.  To ensure accurate Baseline data, please update: `npm i baseline-browser-mapping@latest -D`
#70 29.90 [baseline-browser-mapping] The data in this module is over two months old.  To ensure accurate Baseline data, please update: `npm i baseline-browser-mapping@latest -D`
#70 30.72    Generating static pages (11/45) 
#70 30.80    Generating static pages (22/45) 
#70 31.08 [AdminApiClient] admin-api unavailable (ECONNREFUSED 127.0.0.1:3080)
#70 31.28 Failed to load doc: undefined Error: ENOENT: no such file or directory, open '/app/apps/web/content/docs/undefined.mdx'
#70 31.28     at p (.next/server/chunks/ssr/[root-of-the-server]__da54a6b7._.js:1:53953)
#70 31.28     at stringify (<anonymous>) {
#70 31.28   errno: -2,
#70 31.28   code: 'ENOENT',
#70 31.28   syscall: 'open',
#70 31.28   path: '/app/apps/web/content/docs/undefined.mdx'
#70 31.28 }
#70 31.31 Failed to load doc: undefined Error: ENOENT: no such file or directory, open '/app/apps/web/content/docs/undefined.mdx'
#70 31.31     at p (.next/server/chunks/ssr/[root-of-the-server]__da54a6b7._.js:1:53953)
#70 31.31     at stringify (<anonymous>) {
#70 31.31   errno: -2,
#70 31.31   code: 'ENOENT',
#70 31.31   syscall: 'open',
#70 31.31   path: '/app/apps/web/content/docs/undefined.mdx'
#70 31.31 }
#70 31.32 Failed to load doc: undefined Error: ENOENT: no such file or directory, open '/app/apps/web/content/docs/undefined.mdx'
#70 31.32     at p (.next/server/chunks/ssr/[root-of-the-server]__da54a6b7._.js:1:53953)
#70 31.32     at stringify (<anonymous>) {
#70 31.32   errno: -2,
#70 31.32   code: 'ENOENT',
#70 31.32   syscall: 'open',
#70 31.32   path: '/app/apps/web/content/docs/undefined.mdx'
#70 31.32 }
#70 31.47    Generating static pages (33/45) 
#70 38.09  âœ“ Generating static pages (45/45) in 8.5s
#70 38.12    Finalizing page optimization ...
#70 39.47 
#70 39.47 Route (app)                            Revalidate  Expire
#70 39.47 â”Œ â—‹ /
#70 39.47 â”œ â—‹ /_not-found
#70 39.47 â”œ â—‹ /admin/flags
#70 39.47 â”œ â—‹ /analytics
#70 39.47 â”œ Æ’ /api/auth/discord.bak/callback
#70 39.47 â”œ Æ’ /api/auth/discord.bak/login
#70 39.47 â”œ Æ’ /api/auth/logout
#70 39.47 â”œ Æ’ /api/auth/me
#70 39.47 â”œ Æ’ /api/chat/bot
#70 39.47 â”œ Æ’ /api/chat/conversations
#70 39.47 â”œ Æ’ /api/chat/message
#70 39.47 â”œ Æ’ /api/chat/messages
#70 39.47 â”œ Æ’ /api/chat/users
#70 39.47 â”œ Æ’ /api/club/analyze
#70 39.47 â”œ Æ’ /api/club/export
#70 39.47 â”œ Æ’ /api/club/latest
#70 39.47 â”œ Æ’ /api/club/rescan
#70 39.47 â”œ Æ’ /api/club/sheet
#70 39.47 â”œ Æ’ /api/club/upload
#70 39.47 â”œ Æ’ /api/codes
#70 39.47 â”œ Æ’ /api/codes/health
#70 39.47 â”œ Æ’ /api/codes/report
#70 39.47 â”œ Æ’ /api/diag
#70 39.47 â”œ Æ’ /api/discord/guilds
#70 39.47 â”œ Æ’ /api/guilds/[id]
#70 39.47 â”œ Æ’ /api/guilds/[id]/flags
#70 39.47 â”œ Æ’ /api/guilds/[id]/members
#70 39.47 â”œ Æ’ /api/guilds/[id]/members/[userId]
#70 39.47 â”œ Æ’ /api/guilds/[id]/members/bulk
#70 39.47 â”œ Æ’ /api/guilds/[id]/settings
#70 39.47 â”œ â—‹ /api/health                                1m      1y
#70 39.47 â”œ Æ’ /api/local-codes
#70 39.47 â”œ Æ’ /api/og/stats
#70 39.47 â”œ Æ’ /api/screenshot
#70 39.47 â”œ â—‹ /api/snail/history                         1m      1y
#70 39.47 â”œ Æ’ /api/stats
#70 39.47 â”œ Æ’ /api/stats/events/stream
#70 39.47 â”œ â—‹ /api/usage                                30s      1y
#70 39.47 â”œ Æ’ /api/user/preferences
#70 39.47 â”œ Æ’ /api/web-vitals
#70 39.47 â”œ Æ’ /auth/discord/callback
#70 39.47 â”œ â—‹ /chat
#70 39.47 â”œ â—‹ /club
#70 39.47 â”œ â—‹ /dashboard
#70 39.47 â”œ â—‹ /docs
#70 39.47 â”œ â— /docs/[slug]
#70 39.47 â”‚ â”œ /docs/getting-started
#70 39.47 â”‚ â”œ /docs/snail-tools
#70 39.47 â”‚ â”” /docs/club-analytics
#70 39.47 â”œ â—‹ /features
#70 39.47 â”œ â—‹ /guilds
#70 39.47 â”œ Æ’ /public-stats/[guildId]
#70 39.47 â”œ â—‹ /settings
#70 39.47 â”œ â—‹ /snail
#70 39.47 â”œ â—‹ /snail/codes
#70 39.47 â”œ â—‹ /status
#70 39.47 â”” â—‹ /usage
#70 39.47 
#70 39.47 
#70 39.47 Æ’ Proxy (Middleware)
#70 39.47 
#70 39.47 â—‹  (Static)   prerendered as static content
#70 39.47 â—  (SSG)      prerendered as static HTML (uses generateStaticParams)
#70 39.47 Æ’  (Dynamic)  server-rendered on demand
#70 39.47 
#70 39.50 
#70 39.50 > @slimy/web@0.1.0 postbuild /app/apps/web
#70 39.50 > tsx scripts/postbuild-validate.ts && tsx scripts/check-bundle-size.ts
#70 39.50 
#70 ...

#68 [admin-ui builder 8/8] RUN pnpm --filter @slimy/admin-ui build
#68 34.00    Finalizing page optimization ...
#68 34.00    Collecting build traces ...
#68 ...

#70 [web builder 11/11] RUN pnpm --filter @slimy/web build
#70 40.17 
#70 40.17 ðŸ“‹ Post-build validation:
#70 40.17 âœ… All checks passed
#70 40.86 ðŸ“¦ Analyzing bundle sizes...
#70 40.86 
#70 40.86 Configuration:
#70 40.87   Max initial bundle: 1000KB
#70 40.87   Max route chunk: 500KB
#70 40.87   Max total bundle: 3000KB
#70 40.87   Warn threshold: 80%
#70 40.87 
#70 40.87 ðŸ“Š Bundle Size Summary:
#70 40.87   Initial bundle: 0KB
#70 40.87   Total bundles: 0
#70 40.87   Largest chunk: 0KB
#70 40.87 
#70 40.87 âœ… Bundle size checks passed!
#70 40.87 
#70 DONE 41.0s

#68 [admin-ui builder 8/8] RUN pnpm --filter @slimy/admin-ui build
#68 ...

#71 [web runner  2/10] WORKDIR /app
#71 CACHED

#72 [web runner  3/11] RUN apt-get update -y && apt-get install -y openssl ca-certificates && rm -rf /var/lib/apt/lists/*
#72 CACHED

#73 [web runner  5/11] RUN adduser --system --uid 1001 nextjs
#73 CACHED

#74 [web runner  4/11] RUN addgroup --system --gid 1001 nodejs
#74 CACHED

#75 [web runner  6/11] COPY --from=builder --chown=nextjs:nodejs /app/apps/web/public ./apps/web/public
#75 CACHED

#76 [web runner  7/11] COPY --from=builder --chown=nextjs:nodejs /app/apps/web/.next/standalone/apps/web ./apps/web/
#76 DONE 0.2s

#68 [admin-ui builder 8/8] RUN pnpm --filter @slimy/admin-ui build
#68 ...

#77 [web runner  8/11] COPY --from=builder --chown=nextjs:nodejs /app/apps/web/.next/standalone/node_modules ./node_modules
#77 DONE 6.0s

#68 [admin-ui builder 8/8] RUN pnpm --filter @slimy/admin-ui build
#68 ...

#78 [web runner  9/11] COPY --from=builder --chown=nextjs:nodejs /app/apps/web/.next/static ./apps/web/.next/static
#78 DONE 0.2s

#68 [admin-ui builder 8/8] RUN pnpm --filter @slimy/admin-ui build
#68 ...

#79 [web runner 10/11] COPY --from=builder --chown=nextjs:nodejs /app/apps/web/.next/static ./.next/static
#79 DONE 0.2s

#68 [admin-ui builder 8/8] RUN pnpm --filter @slimy/admin-ui build
#68 ...

#80 [web runner 11/11] COPY --from=builder --chown=nextjs:nodejs /app/apps/web/public ./public
#80 DONE 0.4s

#68 [admin-ui builder 8/8] RUN pnpm --filter @slimy/admin-ui build
#68 ...

#81 [web] exporting to image
#81 exporting layers
#81 exporting layers 1.5s done
#81 writing image sha256:718e7b5dc1e3bff14a46de4528c89332d4d5ec7ada560d690e7df07528b9a8e7 done
#81 naming to docker.io/library/slimy-monorepo-web done
#81 DONE 1.6s

#68 [admin-ui builder 8/8] RUN pnpm --filter @slimy/admin-ui build
#68 57.50 
#68 57.52 Route (pages)                             Size     First Load JS
#68 57.52 â”Œ â—‹ /                                     4.49 kB         114 kB
#68 57.52 â”œ   /_app                                 0 B            83.5 kB
#68 57.52 â”œ â—‹ /404                                  181 B          83.7 kB
#68 57.52 â”œ â—‹ /admin-api-usage                      873 B           110 kB
#68 57.52 â”œ Æ’ /api/admin-api/[...path]              0 B            83.5 kB
#68 57.52 â”œ Æ’ /api/admin-api/diag                   0 B            83.5 kB
#68 57.52 â”œ Æ’ /api/admin-api/health                 0 B            83.5 kB
#68 57.52 â”œ Æ’ /api/diagnostics                      0 B            83.5 kB
#68 57.52 â”œ â—‹ /auth-me                              1.09 kB         110 kB
#68 57.52 â”œ â—‹ /chat                                 2.5 kB          112 kB
#68 57.52 â”œ â—‹ /club                                 1.58 kB         111 kB
#68 57.52 â”œ Æ’ /dashboard                            1.65 kB         111 kB
#68 57.52 â”œ â—‹ /email-login                          557 B           110 kB
#68 57.52 â”œ â—‹ /guilds                               1.86 kB         111 kB
#68 57.52 â”œ â—‹ /guilds/[guildId]                     5.88 kB         115 kB
#68 57.52 â”œ â—‹ /guilds/[guildId]/channels            1.71 kB         111 kB
#68 57.52 â”œ â—‹ /guilds/[guildId]/corrections         1.74 kB         111 kB
#68 57.52 â”œ â—‹ /guilds/[guildId]/personality         888 B           110 kB
#68 57.52 â”œ â—‹ /guilds/[guildId]/rescan              1.23 kB         110 kB
#68 57.52 â”œ â—‹ /guilds/[guildId]/settings            1.25 kB         110 kB
#68 57.52 â”œ â—‹ /guilds/[guildId]/usage               67.5 kB         177 kB
#68 57.52 â”œ â—‹ /login                                489 B            84 kB
#68 57.52 â”œ â—‹ /snail                                1 kB            110 kB
#68 57.52 â”œ â—‹ /snail/[guildId]                      4.25 kB         113 kB
#68 57.52 â”” â—‹ /status                               1.27 kB         110 kB
#68 57.52 + First Load JS shared by all             86.7 kB
#68 57.52   â”œ chunks/framework-8051a8b17472378c.js  45.2 kB
#68 57.52   â”œ chunks/main-386d6319e61b79bf.js       36.6 kB
#68 57.52   â”” other shared chunks (total)           4.81 kB
#68 57.52 
#68 57.52 â—‹  (Static)   prerendered as static content
#68 57.52 Æ’  (Dynamic)  server-rendered on demand
#68 57.52 
#68 DONE 57.8s

#71 [admin-ui runner  2/10] WORKDIR /app
#71 CACHED

#82 [admin-ui runner  4/10] RUN adduser --system --uid 1001 nextjs
#82 CACHED

#83 [admin-ui runner  3/10] RUN addgroup --system --gid 1001 nodejs
#83 CACHED

#84 [admin-ui runner  5/10] COPY --from=builder --chown=nextjs:nodejs /app/apps/admin-ui/public ./apps/admin-ui/public
#84 CACHED

#85 [admin-ui runner  6/10] COPY --from=builder --chown=nextjs:nodejs /app/apps/admin-ui/.next/standalone/apps/admin-ui ./apps/admin-ui/
#85 DONE 0.2s

#86 [admin-ui runner  7/10] COPY --from=builder --chown=nextjs:nodejs /app/apps/admin-ui/.next/standalone/node_modules ./node_modules
#86 DONE 1.8s

#87 [admin-ui runner  8/10] COPY --from=builder --chown=nextjs:nodejs /app/apps/admin-ui/.next/static ./apps/admin-ui/.next/static
#87 DONE 0.2s

#88 [admin-ui runner  9/10] COPY --from=builder --chown=nextjs:nodejs /app/apps/admin-ui/.next/static ./.next/static
#88 DONE 0.1s

#89 [admin-ui runner 10/10] COPY --from=builder --chown=nextjs:nodejs /app/apps/admin-ui/public ./public
#89 DONE 0.6s

#90 [admin-ui] exporting to image
#90 exporting layers
#90 exporting layers 1.3s done
#90 writing image sha256:55ee6c26e06896e712e0c5dee564cc6f508d66e02ff0cb48fe44f8996767b376
#90 writing image sha256:55ee6c26e06896e712e0c5dee564cc6f508d66e02ff0cb48fe44f8996767b376 0.1s done
#90 naming to docker.io/library/slimy-monorepo-admin-ui 0.0s done
#90 DONE 1.5s
 Network slimy-monorepo_slimy-network  Creating
 Network slimy-monorepo_slimy-network  Created
 Container slimy-monorepo-db-1  Creating
 Container slimy-monorepo-db-1  Created
 Container slimy-monorepo-admin-api-1  Creating
 Container slimy-monorepo-admin-api-1  Created
 Container slimy-monorepo-admin-ui-1  Creating
 Container slimy-monorepo-web-1  Creating
 Container slimy-monorepo-admin-ui-1  Created
 Container slimy-monorepo-web-1  Created
 Container slimy-monorepo-db-1  Starting
 Container slimy-monorepo-db-1  Started
 Container slimy-monorepo-db-1  Waiting
 Container slimy-monorepo-db-1  Healthy
 Container slimy-monorepo-admin-api-1  Starting
 Container slimy-monorepo-admin-api-1  Started
 Container slimy-monorepo-db-1  Waiting
 Container slimy-monorepo-admin-api-1  Waiting
 Container slimy-monorepo-admin-api-1  Waiting
 Container slimy-monorepo-db-1  Healthy
 Container slimy-monorepo-admin-api-1  Healthy
 Container slimy-monorepo-web-1  Starting
 Container slimy-monorepo-admin-api-1  Healthy
 Container slimy-monorepo-admin-ui-1  Starting
 Container slimy-monorepo-admin-ui-1  Started
 Container slimy-monorepo-web-1  Started
Waiting for endpoints...
OK: admin-api /api/health
OK: web /
OK: admin-ui /

Applying admin-api database migrations...
Applying admin-api Prisma migrations (docker)...
 Container slimy-monorepo-db-1  Running
 Container slimy-monorepo-admin-api-1  Running
 Container slimy-monorepo-db-1  Waiting
 Container slimy-monorepo-db-1  Healthy
Environment variables loaded from .env
Prisma schema loaded from prisma/schema.prisma
Datasource "db": MySQL database "slimyai" at "db:3306"

4 migrations found in prisma/migrations


No pending migrations to apply.
OK: admin-api Prisma migrations applied

Checking admin-ui /dashboard routing...
OK: admin-ui /dashboard (HTTP 307)

Checking admin-ui /dashboard with synthetic auth cookie...
OK: admin-ui /dashboard with synthetic auth (HTTP 200)

Checking admin-ui Socket.IO proxy with synthetic auth cookie...
OK: admin-ui Socket.IO polling handshake (HTTP 200)
OK: admin-ui -> admin-api bridge /api/admin-api/health
OK: admin-ui -> admin-api bridge /api/admin-api/diag
OK: admin-ui catch-all /api/admin-api/api/health
OK: admin-ui catch-all /api/admin-api/api/diag

Checking admin-ui catch-all real endpoint...
OK: admin-ui catch-all /api/admin-api/api/usage (HTTP 200)

Checking admin-ui catch-all protected endpoint...
OK: admin-ui catch-all /api/admin-api/api/auth/me (HTTP 401)

=== admin-ui -> admin-api bridge responses ===
--- /api/admin-api/health ---
{
  "ok": true,
  "upstream": {
    "status": "ok",
    "uptime": 9,
    "timestamp": "2025-12-17T15:53:25.946Z",
    "version": "1.0.0"
  },
  "ts": "2025-12-17T15:53:25.948Z"
}
--- /api/admin-api/diag ---
{
  "ok": true,
  "upstream": {
    "ok": true,
    "authenticated": false
  },
  "ts": "2025-12-17T15:53:25.961Z"
}
--- /api/admin-api/api/usage ---
{
  "ok": true,
  "data": {
    "level": "pro",
    "currentSpend": 950,
    "limit": 1000,
    "modelProbeStatus": "soft_cap"
  }
}
--- /api/admin-api/api/auth/me ---
{
  "error": "unauthorized"
}

PASS: Docker baseline smoke test

(exit code: 0)

### docker compose ps
NAME                         IMAGE                      COMMAND                  SERVICE     CREATED          STATUS                    PORTS
slimy-monorepo-admin-api-1   slimy-monorepo-admin-api   "docker-entrypoint.sâ€¦"   admin-api   24 seconds ago   Up 12 seconds (healthy)   0.0.0.0:3080->3080/tcp, :::3080->3080/tcp
slimy-monorepo-admin-ui-1    slimy-monorepo-admin-ui    "docker-entrypoint.sâ€¦"   admin-ui    24 seconds ago   Up 6 seconds              0.0.0.0:3001->3000/tcp, :::3001->3000/tcp
slimy-monorepo-db-1          mysql:8.0                  "docker-entrypoint.sâ€¦"   db          24 seconds ago   Up 23 seconds (healthy)   3306/tcp, 33060/tcp
slimy-monorepo-web-1         slimy-monorepo-web         "docker-entrypoint.sâ€¦"   web         24 seconds ago   Up 6 seconds              0.0.0.0:3000->3000/tcp, :::3000->3000/tcp

### curl -sS -i http://localhost:3080/api/health | sed -n '1,15p' (Set-Cookie redacted)
HTTP/1.1 200 OK
Content-Security-Policy: default-src 'self';base-uri 'self';font-src 'self' https: data:;form-action 'self';frame-ancestors 'self';img-src 'self' data:;object-src 'none';script-src 'self';script-src-attr 'none';style-src 'self' https: 'unsafe-inline';upgrade-insecure-requests
Cross-Origin-Opener-Policy: same-origin
Cross-Origin-Resource-Policy: same-origin
Origin-Agent-Cluster: ?1
Referrer-Policy: no-referrer
Strict-Transport-Security: max-age=31536000; includeSubDomains
X-Content-Type-Options: nosniff
X-DNS-Prefetch-Control: off
X-Download-Options: noopen
X-Frame-Options: SAMEORIGIN
X-Permitted-Cross-Domain-Policies: none
X-XSS-Protection: 0
X-Request-ID: 4da6b7d8-00dc-4013-9e88-26c768668967
Access-Control-Allow-Origin: http://localhost:3000

## 5) Quick tests (fast, no secrets)

### pnpm --filter @slimy/admin-api test || true

> @slimy/admin-api@1.0.0 test /opt/slimy/slimy-monorepo/apps/admin-api
> jest

  console.info
    [admin-api] readAuth: cookie missing { cookieName: 'slimy_admin_token' }

      at info (src/middleware/auth.js:21:13)

  console.info
    [admin-api] readAuth: cookie present { cookieName: 'slimy_admin' }

      at info (src/middleware/auth.js:21:13)

  console.info
    [admin-api] readAuth: token verification failed { error: 'jwt malformed' }

      at info (src/middleware/auth.js:21:13)

  console.info
    [admin-api] readAuth: cookie present { cookieName: 'slimy_admin' }

      at info (src/middleware/auth.js:21:13)

  console.info
    [admin-api] readAuth: user hydrated { userId: 'test-user' }

      at info (src/middleware/auth.js:21:13)

  console.info
    [admin-api] readAuth: cookie present { cookieName: 'slimy_admin' }

      at info (src/middleware/auth.js:21:13)

  console.info
    [admin-api] readAuth: user hydrated { userId: 'test-user' }

      at info (src/middleware/auth.js:21:13)

  console.info
    [admin-api] readAuth: cookie present { cookieName: 'slimy_admin' }

      at info (src/middleware/auth.js:21:13)

  console.info
    [admin-api] readAuth: user hydrated { userId: 'test-user' }

      at info (src/middleware/auth.js:21:13)

  console.info
    [admin-api] readAuth: cookie present { cookieName: 'slimy_admin' }

      at info (src/middleware/auth.js:21:13)

  console.info
    [admin-api] readAuth: user hydrated { userId: 'test-user' }

      at info (src/middleware/auth.js:21:13)

  console.info
    [admin-api] readAuth: cookie missing { cookieName: 'slimy_admin_token' }

      at info (src/middleware/auth.js:21:13)

  console.info
    [admin-api] readAuth: cookie present { cookieName: 'slimy_admin' }

      at info (src/middleware/auth.js:21:13)

  console.info
    [admin-api] readAuth: user hydrated { userId: 'test-user' }

      at info (src/middleware/auth.js:21:13)

  console.info
    [admin-api] readAuth: cookie present { cookieName: 'slimy_admin' }

      at info (src/middleware/auth.js:21:13)

  console.info
    [admin-api] readAuth: user hydrated { userId: 'test-admin' }

      at info (src/middleware/auth.js:21:13)

  console.info
    [admin-api] readAuth: cookie present { cookieName: 'slimy_admin' }

      at info (src/middleware/auth.js:21:13)

  console.info
    [admin-api] readAuth: user hydrated { userId: 'test-member' }

      at info (src/middleware/auth.js:21:13)

  console.info
    [admin-api] readAuth: cookie missing { cookieName: 'slimy_admin_token' }

      at info (src/middleware/auth.js:21:13)

  console.info
    [admin-api] readAuth: cookie present { cookieName: 'slimy_admin' }

      at info (src/middleware/auth.js:21:13)

  console.info
    [admin-api] readAuth: user hydrated { userId: 'test-admin' }

      at info (src/middleware/auth.js:21:13)

  console.info
    [admin-api] readAuth: cookie present { cookieName: 'slimy_admin' }

      at info (src/middleware/auth.js:21:13)

  console.info
    [admin-api] readAuth: user hydrated { userId: 'test-member' }

      at info (src/middleware/auth.js:21:13)

  console.info
    [admin-api] readAuth: cookie present { cookieName: 'slimy_admin' }

      at info (src/middleware/auth.js:21:13)

  console.info
    [admin-api] readAuth: user hydrated { userId: 'test-member' }

      at info (src/middleware/auth.js:21:13)

  console.warn
    [admin-api] guild membership check failed {
      userId: 'test-member',
      guildId: 'different-guild-456',
      guildIds: [ 'guild-123' ]
    }

      375 |     if (!guild) {
      376 |       if (shouldDebugAuth()) {
    > 377 |         console.warn("[admin-api] guild membership check failed", {
          |                 ^
      378 |           userId: user.id,
      379 |           guildId: guildIdStr,
      380 |           guildIds: guilds.map((g) => String(g?.id)).slice(0, 25),

      at warn (src/middleware/auth.js:377:17)
      at Object.<anonymous> (tests/auth/auth-middleware.test.js:183:7)

  console.info
    [admin-api] readAuth: cookie present { cookieName: 'slimy_admin' }

      at info (src/middleware/auth.js:21:13)

  console.info
    [admin-api] readAuth: user hydrated { userId: 'test-member' }

      at info (src/middleware/auth.js:21:13)

  console.info
    [admin-api] readAuth: cookie missing { cookieName: 'slimy_admin_token' }

      at info (src/middleware/auth.js:21:13)

  console.info
    [admin-api] readAuth: cookie present { cookieName: 'slimy_admin' }

      at info (src/middleware/auth.js:21:13)

  console.info
    [admin-api] readAuth: user hydrated { userId: 'test-member' }

      at info (src/middleware/auth.js:21:13)

PASS tests/auth/auth-middleware.test.js
  Auth Middleware
    resolveUser
      âœ“ should return null when no token in cookies (71 ms)
      âœ“ should return null when token is invalid (5 ms)
      âœ“ should return hydrated user when session exists (9 ms)
      âœ“ should return fallback user when no session exists (7 ms)
      âœ“ should cache user resolution (7 ms)
    requireAuth
      âœ“ should call next when user is authenticated (7 ms)
      âœ“ should return 401 when user is not authenticated (4 ms)
    requireRole
      âœ“ should call next when user has required role (member) (7 ms)
      âœ“ should call next when user has higher role than required (6 ms)
      âœ“ should return 403 when user has insufficient role (6 ms)
      âœ“ should return 401 when user is not authenticated (4 ms)
    requireGuildMember
      âœ“ should call next for admin user regardless of guild membership (5 ms)
      âœ“ should call next when user is member of the guild (5 ms)
      âœ“ should return 403 when user is not member of the guild (18 ms)
      âœ“ should return 400 when guildId parameter is missing (5 ms)
      âœ“ should return 401 when user is not authenticated (3 ms)
      âœ“ should use custom parameter name (4 ms)

  console.log
    !!! AUTH LOGIC LOADED v303 (DATA INTEGRITY) !!!

      at Object.log (src/routes/auth.js:10:9)

  console.log
    [auth/me] req.user keys: id,username,role,guilds

      at log (src/routes/auth.js:505:13)

  console.log
    [auth/me] rawUser keys: id,username,role,guilds

      at log (src/routes/auth.js:506:13)

  console.log
    [auth/me] Lookup User ID: test-user-id

      at log (src/routes/auth.js:507:13)

  console.log
    [auth/me] DB User Found: true

      at log (src/routes/auth.js:565:13)

  console.warn
    [auth/me] DB guild lookup failed; returning session-only guilds { error: "Cannot read properties of undefined (reading 'findMany')" }

      586 |         warnings.push("db_guilds_lookup_failed");
      587 |         if (shouldDebugAuth()) {
    > 588 |           console.warn("[auth/me] DB guild lookup failed; returning session-only guilds", {
          |                   ^
      589 |             error: err?.message || String(err),
      590 |           });
      591 |         }

      at warn (src/routes/auth.js:588:19)

  console.log
    [auth/me] req.user keys: id,username,role,guilds

      at log (src/routes/auth.js:505:13)

  console.log
    [auth/me] rawUser keys: id,username,role,guilds

      at log (src/routes/auth.js:506:13)

  console.log
    [auth/me] Lookup User ID: test-user-id

      at log (src/routes/auth.js:507:13)

  console.warn
    [auth/me] DB user lookup failed; returning session-only response { error: 'DB Error' }

      557 |       warnings.push("db_user_lookup_failed");
      558 |       if (shouldDebugAuth()) {
    > 559 |         console.warn("[auth/me] DB user lookup failed; returning session-only response", {
          |                 ^
      560 |           error: err?.message || String(err),
      561 |         });
      562 |       }

      at warn (src/routes/auth.js:559:17)

  console.log
    [auth/me] DB User Found: false

      at log (src/routes/auth.js:565:13)

  console.warn
    [auth/me] Fallback to cookie guilds: 0

      602 |       // But ensure we at least pass the ID
      603 |       const cookieGuilds = Array.isArray(rawUser?.guilds) ? rawUser.guilds : [];
    > 604 |       console.warn("[auth/me] Fallback to cookie guilds:", cookieGuilds.length);
          |               ^
      605 |       sessionGuilds = cookieGuilds.map((g) => ({
      606 |         id: g?.id,
      607 |         roles: g?.roles,

      at warn (src/routes/auth.js:604:15)

PASS tests/auth/me-context.test.js
  GET /api/auth/me Context Hydration
    âœ“ should include lastActiveGuild from DB (148 ms)
    âœ“ should handle DB errors gracefully (28 ms)

  console.log
    [requireGuildAccess] Checking access for user discord-user-id to guild guild-123

      at log (src/middleware/rbac.js:33:13)

  console.warn
    [requireGuildAccess] User discord-user-id not found in DB

      38 |
      39 |     if (!user) {
    > 40 |       console.warn(`[requireGuildAccess] User ${req.user.id} not found in DB`);
         |               ^
      41 |       return res.status(403).json({ error: "guild-access-denied" });
      42 |     }
      43 |

      at warn (src/middleware/rbac.js:40:15)
      at Object.<anonymous> (tests/middleware/rbac.test.js:53:5)

  console.log
    [requireGuildAccess] Checking access for user discord-user-id to guild guild-123

      at log (src/middleware/rbac.js:33:13)

  console.warn
    [requireGuildAccess] User db-user-id is not a member of guild guild-123

      56 |
      57 |     if (!userGuild) {
    > 58 |       console.warn(`[requireGuildAccess] User ${user.id} is not a member of guild ${guildId}`);
         |               ^
      59 |       return res.status(403).json({ error: "guild-access-denied" });
      60 |     }
      61 |

      at warn (src/middleware/rbac.js:58:15)
      at Object.<anonymous> (tests/middleware/rbac.test.js:63:5)

  console.log
    [requireGuildAccess] Checking access for user discord-user-id to guild guild-123

      at log (src/middleware/rbac.js:33:13)

PASS tests/middleware/rbac.test.js
  requireGuildAccess Middleware
    âœ“ should return 400 if guildId is missing (2 ms)
    âœ“ should return 401 if user is not authenticated (1 ms)
    âœ“ should return 403 if user not found in DB (8 ms)
    âœ“ should return 403 if user is not a member of the guild (6 ms)
    âœ“ should call next() and attach guild info if user has access (30 ms)

PASS tests/guilds-read.test.js
  GET /api/guilds/:guildId
    âœ“ should return guild details for authenticated user (98 ms)
    âœ“ should return 404 for non-existent guild (7 ms)

  console.error
    [guilds/connect] Missing SLIMYAI_BOT_TOKEN

      113 |       const SLIMYAI_BOT_TOKEN = (process.env.SLIMYAI_BOT_TOKEN || process.env.DISCORD_BOT_TOKEN || "").trim();
      114 |       if (!SLIMYAI_BOT_TOKEN) {
    > 115 |         console.error("[guilds/connect] Missing SLIMYAI_BOT_TOKEN");
          |                 ^
      116 |         return res.status(500).json({ error: "MISSING_SLIMYAI_BOT_TOKEN" });
      117 |       }
      118 |

      at error (src/routes/guilds.js:115:17)
      at Layer.handle [as handle_request] (../../node_modules/.pnpm/express@4.22.1/node_modules/express/lib/router/layer.js:95:5)
      at next (../../node_modules/.pnpm/express@4.22.1/node_modules/express/lib/router/route.js:149:13)
      at next (src/middleware/validate.js:18:12)
      at Layer.handle [as handle_request] (../../node_modules/.pnpm/express@4.22.1/node_modules/express/lib/router/layer.js:95:5)
      at next (../../node_modules/.pnpm/express@4.22.1/node_modules/express/lib/router/route.js:149:13)
      at next (src/middleware/auth.js:324:10)
      at Layer.handle [as handle_request] (../../node_modules/.pnpm/express@4.22.1/node_modules/express/lib/router/layer.js:95:5)
      at next (../../node_modules/.pnpm/express@4.22.1/node_modules/express/lib/router/route.js:149:13)
      at Route.dispatch (../../node_modules/.pnpm/express@4.22.1/node_modules/express/lib/router/route.js:119:3)
      at Layer.handle [as handle_request] (../../node_modules/.pnpm/express@4.22.1/node_modules/express/lib/router/layer.js:95:5)
      at ../../node_modules/.pnpm/express@4.22.1/node_modules/express/lib/router/index.js:284:15
      at Function.process_params (../../node_modules/.pnpm/express@4.22.1/node_modules/express/lib/router/index.js:346:12)
      at next (../../node_modules/.pnpm/express@4.22.1/node_modules/express/lib/router/index.js:280:10)
      at next (src/middleware/auth.js:324:10)
      at Layer.handle [as handle_request] (../../node_modules/.pnpm/express@4.22.1/node_modules/express/lib/router/layer.js:95:5)
      at trim_prefix (../../node_modules/.pnpm/express@4.22.1/node_modules/express/lib/router/index.js:328:13)
      at ../../node_modules/.pnpm/express@4.22.1/node_modules/express/lib/router/index.js:286:9
      at Function.process_params (../../node_modules/.pnpm/express@4.22.1/node_modules/express/lib/router/index.js:346:12)
      at next (../../node_modules/.pnpm/express@4.22.1/node_modules/express/lib/router/index.js:280:10)
      at Function.handle (../../node_modules/.pnpm/express@4.22.1/node_modules/express/lib/router/index.js:175:3)
      at router (../../node_modules/.pnpm/express@4.22.1/node_modules/express/lib/router/index.js:47:12)
      at Layer.handle [as handle_request] (../../node_modules/.pnpm/express@4.22.1/node_modules/express/lib/router/layer.js:95:5)
      at trim_prefix (../../node_modules/.pnpm/express@4.22.1/node_modules/express/lib/router/index.js:328:13)
      at ../../node_modules/.pnpm/express@4.22.1/node_modules/express/lib/router/index.js:286:9
      at Function.process_params (../../node_modules/.pnpm/express@4.22.1/node_modules/express/lib/router/index.js:346:12)
      at next (../../node_modules/.pnpm/express@4.22.1/node_modules/express/lib/router/index.js:280:10)
      at next (tests/guilds-connect.test.js:30:5)
      at Layer.handle [as handle_request] (../../node_modules/.pnpm/express@4.22.1/node_modules/express/lib/router/layer.js:95:5)
      at trim_prefix (../../node_modules/.pnpm/express@4.22.1/node_modules/express/lib/router/index.js:328:13)
      at ../../node_modules/.pnpm/express@4.22.1/node_modules/express/lib/router/index.js:286:9
      at Function.process_params (../../node_modules/.pnpm/express@4.22.1/node_modules/express/lib/router/index.js:346:12)
      at next (../../node_modules/.pnpm/express@4.22.1/node_modules/express/lib/router/index.js:280:10)
      at cookieParser (../../node_modules/.pnpm/cookie-parser@1.4.7/node_modules/cookie-parser/index.js:71:5)
      at Layer.handle [as handle_request] (../../node_modules/.pnpm/express@4.22.1/node_modules/express/lib/router/layer.js:95:5)
      at trim_prefix (../../node_modules/.pnpm/express@4.22.1/node_modules/express/lib/router/index.js:328:13)
      at ../../node_modules/.pnpm/express@4.22.1/node_modules/express/lib/router/index.js:286:9
      at Function.process_params (../../node_modules/.pnpm/express@4.22.1/node_modules/express/lib/router/index.js:346:12)
      at next (../../node_modules/.pnpm/express@4.22.1/node_modules/express/lib/router/index.js:280:10)
      at ../../node_modules/.pnpm/body-parser@1.20.4/node_modules/body-parser/lib/read.js:137:5
      at invokeCallback (../../node_modules/.pnpm/raw-body@2.5.3/node_modules/raw-body/index.js:238:16)
      at done (../../node_modules/.pnpm/raw-body@2.5.3/node_modules/raw-body/index.js:227:7)
      at IncomingMessage.onEnd (../../node_modules/.pnpm/raw-body@2.5.3/node_modules/raw-body/index.js:287:7)

  console.log
    connect response 500 { error: 'MISSING_SLIMYAI_BOT_TOKEN' }

      at Object.log (tests/guilds-connect.test.js:101:15)

  console.error
    [guilds/connect] Missing SLIMYAI_BOT_TOKEN

      113 |       const SLIMYAI_BOT_TOKEN = (process.env.SLIMYAI_BOT_TOKEN || process.env.DISCORD_BOT_TOKEN || "").trim();
      114 |       if (!SLIMYAI_BOT_TOKEN) {
    > 115 |         console.error("[guilds/connect] Missing SLIMYAI_BOT_TOKEN");
          |                 ^
      116 |         return res.status(500).json({ error: "MISSING_SLIMYAI_BOT_TOKEN" });
      117 |       }
      118 |

      at error (src/routes/guilds.js:115:17)
      at Layer.handle [as handle_request] (../../node_modules/.pnpm/express@4.22.1/node_modules/express/lib/router/layer.js:95:5)
      at next (../../node_modules/.pnpm/express@4.22.1/node_modules/express/lib/router/route.js:149:13)
      at next (src/middleware/validate.js:18:12)
      at Layer.handle [as handle_request] (../../node_modules/.pnpm/express@4.22.1/node_modules/express/lib/router/layer.js:95:5)
      at next (../../node_modules/.pnpm/express@4.22.1/node_modules/express/lib/router/route.js:149:13)
      at next (src/middleware/auth.js:324:10)
      at Layer.handle [as handle_request] (../../node_modules/.pnpm/express@4.22.1/node_modules/express/lib/router/layer.js:95:5)
      at next (../../node_modules/.pnpm/express@4.22.1/node_modules/express/lib/router/route.js:149:13)
      at Route.dispatch (../../node_modules/.pnpm/express@4.22.1/node_modules/express/lib/router/route.js:119:3)
      at Layer.handle [as handle_request] (../../node_modules/.pnpm/express@4.22.1/node_modules/express/lib/router/layer.js:95:5)
      at ../../node_modules/.pnpm/express@4.22.1/node_modules/express/lib/router/index.js:284:15
      at Function.process_params (../../node_modules/.pnpm/express@4.22.1/node_modules/express/lib/router/index.js:346:12)
      at next (../../node_modules/.pnpm/express@4.22.1/node_modules/express/lib/router/index.js:280:10)
      at next (src/middleware/auth.js:324:10)
      at Layer.handle [as handle_request] (../../node_modules/.pnpm/express@4.22.1/node_modules/express/lib/router/layer.js:95:5)
      at trim_prefix (../../node_modules/.pnpm/express@4.22.1/node_modules/express/lib/router/index.js:328:13)
      at ../../node_modules/.pnpm/express@4.22.1/node_modules/express/lib/router/index.js:286:9
      at Function.process_params (../../node_modules/.pnpm/express@4.22.1/node_modules/express/lib/router/index.js:346:12)
      at next (../../node_modules/.pnpm/express@4.22.1/node_modules/express/lib/router/index.js:280:10)
      at Function.handle (../../node_modules/.pnpm/express@4.22.1/node_modules/express/lib/router/index.js:175:3)
      at router (../../node_modules/.pnpm/express@4.22.1/node_modules/express/lib/router/index.js:47:12)
      at Layer.handle [as handle_request] (../../node_modules/.pnpm/express@4.22.1/node_modules/express/lib/router/layer.js:95:5)
      at trim_prefix (../../node_modules/.pnpm/express@4.22.1/node_modules/express/lib/router/index.js:328:13)
      at ../../node_modules/.pnpm/express@4.22.1/node_modules/express/lib/router/index.js:286:9
      at Function.process_params (../../node_modules/.pnpm/express@4.22.1/node_modules/express/lib/router/index.js:346:12)
      at next (../../node_modules/.pnpm/express@4.22.1/node_modules/express/lib/router/index.js:280:10)
      at next (tests/guilds-connect.test.js:30:5)
      at Layer.handle [as handle_request] (../../node_modules/.pnpm/express@4.22.1/node_modules/express/lib/router/layer.js:95:5)
      at trim_prefix (../../node_modules/.pnpm/express@4.22.1/node_modules/express/lib/router/index.js:328:13)
      at ../../node_modules/.pnpm/express@4.22.1/node_modules/express/lib/router/index.js:286:9
      at Function.process_params (../../node_modules/.pnpm/express@4.22.1/node_modules/express/lib/router/index.js:346:12)
      at next (../../node_modules/.pnpm/express@4.22.1/node_modules/express/lib/router/index.js:280:10)
      at cookieParser (../../node_modules/.pnpm/cookie-parser@1.4.7/node_modules/cookie-parser/index.js:71:5)
      at Layer.handle [as handle_request] (../../node_modules/.pnpm/express@4.22.1/node_modules/express/lib/router/layer.js:95:5)
      at trim_prefix (../../node_modules/.pnpm/express@4.22.1/node_modules/express/lib/router/index.js:328:13)
      at ../../node_modules/.pnpm/express@4.22.1/node_modules/express/lib/router/index.js:286:9
      at Function.process_params (../../node_modules/.pnpm/express@4.22.1/node_modules/express/lib/router/index.js:346:12)
      at next (../../node_modules/.pnpm/express@4.22.1/node_modules/express/lib/router/index.js:280:10)
      at ../../node_modules/.pnpm/body-parser@1.20.4/node_modules/body-parser/lib/read.js:137:5
      at invokeCallback (../../node_modules/.pnpm/raw-body@2.5.3/node_modules/raw-body/index.js:238:16)
      at done (../../node_modules/.pnpm/raw-body@2.5.3/node_modules/raw-body/index.js:227:7)
      at IncomingMessage.onEnd (../../node_modules/.pnpm/raw-body@2.5.3/node_modules/raw-body/index.js:287:7)

PASS tests/routes/usage.test.js
  GET /api/usage
    âœ“ should return 200 and correct usage data structure (10 ms)

FAIL tests/guilds-connect.test.js
  POST /api/guilds/connect
    âœ• should return 200 when connecting with valid frontend payload (292 ms)
    âœ• should return 200 if guild is ALREADY connected (26 ms)
    âœ“ should return 400 if guild ID is missing (9 ms)
  guildService.connectGuild
    âœ“ upserts owner by discord id and links guild to the owner (4 ms)

  â— POST /api/guilds/connect â€º should return 200 when connecting with valid frontend payload

    expect(received).toBe(expected) // Object.is equality

    Expected: 200
    Received: 500

      101 |       console.log("connect response", res.status, res.body);
      102 |     }
    > 103 |     expect(res.status).toBe(200);
          |                        ^
      104 |     expect(res.body).toMatchObject({
      105 |       id: frontendPayload.guildId,
      106 |       name: frontendPayload.name,

      at Object.toBe (tests/guilds-connect.test.js:103:24)

  â— POST /api/guilds/connect â€º should return 200 if guild is ALREADY connected

    expected 200 "OK", got 500 "Internal Server Error"

      110 |
      111 |   test("should return 200 if guild is ALREADY connected", async () => {
    > 112 |     await postConnect().expect(200);
          |                         ^
      113 |     const res = await postConnect();
      114 |     if (res.status !== 200) {
      115 |       // eslint-disable-next-line no-console

      at Object.expect (tests/guilds-connect.test.js:112:25)
      ----
      at Test._assertStatus (../../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:309:14)
      at ../../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:365:13
      at Test._assertFunction (../../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:342:13)
      at Test.assert (../../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:195:23)
      at localAssert (../../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:138:14)
      at Server.<anonymous> (../../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:152:11)

PASS tests/routes/stats.test.js
  Stats Routes
    âœ“ GET /api/stats should return system metrics by default (18 ms)
    âœ“ GET /api/stats?action=system-metrics should return metrics (7 ms)
    âœ“ GET /api/stats/events/stream should set SSE headers (3 ms)

PASS tests/numparse.test.js
  numparse shim
    âœ“ returns numeric values for plain numbers (2 ms)
    âœ“ returns null for non-numeric values or suffixed strings (1 ms)

PASS tests/club-store.test.js
  club-store shim
    âœ“ canonicalize lowercases input (1 ms)
    âœ“ canonicalize handles nullish values

PASS tests/diag.test.js
  diagnostics placeholder
    âœ“ skipped in test mode (1 ms)

PASS tests/discord-guilds.test.js
  GET /discord/guilds
    âœ“ should return intersected guilds with correct appRoles (19 ms)

  console.error
    [guilds/connect] Missing SLIMYAI_BOT_TOKEN

      113 |       const SLIMYAI_BOT_TOKEN = (process.env.SLIMYAI_BOT_TOKEN || process.env.DISCORD_BOT_TOKEN || "").trim();
      114 |       if (!SLIMYAI_BOT_TOKEN) {
    > 115 |         console.error("[guilds/connect] Missing SLIMYAI_BOT_TOKEN");
          |                 ^
      116 |         return res.status(500).json({ error: "MISSING_SLIMYAI_BOT_TOKEN" });
      117 |       }
      118 |

      at error (src/routes/guilds.js:115:17)
      at Layer.handle [as handle_request] (../../node_modules/.pnpm/express@4.22.1/node_modules/express/lib/router/layer.js:95:5)
      at next (../../node_modules/.pnpm/express@4.22.1/node_modules/express/lib/router/route.js:149:13)
      at next (tests/guild-connect.test.js:23:5)
      at Layer.handle [as handle_request] (../../node_modules/.pnpm/express@4.22.1/node_modules/express/lib/router/layer.js:95:5)
      at next (../../node_modules/.pnpm/express@4.22.1/node_modules/express/lib/router/route.js:149:13)
      at next (tests/guild-connect.test.js:11:5)
      at Layer.handle [as handle_request] (../../node_modules/.pnpm/express@4.22.1/node_modules/express/lib/router/layer.js:95:5)
      at next (../../node_modules/.pnpm/express@4.22.1/node_modules/express/lib/router/route.js:149:13)
      at Route.dispatch (../../node_modules/.pnpm/express@4.22.1/node_modules/express/lib/router/route.js:119:3)
      at Layer.handle [as handle_request] (../../node_modules/.pnpm/express@4.22.1/node_modules/express/lib/router/layer.js:95:5)
      at ../../node_modules/.pnpm/express@4.22.1/node_modules/express/lib/router/index.js:284:15
      at Function.process_params (../../node_modules/.pnpm/express@4.22.1/node_modules/express/lib/router/index.js:346:12)
      at next (../../node_modules/.pnpm/express@4.22.1/node_modules/express/lib/router/index.js:280:10)
      at next (tests/guild-connect.test.js:11:5)
      at Layer.handle [as handle_request] (../../node_modules/.pnpm/express@4.22.1/node_modules/express/lib/router/layer.js:95:5)
      at trim_prefix (../../node_modules/.pnpm/express@4.22.1/node_modules/express/lib/router/index.js:328:13)
      at ../../node_modules/.pnpm/express@4.22.1/node_modules/express/lib/router/index.js:286:9
      at Function.process_params (../../node_modules/.pnpm/express@4.22.1/node_modules/express/lib/router/index.js:346:12)
      at next (../../node_modules/.pnpm/express@4.22.1/node_modules/express/lib/router/index.js:280:10)
      at Function.handle (../../node_modules/.pnpm/express@4.22.1/node_modules/express/lib/router/index.js:175:3)
      at router (../../node_modules/.pnpm/express@4.22.1/node_modules/express/lib/router/index.js:47:12)
      at Layer.handle [as handle_request] (../../node_modules/.pnpm/express@4.22.1/node_modules/express/lib/router/layer.js:95:5)
      at trim_prefix (../../node_modules/.pnpm/express@4.22.1/node_modules/express/lib/router/index.js:328:13)
      at ../../node_modules/.pnpm/express@4.22.1/node_modules/express/lib/router/index.js:286:9
      at Function.process_params (../../node_modules/.pnpm/express@4.22.1/node_modules/express/lib/router/index.js:346:12)
      at next (../../node_modules/.pnpm/express@4.22.1/node_modules/express/lib/router/index.js:280:10)
      at ../../node_modules/.pnpm/body-parser@1.20.4/node_modules/body-parser/lib/read.js:137:5
      at invokeCallback (../../node_modules/.pnpm/raw-body@2.5.3/node_modules/raw-body/index.js:238:16)
      at done (../../node_modules/.pnpm/raw-body@2.5.3/node_modules/raw-body/index.js:227:7)
      at IncomingMessage.onEnd (../../node_modules/.pnpm/raw-body@2.5.3/node_modules/raw-body/index.js:287:7)

PASS tests/guild-connect.test.js
  POST /guilds/connect
    âœ“ should fail if SLIMYAI_BOT_TOKEN is missing (24 ms)
    âœ“ should return 403 USER_NOT_IN_GUILD if user is not in guild (4 ms)
    âœ“ should return 403 BOT_NOT_IN_GUILD if bot is not in guild (Owned Only) (4 ms)
    âœ“ should succeed if guild is shared (3 ms)

A worker process has failed to exit gracefully and has been force exited. This is likely caused by tests leaking due to improper teardown. Try running with --detectOpenHandles to find leaks. Active timers can also cause this, ensure that .unref() was called on them.
Summary of all failing tests
FAIL tests/guilds-connect.test.js
  â— POST /api/guilds/connect â€º should return 200 when connecting with valid frontend payload

    expect(received).toBe(expected) // Object.is equality

    Expected: 200
    Received: 500

      101 |       console.log("connect response", res.status, res.body);
      102 |     }
    > 103 |     expect(res.status).toBe(200);
          |                        ^
      104 |     expect(res.body).toMatchObject({
      105 |       id: frontendPayload.guildId,
      106 |       name: frontendPayload.name,

      at Object.toBe (tests/guilds-connect.test.js:103:24)

  â— POST /api/guilds/connect â€º should return 200 if guild is ALREADY connected

    expected 200 "OK", got 500 "Internal Server Error"

      110 |
      111 |   test("should return 200 if guild is ALREADY connected", async () => {
    > 112 |     await postConnect().expect(200);
          |                         ^
      113 |     const res = await postConnect();
      114 |     if (res.status !== 200) {
      115 |       // eslint-disable-next-line no-console

      at Object.expect (tests/guilds-connect.test.js:112:25)
      ----
      at Test._assertStatus (../../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:309:14)
      at ../../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:365:13
      at Test._assertFunction (../../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:342:13)
      at Test.assert (../../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:195:23)
      at localAssert (../../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:138:14)
      at Server.<anonymous> (../../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:152:11)


Test Suites: 1 failed, 12 skipped, 11 passed, 12 of 24 total
Tests:       2 failed, 12 skipped, 42 passed, 56 total
Snapshots:   0 total
Time:        4.322 s
Ran all test suites.
/opt/slimy/slimy-monorepo/apps/admin-api:
â€‰ERR_PNPM_RECURSIVE_RUN_FIRST_FAILâ€‰ @slimy/admin-api@1.0.0 test: `jest`
Exit status 1

(exit code: 1)

## Decision

### BASELINE PASS criteria
- pnpm smoke:docker exit code 0
- docker compose ps shows services running/healthy
- /api/health returns HTTP 200
- no legacy 3080 binders (e.g. slimy-admin-api)

### Result
- pnpm smoke:docker: 0
- /api/health HTTP: 200
- legacy slimy-admin-api present: no

BASELINE: PASS

NEXT STEP: Step 1 â€” Fix /api/guilds user âˆ© SlimyAI bot + role labels
