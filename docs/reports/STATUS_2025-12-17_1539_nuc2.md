# STATUS 2025-12-17 1539 UTC — NUC2 Pre-Flight Status Scan

## What this checks
- Git state, port 3080 collision guard, env presence-only, and baseline stack health (no secrets printed).

## 1) Identity / git

```bash
date -u
```
```text
Wed Dec 17 03:39:59 PM UTC 2025
```

```bash
hostname
```
```text
slimy-nuc2
```

```bash
pwd
```
```text
/opt/slimy/slimy-monorepo
```

```bash
git rev-parse --abbrev-ref HEAD
```
```text
nuc2/verify-role-b33e616
```

```bash
git status -sb
```
```text
## nuc2/verify-role-b33e616
 M .gitignore
 M apps/admin-api/.env.admin
 M apps/admin-api/.env.local
 M apps/admin-api/src/routes/discord.js
 M apps/admin-api/src/routes/guilds.js
 M apps/web/app/(marketing)/components/CTA.tsx
 M apps/web/app/(marketing)/components/ChatWidget.simple.bak
 M apps/web/app/(marketing)/components/Nav.tsx
 M apps/web/components/auth/login-button.tsx
 M docker-compose.yml
 M package.json
 M scripts/dev/migrate-admin-api-db.sh
 M scripts/smoke/docker-smoke.sh
?? apps/admin-api/tests/discord-guilds.test.js
?? apps/admin-api/tests/guild-connect.test.js
?? config/
?? docs/buglog/BUG_2025-12-14_guilds-filter-user-intersect-slimyai-bot.md
?? docs/buglog/BUG_2025-12-14_guilds-owned-visible_connect-shared-only.md
?? docs/buglog/BUG_2025-12-17_port-3080-collision-and-slimyai-bot-token.md
?? docs/reports/
?? scripts/env-check.ts
?? scripts/env-sync.ts
```

```bash
git diff --name-only
```
```text
.gitignore
apps/admin-api/.env.admin
apps/admin-api/.env.local
apps/admin-api/src/routes/discord.js
apps/admin-api/src/routes/guilds.js
apps/web/app/(marketing)/components/CTA.tsx
apps/web/app/(marketing)/components/ChatWidget.simple.bak
apps/web/app/(marketing)/components/Nav.tsx
apps/web/components/auth/login-button.tsx
docker-compose.yml
package.json
scripts/dev/migrate-admin-api-db.sh
scripts/smoke/docker-smoke.sh
```

## 2) Port + container collision guard (3080)

```bash
ss -ltnp | rg ':3080' || true
```
```text
LISTEN 0      4096         0.0.0.0:3080       0.0.0.0:*                                                 
LISTEN 0      4096            [::]:3080          [::]:*                                                 
```

```bash
docker ps --format 'table {{.Names}}\t{{.Ports}}' | rg '3080' || echo "No running containers publishing 3080"
```
```text
slimy-monorepo-admin-api-1   0.0.0.0:3080->3080/tcp, [::]:3080->3080/tcp
```

```bash
docker ps -a --format 'table {{.Names}}\t{{.Status}}\t{{.Ports}}' | rg 'slimy-admin-api|3080' || true
```
```text
slimy-monorepo-admin-api-1   Up 20 minutes (healthy)       0.0.0.0:3080->3080/tcp, [::]:3080->3080/tcp
slimy-admin-api              Exited (137) 20 minutes ago   
```

Decision: legacy container removal
- Found legacy 'slimy-admin-api' container (any status). Ran: `docker rm -f slimy-admin-api || true`.

Post-removal publish check:

```bash
docker ps --format 'table {{.Names}}\t{{.Ports}}' | rg '3080' || echo "No running containers publishing 3080"
```
```text
slimy-monorepo-admin-api-1   0.0.0.0:3080->3080/tcp, [::]:3080->3080/tcp
```

## 3) Env presence-only

```bash
pnpm env:check
```
```text

> slimy-monorepo@ env:check /opt/slimy/slimy-monorepo
> tsx scripts/env-check.ts

env:check OK (3 required keys present; no values printed).
```

```bash
grep -q '^DISCORD_BOT_TOKEN=' .env.local && echo "DISCORD_BOT_TOKEN present" || echo "DISCORD_BOT_TOKEN missing"
```
```text
DISCORD_BOT_TOKEN present
```

```bash
grep -q '^SLIMYAI_BOT_TOKEN=' .env.local && echo "SLIMYAI_BOT_TOKEN present" || echo "SLIMYAI_BOT_TOKEN missing"
```
```text
SLIMYAI_BOT_TOKEN present
```

## 4) Stack baseline

```bash
pnpm smoke:docker
```
```text
#86 [admin-ui runner  7/10] COPY --from=builder --chown=nextjs:nodejs /app/apps/admin-ui/.next/standalone/node_modules ./node_modules
#86 DONE 0.8s

#87 [admin-ui runner  8/10] COPY --from=builder --chown=nextjs:nodejs /app/apps/admin-ui/.next/static ./apps/admin-ui/.next/static
#87 DONE 0.2s

#88 [admin-ui runner  9/10] COPY --from=builder --chown=nextjs:nodejs /app/apps/admin-ui/.next/static ./.next/static
#88 DONE 0.1s

#89 [admin-ui runner 10/10] COPY --from=builder --chown=nextjs:nodejs /app/apps/admin-ui/public ./public
#89 DONE 0.1s

#90 [admin-ui] exporting to image
#90 exporting layers 0.8s done
#90 writing image sha256:39a9b2cec195e3bf10e817738431781ee91e90ebdd049066432db1a23284757d done
#90 naming to docker.io/library/slimy-monorepo-admin-ui done
#90 DONE 0.8s
 Network slimy-monorepo_slimy-network  Creating
 Network slimy-monorepo_slimy-network  Created
 Container slimy-monorepo-db-1  Creating
 Container slimy-monorepo-db-1  Created
 Container slimy-monorepo-admin-api-1  Creating
 Container slimy-monorepo-admin-api-1  Created
 Container slimy-monorepo-web-1  Creating
 Container slimy-monorepo-admin-ui-1  Creating
 Container slimy-monorepo-admin-ui-1  Created
 Container slimy-monorepo-web-1  Created
 Container slimy-monorepo-db-1  Starting
 Container slimy-monorepo-db-1  Started
 Container slimy-monorepo-db-1  Waiting
 Container slimy-monorepo-db-1  Healthy
 Container slimy-monorepo-admin-api-1  Starting
 Container slimy-monorepo-admin-api-1  Started
 Container slimy-monorepo-admin-api-1  Waiting
 Container slimy-monorepo-db-1  Waiting
 Container slimy-monorepo-admin-api-1  Waiting
 Container slimy-monorepo-db-1  Healthy
 Container slimy-monorepo-admin-api-1  Healthy
 Container slimy-monorepo-web-1  Starting
 Container slimy-monorepo-admin-api-1  Healthy
 Container slimy-monorepo-admin-ui-1  Starting
 Container slimy-monorepo-web-1  Started
 Container slimy-monorepo-admin-ui-1  Started
Waiting for endpoints...
OK: admin-api /api/health
OK: web /
OK: admin-ui /

Applying admin-api database migrations...
Applying admin-api Prisma migrations (docker)...
 Container slimy-monorepo-db-1  Running
 Container slimy-monorepo-admin-api-1  Running
 Container slimy-monorepo-db-1  Waiting
 Container slimy-monorepo-db-1  Healthy
Environment variables loaded from .env
Prisma schema loaded from prisma/schema.prisma
Datasource "db": MySQL database "slimyai" at "db:3306"

4 migrations found in prisma/migrations


No pending migrations to apply.
OK: admin-api Prisma migrations applied

Checking admin-ui /dashboard routing...
OK: admin-ui /dashboard (HTTP 307)

Checking admin-ui /dashboard with synthetic auth cookie...
OK: admin-ui /dashboard with synthetic auth (HTTP 200)

Checking admin-ui Socket.IO proxy with synthetic auth cookie...
OK: admin-ui Socket.IO polling handshake (HTTP 200)
OK: admin-ui -> admin-api bridge /api/admin-api/health
OK: admin-ui -> admin-api bridge /api/admin-api/diag
OK: admin-ui catch-all /api/admin-api/api/health
OK: admin-ui catch-all /api/admin-api/api/diag

Checking admin-ui catch-all real endpoint...
OK: admin-ui catch-all /api/admin-api/api/usage (HTTP 200)

Checking admin-ui catch-all protected endpoint...
OK: admin-ui catch-all /api/admin-api/api/auth/me (HTTP 401)

=== admin-ui -> admin-api bridge responses ===
--- /api/admin-api/health ---
{
  "ok": true,
  "upstream": {
    "status": "ok",
    "uptime": 9,
    "timestamp": "2025-12-17T15:42:18.575Z",
    "version": "1.0.0"
  },
  "ts": "2025-12-17T15:42:18.577Z"
}
--- /api/admin-api/diag ---
{
  "ok": true,
  "upstream": {
    "ok": true,
    "authenticated": false
  },
  "ts": "2025-12-17T15:42:18.598Z"
}
--- /api/admin-api/api/usage ---
{
  "ok": true,
  "data": {
    "level": "pro",
    "currentSpend": 950,
    "limit": 1000,
    "modelProbeStatus": "soft_cap"
  }
}
--- /api/admin-api/api/auth/me ---
{
  "error": "unauthorized"
}

PASS: Docker baseline smoke test
```

```bash
docker compose ps
```
```text
NAME                         IMAGE                      COMMAND                  SERVICE     CREATED          STATUS                    PORTS
slimy-monorepo-admin-api-1   slimy-monorepo-admin-api   "docker-entrypoint.s…"   admin-api   25 seconds ago   Up 13 seconds (healthy)   0.0.0.0:3080->3080/tcp, :::3080->3080/tcp
slimy-monorepo-admin-ui-1    slimy-monorepo-admin-ui    "docker-entrypoint.s…"   admin-ui    25 seconds ago   Up 7 seconds              0.0.0.0:3001->3000/tcp, :::3001->3000/tcp
slimy-monorepo-db-1          mysql:8.0                  "docker-entrypoint.s…"   db          25 seconds ago   Up 24 seconds (healthy)   3306/tcp, 33060/tcp
slimy-monorepo-web-1         slimy-monorepo-web         "docker-entrypoint.s…"   web         25 seconds ago   Up 8 seconds              0.0.0.0:3000->3000/tcp, :::3000->3000/tcp
```

```bash
curl -sS -i http://localhost:3080/api/health | sed -n '1,15p'
```
```text
HTTP/1.1 200 OK
Content-Security-Policy: default-src 'self';base-uri 'self';font-src 'self' https: data:;form-action 'self';frame-ancestors 'self';img-src 'self' data:;object-src 'none';script-src 'self';script-src-attr 'none';style-src 'self' https: 'unsafe-inline';upgrade-insecure-requests
Cross-Origin-Opener-Policy: same-origin
Cross-Origin-Resource-Policy: same-origin
Origin-Agent-Cluster: ?1
Referrer-Policy: no-referrer
Strict-Transport-Security: max-age=31536000; includeSubDomains
X-Content-Type-Options: nosniff
X-DNS-Prefetch-Control: off
X-Download-Options: noopen
X-Frame-Options: SAMEORIGIN
X-Permitted-Cross-Domain-Policies: none
X-XSS-Protection: 0
X-Request-ID: f48d7946-d1a0-4bef-af2c-13011400e2dd
Access-Control-Allow-Origin: http://localhost:3000
```

## Decisions
- Port 3080 collision: GUARDED (legacy container removed)
- env:check: PASS
- smoke:docker: PASS
- /api/health HTTP: 200

## Next Step
Next Step: Step 1 — /api/guilds user ∩ SlimyAI bot + role labels
