{
  "timestamp": "2026-01-02T21:55:12.986Z",
  "timestampShort": "2026-01-02_2154",
  "host": "nuc2",
  "git": {
    "branch": "nuc2/verify-role-b33e616",
    "head": "e0ba42a",
    "dirty": true,
    "status": "M scripts/report/run.mjs\n?? .github/workflows/repo-health-report.yml\n?? apps/web/app/chat/page.backup-2025-12-28.tsx\n?? apps/web/public/slimechat/\n?? docs/buglog/BUG_2025-12-28_caddy-502-admin-api-migration-loop.md\n?? docs/buglog/BUG_2025-12-28_chat-iframe-wrapper.md\n?? docs/buglog/BUG_2025-12-28_discord-invalid-redirect-uri.md\n?? docs/buglog/BUG_2025-12-28_discord-oauth-redirect-uri.md\n?? docs/buglog/BUG_2025-12-31_admin-guilds-empty_ws-proxy_caddy-2019.md\n?? docs/buglog/BUG_2025-12-31_oauth-callback-self-redirect-prod.md\n?? docs/buglog/BUG_2025-12-31_post-login-wrong-domain.md\n?? docs/buglog/BUG_2026-01-02_repo-health-report-automation.md\n?? docs/reports/LATEST_nuc2.json\n?? docs/reports/README_report_automation.md\n?? docs/reports/REPORT_2026-01-02_2138_nuc2.html\n?? docs/reports/REPORT_2026-01-02_2138_nuc2.json\n?? docs/reports/vendor/\n?? scripts/report/vendor/"
  },
  "env": {
    "nodeVersion": "v20.19.6",
    "pnpmVersion": "10.21.0",
    "dockerVersion": "Docker version 28.2.2, build 28.2.2-0ubuntu1~24.04.1",
    "dockerComposeVersion": "Docker Compose version v2.27.0",
    "uname": "Linux slimy-nuc2 6.8.0-90-generic #91-Ubuntu SMP PREEMPT_DYNAMIC Tue Nov 18 14:14:30 UTC 2025 x86_64 x86_64 x86_64 GNU/Linux",
    "diskRoot": "Filesystem      Size  Used Avail Use% Mounted on\n/dev/sda2       219G  135G   74G  65% /"
  },
  "health": {
    "tests": {
      "ok": true,
      "output": "> slimy-monorepo@ test /opt/slimy/slimy-monorepo\n> pnpm -r run test || echo \"TODO: wire tests\"\n\nScope: 11 of 12 workspace projects\npackages/contracts test$ echo \"TODO: test contracts\"\npackages/shared-auth test$ vitest run\npackages/shared-codes test$ echo \"TODO: test shared-codes\"\npackages/shared-config test$ echo \"TODO: test shared-config\"\npackages/contracts test: TODO: test contracts\npackages/shared-codes test: TODO: test shared-codes\npackages/shared-config test: TODO: test shared-config\npackages/shared-codes test: Done\npackages/contracts test: Done\npackages/shared-config test: Done\npackages/shared-db test$ echo \"TODO: test shared-db\"\npackages/shared-snail test$ echo \"TODO: test shared-snail\"\npackages/shared-db test: TODO: test shared-db\npackages/shared-db test: Done\npackages/shared-snail test: TODO: test shared-snail\npackages/shared-snail test: Done\npackages/shared-auth test: \u001b[1m\u001b[46m RUN \u001b[49m\u001b[22m \u001b[36mv4.0.15 \u001b[39m\u001b[90m/opt/slimy/slimy-monorepo/packages/shared-auth\u001b[39m\npackages/shared-auth test:  \u001b[32m✓\u001b[39m src/index.test.ts \u001b[2m(\u001b[22m\u001b[2m41 tests\u001b[22m\u001b[2m)\u001b[22m\u001b[32m 66\u001b[2mms\u001b[22m\u001b[39m\npackages/shared-auth test: \u001b[2m Test Files \u001b[22m \u001b[1m\u001b[32m1 passed\u001b[39m\u001b[22m\u001b[90m (1)\u001b[39m\npackages/shared-auth test: \u001b[2m      Tests \u001b[22m \u001b[1m\u001b[32m41 passed\u001b[39m\u001b[22m\u001b[90m (41)\u001b[39m\npackages/shared-auth test: \u001b[2m   Start at \u001b[22m 21:54:15\npackages/shared-auth test: \u001b[2m   Duration \u001b[22m 999ms\u001b[2m (transform 376ms, setup 0ms, import 479ms, tests 66ms, environment 0ms)\u001b[22m\npackages/shared-auth test: Done\napps/admin-api test$ jest\napps/admin-ui test$ node tests/oauth-origin.test.js && node tests/oauth-tripwire.test.js && node tests/auth-callback-proxy.test.js && node tests/oauth-post-login-redirect-tripwire.test.js\napps/bot test$ vitest run\napps/web test$ vitest\napps/admin-ui test: [PASS] normalizeOrigin tests\napps/admin-ui test: [PASS] isLocalhostHostname tests\napps/admin-ui test: [PASS] firstHeader tests\napps/admin-ui test: [PASS] withForwardedPortIfMissing tests\napps/admin-ui test: [PASS] isAllowedOrigin tests (dev mode)\napps/admin-ui test: [PASS] isAllowedOrigin tests (production mode)\napps/admin-ui test: [oauth-origin] Origin not allowed, falling back: { derived: 'http://localhost:3080', fallback: 'http://localhost:3001' }\napps/admin-ui test: [oauth-origin] Origin not allowed, falling back: { derived: 'https://evil.com', fallback: 'http://localhost:3001' }\napps/admin-ui test: [PASS] getPublicOrigin tests\napps/admin-ui test: === All oauth-origin tests passed ===\napps/admin-ui test: [PASS] authorize-url canonical redirect_uri\napps/admin-ui test: [PASS] no legacy auth/proxy references in client bundle\napps/admin-ui test: === All oauth tripwires passed ===\napps/admin-ui test: [PASS] auth callback proxy tripwires\napps/admin-ui test: [PASS] oauth post-login redirect tripwires\napps/admin-ui test: Done\napps/bot test:  RUN  v1.6.1 /opt/slimy/slimy-monorepo/apps/bot\napps/web test: \u001b[1m\u001b[46m RUN \u001b[49m\u001b[22m \u001b[36mv4.0.15 \u001b[39m\u001b[90m/opt/slimy/slimy-monorepo/apps/web\u001b[39m\napps/bot test:  ✓ tests/utils/parsing.test.ts  (13 tests) 79ms\napps/bot test:  ✓ tests/logger.test.ts  (13 tests) 212ms\napps/bot test:  ✓ tests/errorHandler.test.ts  (9 tests) 194ms\napps/bot test:  ✓ tests/utils/stats.test.ts  (10 tests) 108ms\napps/bot test:  Test Files  4 passed (4)\napps/bot test:       Tests  45 passed (45)\napps/bot test:    Start at  21:54:19\napps/bot test:    Duration  6.55s (transform 1.75s, setup 19ms, collect 2.20s, tests 593ms, environment 1ms, prepare 5.07s)\napps/bot test: Done\napps/admin-api test: PASS tests/guilds-list-discord-error-mapping.test.js\napps/admin-api test:   GET /api/guilds (Discord failure mapping)\napps/admin-api test:     ✓ maps Discord 401/403 to 401 discord_token_invalid (172 ms)\napps/admin-api test:     ✓ maps Discord 429 to 429 discord_rate_limited (24 ms)\napps/admin-api test: PASS tests/guilds-list-botinstalled-fallback.test.js\napps/admin-api test:   GET /api/guilds (botInstalled fallback)\napps/admin-api test:     ✓ patches botInstalled=true for guilds present in DB (453 ms)\napps/admin-api test:   console.log\napps/admin-api test:     !!! AUTH LOGIC LOADED v304 (ACTIVE GUILD) !!!\napps/admin-api test:       at Object.log (src/routes/auth.js:21:9)\napps/web test: \u001b[90mstdout\u001b[2m | tests/unit/codes-cache.test.ts\u001b[2m > \u001b[22m\u001b[2mCodesCache\u001b[2m > \u001b[22m\u001b[2mconnection management\u001b[2m > \u001b[22m\u001b[2mshould connect successfully\napps/web test: \u001b[22m\u001b[39mRedis cache connected\napps/web test: Redis cache connected\napps/web test: \u001b[90mstderr\u001b[2m | tests/unit/codes-cache.test.ts\u001b[2m > \u001b[22m\u001b[2mCodesCache\u001b[2m > \u001b[22m\u001b[2mconnection management\u001b[2m > \u001b[22m\u001b[2mshould handle connection failures\napps/web test: \u001b[22m\u001b[39mFailed to connect to Redis: Error: Connection failed\napps/web test:     at \u001b[90m/opt/slimy/slimy-monorepo/apps/web/\u001b[39mtests/unit/codes-cache.test.ts:88:26\napps/web test:     at file:///opt/slimy/slimy-monorepo/node_modules/\u001b[4m.pnpm\u001b[24m/@vitest+runner@4.0.15/node_modules/\u001b[4m@vitest/runner\u001b[24m/dist/index.js:145:11\napps/web test:     at file:///opt/slimy/slimy-monorepo/node_modules/\u001b[4m.pnpm\u001b[24m/@vitest+runner@4.0.15/node_modules/\u001b[4m@vitest/runner\u001b[24m/dist/index.js:915:26\napps/web test:     at file:///opt/slimy/slimy-monorepo/node_modules/\u001b[4m.pnpm\u001b[24m/@vitest+runner@4.0.15/node_modules/\u001b[4m@vitest/runner\u001b[24m/dist/index.js:1240:20\napps/web test:     at new Promise (<anonymous>)\napps/web test:     at runWithTimeout (file:///opt/slimy/slimy-monorepo/node_modules/\u001b[4m.pnpm\u001b[24m/@vitest+runner@4.0.15/node_modules/\u001b[4m@vitest/runner\u001b[24m/dist/index.js:1206:10)\napps/web test:     at file:///opt/slimy/slimy-monorepo/node_modules/\u001b[4m.pnpm\u001b[24m/@vitest+runner@4.0.15/node_modules/\u001b[4m@vitest/runner\u001b[24m/dist/index.js:1650:37\napps/web test:     at Traces.$ (file:///opt/slimy/slimy-monorepo/node_modules/\u001b[4m.pnpm\u001b[24m/vitest@4.0.15_@opentelemetry+api@1.9.0_@types+node@20.19.25_@vitest+ui@4.0.15_jiti@2.6._6f4799287cc307d0b976628207bcb6be/node_modules/\u001b[4mvitest\u001b[24m/dist/chunks/traces.U4xDYhzZ.js:115:27)\napps/web test:     at trace (file:///opt/slimy/slimy-monorepo/node_modules/\u001b[4m.pnpm\u001b[24m/vitest@4.0.15_@opentelemetry+api@1.9.0_@types+node@20.19.25_@vitest+ui@4.0.15_jiti@2.6._6f4799287cc307d0b976628207bcb6be/node_modules/\u001b[4mvitest\u001b[24m/dist/chunks/test.BT8LKgU9.js:239:21)\napps/web test:     at runTest (file:///opt/slimy/slimy-monorepo/node_modules/\u001b[4m.pnpm\u001b[24m/@vitest+runner@4.0.15/node_modules/\u001b[4m@vitest/runner\u001b[24m/dist/index.js:1650:12)\napps/admin-api test:   console.warn\napps/admin-api test:     [auth/callback] State mismatch detail {\napps/admin-api test:       requestOrigin: 'https://admin.slimyai.xyz',\napps/admin-api test:       hasCode: true,\napps/admin-api test:       hasState: true,\napps/admin-api test:       hasSaved: false,\napps/admin-api test:       statePrefix: 'REDACT',\napps/admin-api test:       savedPrefix: null\napps/admin-api test:     }\napps/admin-api test:       347 |       clearCookie(req, res, \"oauth_redirect_uri\");\napps/admin-api test:       348 |       if (shouldDebugAuth()) {\napps/admin-api test:     > 349 |         console.warn(\"[auth/callback] State mismatch detail\", {\napps/admin-api test:           |                 ^\napps/admin-api test:       350 |           requestOrigin: getRequestOrigin(req),\napps/admin-api test:       351 |           hasCode: Boolean(code),\napps/admin-api test:       352 |           hasState: Boolean(state),\napps/admin-api test:       at warn (src/routes/auth.js:349:17)\napps/admin-api test:       at Layer.handle [as handle_request] (../../node_modules/.pnpm/express@4.22.1/node_modules/express/lib/router/layer.js:95:5)\napps/admin-api test:       at next (../../node_modules/.pnpm/express@4.22.1/node_modules/express/lib/router/route.js:149:13)\napps/admin-api test:       at Route.dispatch (../../node_modules/.pnpm/express@4.22.1/node_modules/express/lib/router/route.js:119:3)\napps/admin-api test:       at Layer.handle [as handle_request] (../../node_modules/.pnpm/express@4.22.1/node_modules/express/lib/router/layer.js:95:5)\napps/admin-api test:       at ../../node_modules/.pnpm/express@4.22.1/node_modules/express/lib/router/index.js:284:15\napps/admin-api test:       at Function.process_params (../../node_modules/.pnpm/express@4.22.1/node_modules/express/lib/router/index.js:346:12)\napps/admin-api test:       at next (../../node_modules/.pnpm/express@4.22.1/node_modules/express/lib/router/index.js:280:10)\napps/admin-api test:       at Function.handle (../../node_modules/.pnpm/express@4.22.1/node_modules/express/lib/router/index.js:175:3)\napps/admin-api test:       at router (../../node_modules/.pnpm/express@4.22.1/node_modules/express/lib/router/index.js:47:12)\napps/admin-api test:       at Layer.handle [as handle_request] (../../node_modules/.pnpm/express@4.22.1/node_modules/express/lib/router/layer.js:95:5)\napps/admin-api test:       at trim_prefix (../../node_modules/.pnpm/express@4.22.1/node_modules/express/lib/router/index.js:328:13)\napps/admin-api test:       at ../../node_modules/.pnpm/express@4.22.1/node_modules/express/lib/router/index.js:286:9\napps/admin-api test:       at Function.process_params (../../node_modules/.pnpm/express@4.22.1/node_modules/express/lib/router/index.js:346:12)\napps/admin-api test:       at next (../../node_modules/.pnpm/express@4.22.1/node_modules/express/lib/router/index.js:280:10)\napps/admin-api test:       at cookieParser (../../node_modules/.pnpm/cookie-parser@1.4.7/node_modules/cookie-parser/index.js:57:14)\napps/admin-api test:       at Layer.handle [as handle_request] (../../node_modules/.pnpm/express@4.22.1/node_modules/express/lib/router/layer.js:95:5)\napps/admin-api test:       at trim_prefix (../../node_modules/.pnpm/express@4.22.1/node_modules/express/lib/router/index.js:328:13)\napps/admin-api test:       at ../../node_modules/.pnpm/express@4.22.1/node_modules/express/lib/router/index.js:286:9\napps/admin-api test:       at Function.process_params (../../node_modules/.pnpm/express@4.22.1/node_modules/express/lib/router/index.js:346:12)\napps/admin-api test:       at next (../../node_modules/.pnpm/express@4.22.1/node_modules/express/lib/router/index.js:280:10)\napps/admin-api test:       at expressInit (../../node_modules/.pnpm/express@4.22.1/node_modules/express/lib/middleware/init.js:40:5)\napps/admin-api test:       at Layer.handle [as handle_request] (../../node_modules/.pnpm/express@4.22.1/node_modules/express/lib/router/layer.js:95:5)\napps/admin-api test:       at trim_prefix (../../node_modules/.pnpm/express@4.22.1/node_modules/express/lib/router/index.js:328:13)\napps/admin-api test:       at ../../node_modules/.pnpm/express@4.22.1/node_modules/express/lib/router/index.js:286:9\napps/admin-api test:       at Function.process_params (../../node_modules/.pnpm/express@4.22.1/node_modules/express/lib/router/index.js:346:12)\napps/admin-api test:       at next (../../node_modules/.pnpm/express@4.22.1/node_modules/express/lib/router/index.js:280:10)\napps/admin-api test:       at query (../../node_modules/.pnpm/express@4.22.1/node_modules/express/lib/middleware/query.js:45:5)\napps/admin-api test:       at Layer.handle [as handle_request] (../../node_modules/.pnpm/express@4.22.1/node_modules/express/lib/router/layer.js:95:5)\napps/admin-api test:       at trim_prefix (../../node_modules/.pnpm/express@4.22.1/node_modules/express/lib/router/index.js:328:13)\napps/admin-api test:       at ../../node_modules/.pnpm/express@4.22.1/node_modules/express/lib/router/index.js:286:9\napps/admin-api test:       at Function.process_params (../../node_modules/.pnpm/express@4.22.1/node_modules/express/lib/router/index.js:346:12)\napps/admin-api test:       at next (../../node_modules/.pnpm/express@4.22.1/node_modules/express/lib/router/index.js:280:10)\napps/admin-api test:       at Function.handle (../../node_modules/.pnpm/express@4.22.1/node_modules/express/lib/router/index.js:175:3)\napps/admin-api test:       at Function.handle (../../node_modules/.pnpm/express@4.22.1/node_modules/express/lib/application.js:181:10)\napps/admin-api test:       at Server.app (../../node_modules/.pnpm/express@4.22.1/node_modules/express/lib/express.js:39:9)\napps/web test: \u001b[90mstderr\u001b[2m | tests/unit/codes-cache.test.ts\u001b[2m > \u001b[22m\u001b[2mCodesCache\u001b[2m > \u001b[22m\u001b[2mcache operations\u001b[2m > \u001b[22m\u001b[2mshould handle cache set failures\napps/web test: \u001b[22m\u001b[39mCache set attempt 1 failed: Error: Set failed\napps/web test:     at \u001b[90m/opt/slimy/slimy-monorepo/apps/web/\u001b[39mtests/unit/codes-cache.test.ts:143:47\napps/web test:     at file:///opt/slimy/slimy-monorepo/node_modules/\u001b[4m.pnpm\u001b[24m/@vitest+runner@4.0.15/node_modules/\u001b[4m@vitest/runner\u001b[24m/dist/index.js:145:11\napps/web test:     at file:///opt/slimy/slimy-monorepo/node_modules/\u001b[4m.pnpm\u001b[24m/@vitest+runner@4.0.15/node_modules/\u001b[4m@vitest/runner\u001b[24m/dist/index.js:915:26\napps/web test:     at file:///opt/slimy/slimy-monorepo/node_modules/\u001b[4m.pnpm\u001b[24m/@vitest+runner@4.0.15/node_modules/\u001b[4m@vitest/runner\u001b[24m/dist/index.js:1240:20\napps/web test:     at new Promise (<anonymous>)\napps/web test:     at runWithTimeout (file:///opt/slimy/slimy-monorepo/node_modules/\u001b[4m.pnpm\u001b[24m/@vitest+runner@4.0.15/node_modules/\u001b[4m@vitest/runner\u001b[24m/dist/index.js:1206:10)\napps/web test:     at file:///opt/slimy/slimy-monorepo/node_modules/\u001b[4m.pnpm\u001b[24m/@vitest+runner@4.0.15/node_modules/\u001b[4m@vitest/runner\u001b[24m/dist/index.js:1650:37\napps/web test:     at Traces.$ (file:///opt/slimy/slimy-monorepo/node_modules/\u001b[4m.pnpm\u001b[24m/vitest@4.0.15_@opentelemetry+api@1.9.0_@types+node@20.19.25_@vitest+ui@4.0.15_jiti@2.6._6f4799287cc307d0b976628207bcb6be/node_modules/\u001b[4mvitest\u001b[24m/dist/chunks/traces.U4xDYhzZ.js:115:27)\napps/web test:     at trace (file:///opt/slimy/slimy-monorepo/node_modules/\u001b[4m.pnpm\u001b[24m/vitest@4.0.15_@opentelemetry+api@1.9.0_@types+node@20.19.25_@vitest+ui@4.0.15_jiti@2.6._6f4799287cc307d0b976628207bcb6be/node_modules/\u001b[4mvitest\u001b[24m/dist/chunks/test.BT8LKgU9.js:239:21)\napps/web test:     at runTest (file:///opt/slimy/slimy-monorepo/node_modules/\u001b[4m.pnpm\u001b[24m/@vitest+runner@4.0.15/node_modules/\u001b[4m@vitest/runner\u001b[24m/dist/index.js:1650:12)\napps/admin-api test: PASS src/routes/auth-callback-loop.test.js\napps/admin-api test:   discord oauth callback (redirect loop guard)\napps/admin-api test:     ✓ does not 302 back to /api/auth/callback on canonical admin origin (1830 ms)\napps/admin-api test:     ✓ supports ?debug=1 without redirecting (106 ms)\napps/admin-api test:     ✓ debug mode loop-guards ADMIN_UI_POST_LOGIN_REDIRECT when it points at the callback (63 ms)\napps/web test: \u001b[90mstderr\u001b[2m | tests/unit/codes-cache.test.ts\u001b[2m > \u001b[22m\u001b[2mCodesCache\u001b[2m > \u001b[22m\u001b[2mcache operations\u001b[2m > \u001b[22m\u001b[2mshould handle cache set failures\napps/web test: \u001b[22m\u001b[39mCache set attempt 2 failed: Error: Set failed\napps/web test:     at \u001b[90m/opt/slimy/slimy-monorepo/apps/web/\u001b[39mtests/unit/codes-cache.test.ts:143:47\napps/web test:     at file:///opt/slimy/slimy-monorepo/node_modules/\u001b[4m.pnpm\u001b[24m/@vitest+runner@4.0.15/node_modules/\u001b[4m@vitest/runner\u001b[24m/dist/index.js:145:11\napps/web test:     at file:///opt/slimy/slimy-monorepo/node_modules/\u001b[4m.pnpm\u001b[24m/@vitest+runner@4.0.15/node_modules/\u001b[4m@vitest/runner\u001b[24m/dist/index.js:915:26\napps/web test:     at file:///opt/slimy/slimy-monorepo/node_modules/\u001b[4m.pnpm\u001b[24m/@vitest+runner@4.0.15/node_modules/\u001b[4m@vitest/runner\u001b[24m/dist/index.js:1240:20\napps/web test:     at new Promise (<anonymous>)\napps/web test:     at runWithTimeout (file:///opt/slimy/slimy-monorepo/node_modules/\u001b[4m.pnpm\u001b[24m/@vitest+runner@4.0.15/node_modules/\u001b[4m@vitest/runner\u001b[24m/dist/index.js:1206:10)\napps/web test:     at file:///opt/slimy/slimy-monorepo/node_modules/\u001b[4m.pnpm\u001b[24m/@vitest+runner@4.0.15/node_modules/\u001b[4m@vitest/runner\u001b[24m/dist/index.js:1650:37\napps/web test:     at Traces.$ (file:///opt/slimy/slimy-monorepo/node_modules/\u001b[4m.pnpm\u001b[24m/vitest@4.0.15_@opentelemetry+api@1.9.0_@types+node@20.19.25_@vitest+ui@4.0.15_jiti@2.6._6f4799287cc307d0b976628207bcb6be/node_modules/\u001b[4mvitest\u001b[24m/dist/chunks/traces.U4xDYhzZ.js:115:27)\napps/web test:     at trace (file:///opt/slimy/slimy-monorepo/node_modules/\u001b[4m.pnpm\u001b[24m/vitest@4.0.15_@opentelemetry+api@1.9.0_@types+node@20.19.25_@vitest+ui@4.0.15_jiti@2.6._6f4799287cc307d0b976628207bcb6be/node_modules/\u001b[4mvitest\u001b[24m/dist/chunks/test.BT8LKgU9.js:239:21)\napps/web test:     at runTest (file:///opt/slimy/slimy-monorepo/node_modules/\u001b[4m.pnpm\u001b[24m/@vitest+runner@4.0.15/node_modules/\u001b[4m@vitest/runner\u001b[24m/dist/index.js:1650:12)\napps/admin-api test:   console.log\napps/admin-api test:     !!! AUTH LOGIC LOADED v304 (ACTIVE GUILD) !!!\napps/admin-api test:       at Object.log (src/routes/auth.js:21:9)\napps/admin-api test:   console.info\napps/admin-api test:     [admin-api] readAuth: cookie missing { cookieName: 'slimy_admin_token' }\napps/admin-api test:       at info (src/middleware/auth.js:22:13)\napps/admin-api test:   console.log\napps/admin-api test:     !!! AUTH LOGIC LOADED v304 (ACTIVE GUILD) !!!\napps/admin-api test:       at Object.log (src/routes/auth.js:21:9)\napps/admin-api test: PASS tests/settings-sync-events-v02.test.js\napps/admin-api test:   settings sync events v0.2\napps/admin-api test:     ✓ PUT /api/settings/user/:userId writes a settings change event (344 ms)\napps/admin-api test:     ✓ GET /api/settings/changes-v0 returns events for the caller's user scope (62 ms)\napps/admin-api test:     ✓ GET /api/settings/changes-v0 forbids cross-user reads (40 ms)\napps/admin-api test:     ✓ PUT /api/settings/guild/:guildId writes a settings change event (internal bot authz) (56 ms)\napps/admin-api test:     ✓ GET /api/settings/changes-v0 returns guild-scoped events for authorized internal bot context (48 ms)\napps/admin-api test:     ✓ GET /api/settings/changes-v0 forbids cross-guild reads for internal bot context (43 ms)\napps/admin-api test:     ✓ GET /api/settings/changes-v0 rejects invalid kind filter (20 ms)\napps/admin-api test:     ✓ GET /api/settings/changes-v0 requires auth (332 ms)\napps/admin-api test:     ✓ GET /api/settings/changes-v0 validates cursor/limit inputs (58 ms)\napps/admin-api test:     ✓ GET /api/settings/changes-v0 uses default limit, returns nextSinceId=sinceId when empty (41 ms)\napps/admin-api test:     ✓ GET /api/settings/changes-v0 caps limit to 200 and coerces limit=0 to 1 (46 ms)\napps/admin-api test:     ✓ GET /api/settings/changes-v0 without sinceId returns oldest-first order (27 ms)\napps/admin-api test:     ✓ GET /api/settings/changes-v0 applies kind filter to the DB query (19 ms)\napps/admin-api test:   console.warn\napps/admin-api test:     [auth/active-guild] Bot membership check failed: Discord API error\napps/admin-api test:       1022 |         botInstalled = await botInstalledInGuild(normalizedGuildId, botToken);\napps/admin-api test:       1023 |       } catch (err) {\napps/admin-api test:     > 1024 |         console.warn(\"[auth/active-guild] Bot membership check failed:\", err?.message || err);\napps/admin-api test:            |                 ^\napps/admin-api test:       1025 |         botInstalled = null;\napps/admin-api test:       1026 |       }\napps/admin-api test:       1027 |     }\napps/admin-api test:       at warn (src/routes/auth.js:1024:17)\napps/admin-api test: PASS tests/auth/active-guild.cookie.test.js\napps/admin-api test:   POST /api/auth/active-guild cookie\napps/admin-api test:     ✓ sets slimy_admin_active_guild_id on success (247 ms)\napps/admin-api test:     ✓ sets cookie even when bot not installed (selection is allowed) (45 ms)\napps/admin-api test: PASS tests/auth/active-guild.test.js\napps/admin-api test:   POST /api/auth/active-guild\napps/admin-api test:     ✓ allows selecting manageable guild even when bot not installed (303 ms)\napps/admin-api test:     ✓ allows selection when bot membership check fails (no retry-spam 400) (87 ms)\napps/admin-api test:     ✓ allows selection when bot token is missing (34 ms)\napps/admin-api test:     ✓ succeeds when bot is installed in guild (40 ms)\napps/admin-api test:     ✓ returns role for primary guild based on policy logic (53 ms)\napps/admin-api test:     ✓ normalizes guildId to string (33 ms)\napps/admin-api test:     ✓ rejects selecting a guild not present in the user's Discord guild list (31 ms)\napps/admin-api test:     ✓ returns 401 when Discord access token is invalid/expired (18 ms)\napps/admin-api test:     ✓ returns 429 when Discord rate-limits and no DB fallback exists (41 ms)\napps/admin-api test:     ✓ allows selection when Discord rate-limits but DB fallback exists (31 ms)\napps/web test: \u001b[90mstderr\u001b[2m | tests/unit/codes-cache.test.ts\u001b[2m > \u001b[22m\u001b[2mCodesCache\u001b[2m > \u001b[22m\u001b[2mcache operations\u001b[2m > \u001b[22m\u001b[2mshould handle cache set failures\napps/web test: \u001b[22m\u001b[39mCache set attempt 3 failed: Error: Set failed\napps/web test:     at \u001b[90m/opt/slimy/slimy-monorepo/apps/web/\u001b[39mtests/unit/codes-cache.test.ts:143:47\napps/web test:     at file:///opt/slimy/slimy-monorepo/node_modules/\u001b[4m.pnpm\u001b[24m/@vitest+runner@4.0.15/node_modules/\u001b[4m@vitest/runner\u001b[24m/dist/index.js:145:11\napps/web test:     at file:///opt/slimy/slimy-monorepo/node_modules/\u001b[4m.pnpm\u001b[24m/@vitest+runner@4.0.15/node_modules/\u001b[4m@vitest/runner\u001b[24m/dist/index.js:915:26\napps/web test:     at file:///opt/slimy/slimy-monorepo/node_modules/\u001b[4m.pnpm\u001b[24m/@vitest+runner@4.0.15/node_modules/\u001b[4m@vitest/runner\u001b[24m/dist/index.js:1240:20\napps/web test:     at new Promise (<anonymous>)\napps/web test:     at runWithTimeout (file:///opt/slimy/slimy-monorepo/node_modules/\u001b[4m.pnpm\u001b[24m/@vitest+runner@4.0.15/node_modules/\u001b[4m@vitest/runner\u001b[24m/dist/index.js:1206:10)\napps/web test:     at file:///opt/slimy/slimy-monorepo/node_modules/\u001b[4m.pnpm\u001b[24m/@vitest+runner@4.0.15/node_modules/\u001b[4m@vitest/runner\u001b[24m/dist/index.js:1650:37\napps/web test:     at Traces.$ (file:///opt/slimy/slimy-monorepo/node_modules/\u001b[4m.pnpm\u001b[24m/vitest@4.0.15_@opentelemetry+api@1.9.0_@types+node@20.19.25_@vitest+ui@4.0.15_jiti@2.6._6f4799287cc307d0b976628207bcb6be/node_modules/\u001b[4mvitest\u001b[24m/dist/chunks/traces.U4xDYhzZ.js:115:27)\napps/web test:     at trace (file:///opt/slimy/slimy-monorepo/node_modules/\u001b[4m.pnpm\u001b[24m/vitest@4.0.15_@opentelemetry+api@1.9.0_@types+node@20.19.25_@vitest+ui@4.0.15_jiti@2.6._6f4799287cc307d0b976628207bcb6be/node_modules/\u001b[4mvitest\u001b[24m/dist/chunks/test.BT8LKgU9.js:239:21)\napps/web test:     at runTest (file:///opt/slimy/slimy-monorepo/node_modules/\u001b[4m.pnpm\u001b[24m/@vitest+runner@4.0.15/node_modules/\u001b[4m@vitest/runner\u001b[24m/dist/index.js:1650:12)\napps/web test: Cache set failed after 3 attempts\napps/web test: \u001b[90mstderr\u001b[2m | tests/unit/codes-cache.test.ts\u001b[2m > \u001b[22m\u001b[2mCodesCache\u001b[2m > \u001b[22m\u001b[2merror handling\u001b[2m > \u001b[22m\u001b[2mshould handle redis operation failures gracefully\napps/web test: \u001b[22m\u001b[39mCache get attempt 1 failed: Error: Redis error\napps/web test:     at \u001b[90m/opt/slimy/slimy-monorepo/apps/web/\u001b[39mtests/unit/codes-cache.test.ts:184:45\napps/web test:     at file:///opt/slimy/slimy-monorepo/node_modules/\u001b[4m.pnpm\u001b[24m/@vitest+runner@4.0.15/node_modules/\u001b[4m@vitest/runner\u001b[24m/dist/index.js:145:11\napps/web test:     at file:///opt/slimy/slimy-monorepo/node_modules/\u001b[4m.pnpm\u001b[24m/@vitest+runner@4.0.15/node_modules/\u001b[4m@vitest/runner\u001b[24m/dist/index.js:915:26\napps/web test:     at file:///opt/slimy/slimy-monorepo/node_modules/\u001b[4m.pnpm\u001b[24m/@vitest+runner@4.0.15/node_modules/\u001b[4m@vitest/runner\u001b[24m/dist/index.js:1240:20\napps/web test:     at new Promise (<anonymous>)\napps/web test:     at runWithTimeout (file:///opt/slimy/slimy-monorepo/node_modules/\u001b[4m.pnpm\u001b[24m/@vitest+runner@4.0.15/node_modules/\u001b[4m@vitest/runner\u001b[24m/dist/index.js:1206:10)\napps/web test:     at file:///opt/slimy/slimy-monorepo/node_modules/\u001b[4m.pnpm\u001b[24m/@vitest+runner@4.0.15/node_modules/\u001b[4m@vitest/runner\u001b[24m/dist/index.js:1650:37\napps/web test:     at Traces.$ (file:///opt/slimy/slimy-monorepo/node_modules/\u001b[4m.pnpm\u001b[24m/vitest@4.0.15_@opentelemetry+api@1.9.0_@types+node@20.19.25_@vitest+ui@4.0.15_jiti@2.6._6f4799287cc307d0b976628207bcb6be/node_modules/\u001b[4mvitest\u001b[24m/dist/chunks/traces.U4xDYhzZ.js:115:27)\napps/web test:     at trace (file:///opt/slimy/slimy-monorepo/node_modules/\u001b[4m.pnpm\u001b[24m/vitest@4.0.15_@opentelemetry+api@1.9.0_@types+node@20.19.25_@vitest+ui@4.0.15_jiti@2.6._6f4799287cc307d0b976628207bcb6be/node_modules/\u001b[4mvitest\u001b[24m/dist/chunks/test.BT8LKgU9.js:239:21)\napps/web test:     at runTest (file:///opt/slimy/slimy-monorepo/node_modules/\u001b[4m.pnpm\u001b[24m/@vitest+runner@4.0.15/node_modules/\u001b[4m@vitest/runner\u001b[24m/dist/index.js:1650:12)\napps/admin-api test: PASS tests/settings-memory-v0.test.js\napps/admin-api test:   settings+memory v0 bridge\napps/admin-api test:     ✓ GET /api/settings/user/:userId auto-inits canonical settings (86 ms)\napps/admin-api test:     ✓ internal bot auth can write self user settings (requires internal token + csrf) (66 ms)\napps/admin-api test:     ✓ GET /api/settings/user/:userId forbids cross-user access (19 ms)\napps/admin-api test:     ✓ PUT /api/settings/user/:userId validates schema (22 ms)\napps/admin-api test:     ✓ GET /api/memory/user/:scopeId forbids cross-user access (24 ms)\napps/admin-api test:     ✓ POST /api/memory/user/:scopeId rejects project_state for non-admins (37 ms)\napps/admin-api test:     ✓ POST /api/memory/guild/:scopeId rejects profile_summary (user-scope only) (38 ms)\napps/admin-api test:     ✓ POST /api/memory/:scopeType/:scopeId rejects secret-like keys and oversized payloads (93 ms)\napps/admin-api test:   console.error\napps/admin-api test:     [guilds/connect] Missing SLIMYAI_BOT_TOKEN\napps/admin-api test:       176 |       const SLIMYAI_BOT_TOKEN = getSlimyBotToken();\napps/admin-api test:       177 |       if (!SLIMYAI_BOT_TOKEN) {\napps/admin-api test:     > 178 |         console.error(\"[guilds/connect] Missing SLIMYAI_BOT_TOKEN\");\napps/admin-api test:           |                 ^\napps/admin-api test:       179 |         return res.status(500).json({ error: \"MISSING_SLIMYAI_BOT_TOKEN\" });\napps/admin-api test:       180 |       }\napps/admin-api test:       181 |\napps/admin-api test:       at error (src/routes/guilds.js:178:17)\napps/admin-api test:       at Layer.handle [as handle_request] (../../node_modules/.pnpm/express@4.22.1/node_modules/express/lib/router/layer.js:95:5)\napps/admin-api test:       at next (../../node_modules/.pnpm/express@4.22.1/node_modules/express/lib/router/route.js:149:13)\napps/admin-api test:       at next (tests/guild-connect.test.js:24:5)\napps/admin-api test:       at Layer.handle [as handle_request] (../../node_modules/.pnpm/express@4.22.1/node_modules/express/lib/router/layer.js:95:5)\napps/admin-api test:       at next (../../node_modules/.pnpm/express@4.22.1/node_modules/express/lib/router/route.js:149:13)\napps/admin-api test:       at next (tests/guild-connect.test.js:11:5)\napps/admin-api test:       at Layer.handle [as handle_request] (../../node_modules/.pnpm/express@4.22.1/node_modules/express/lib/router/layer.js:95:5)\napps/admin-api test:       at next (../../node_modules/.pnpm/express@4.22.1/node_modules/express/lib/router/route.js:149:13)\napps/admin-api test:       at Route.dispatch (../../node_modules/.pnpm/express@4.22.1/node_modules/express/lib/router/route.js:119:3)\napps/admin-api test:       at Layer.handle [as handle_request] (../../node_modules/.pnpm/express@4.22.1/node_modules/express/lib/router/layer.js:95:5)\napps/admin-api test:       at ../../node_modules/.pnpm/express@4.22.1/node_modules/express/lib/router/index.js:284:15\napps/admin-api test:       at Function.process_params (../../node_modules/.pnpm/express@4.22.1/node_modules/express/lib/router/index.js:346:12)\napps/admin-api test:       at next (../../node_modules/.pnpm/express@4.22.1/node_modules/express/lib/router/index.js:280:10)\napps/admin-api test:       at next (tests/guild-connect.test.js:11:5)\napps/admin-api test:       at Layer.handle [as handle_request] (../../node_modules/.pnpm/express@4.22.1/node_modules/express/lib/router/layer.js:95:5)\napps/admin-api test:       at trim_prefix (../../node_modules/.pnpm/express@4.22.1/node_modules/express/lib/router/index.js:328:13)\napps/admin-api test:       at ../../node_modules/.pnpm/express@4.22.1/node_modules/express/lib/router/index.js:286:9\napps/admin-api test:       at Function.process_params (../../node_modules/.pnpm/express@4.22.1/node_modules/express/lib/router/index.js:346:12)\napps/admin-api test:       at next (../../node_modules/.pnpm/express@4.22.1/node_modules/express/lib/router/index.js:280:10)\napps/admin-api test:       at Function.handle (../../node_modules/.pnpm/express@4.22.1/node_modules/express/lib/router/index.js:175:3)\napps/admin-api test:       at router (../../node_modules/.pnpm/express@4.22.1/node_modules/express/lib/router/index.js:47:12)\napps/admin-api test:       at Layer.handle [as handle_request] (../../node_modules/.pnpm/express@4.22.1/node_modules/express/lib/router/layer.js:95:5)\napps/admin-api test:       at trim_prefix (../../node_modules/.pnpm/express@4.22.1/node_modules/express/lib/router/index.js:328:13)\napps/admin-api test:       at ../../node_modules/.pnpm/express@4.22.1/node_modules/express/lib/router/index.js:286:9\napps/admin-api test:       at Function.process_params (../../node_modules/.pnpm/express@4.22.1/node_modules/express/lib/router/index.js:346:12)\napps/admin-api test:       at next (../../node_modules/.pnpm/express@4.22.1/node_modules/express/lib/router/index.js:280:10)\napps/admin-api test:       at ../../node_modules/.pnpm/body-parser@1.20.4/node_modules/body-parser/lib/read.js:137:5\napps/admin-api test:       at invokeCallback (../../node_modules/.pnpm/raw-body@2.5.3/node_modules/raw-body/index.js:238:16)\napps/admin-api test:       at done (../../node_modules/.pnpm/raw-body@2.5.3/node_modules/raw-body/index.js:227:7)\napps/admin-api test:       at IncomingMessage.onEnd (../../node_modules/.pnpm/raw-body@2.5.3/node_modules/raw-body/index.js:287:7)\napps/admin-api test: PASS tests/guild-connect.test.js\napps/admin-api test:   POST /guilds/connect\napps/admin-api test:     ✓ should fail if SLIMYAI_BOT_TOKEN is missing (205 ms)\napps/admin-api test:     ✓ should return 403 USER_NOT_IN_GUILD if user is not in guild (24 ms)\napps/admin-api test:     ✓ should return 403 BOT_NOT_IN_GUILD if bot is not in guild (Owned Only) (35 ms)\napps/admin-api test:     ✓ should succeed if guild is shared (51 ms)\napps/web test: \u001b[90mstderr\u001b[2m | tests/unit/codes-cache.test.ts\u001b[2m > \u001b[22m\u001b[2mCodesCache\u001b[2m > \u001b[22m\u001b[2merror handling\u001b[2m > \u001b[22m\u001b[2mshould handle redis operation failures gracefully\napps/web test: \u001b[22m\u001b[39mCache get attempt 2 failed: Error: Redis error\napps/web test:     at \u001b[90m/opt/slimy/slimy-monorepo/apps/web/\u001b[39mtests/unit/codes-cache.test.ts:184:45\napps/web test:     at file:///opt/slimy/slimy-monorepo/node_modules/\u001b[4m.pnpm\u001b[24m/@vitest+runner@4.0.15/node_modules/\u001b[4m@vitest/runner\u001b[24m/dist/index.js:145:11\napps/web test:     at file:///opt/slimy/slimy-monorepo/node_modules/\u001b[4m.pnpm\u001b[24m/@vitest+runner@4.0.15/node_modules/\u001b[4m@vitest/runner\u001b[24m/dist/index.js:915:26\napps/web test:     at file:///opt/slimy/slimy-monorepo/node_modules/\u001b[4m.pnpm\u001b[24m/@vitest+runner@4.0.15/node_modules/\u001b[4m@vitest/runner\u001b[24m/dist/index.js:1240:20\napps/web test:     at new Promise (<anonymous>)\napps/web test:     at runWithTimeout (file:///opt/slimy/slimy-monorepo/node_modules/\u001b[4m.pnpm\u001b[24m/@vitest+runner@4.0.15/node_modules/\u001b[4m@vitest/runner\u001b[24m/dist/index.js:1206:10)\napps/web test:     at file:///opt/slimy/slimy-monorepo/node_modules/\u001b[4m.pnpm\u001b[24m/@vitest+runner@4.0.15/node_modules/\u001b[4m@vitest/runner\u001b[24m/dist/index.js:1650:37\napps/web test:     at Traces.$ (file:///opt/slimy/slimy-monorepo/node_modules/\u001b[4m.pnpm\u001b[24m/vitest@4.0.15_@opentelemetry+api@1.9.0_@types+node@20.19.25_@vitest+ui@4.0.15_jiti@2.6._6f4799287cc307d0b976628207bcb6be/node_modules/\u001b[4mvitest\u001b[24m/dist/chunks/traces.U4xDYhzZ.js:115:27)\napps/web test:     at trace (file:///opt/slimy/slimy-monorepo/node_modules/\u001b[4m.pnpm\u001b[24m/vitest@4.0.15_@opentelemetry+api@1.9.0_@types+node@20.19.25_@vitest+ui@4.0.15_jiti@2.6._6f4799287cc307d0b976628207bcb6be/node_modules/\u001b[4mvitest\u001b[24m/dist/chunks/test.BT8LKgU9.js:239:21)\napps/web test:     at runTest (file:///opt/slimy/slimy-monorepo/node_modules/\u001b[4m.pnpm\u001b[24m/@vitest+runner@4.0.15/node_modules/\u001b[4m@vitest/runner\u001b[24m/dist/index.js:1650:12)\napps/admin-api test: PASS tests/guilds-connect.test.js\napps/admin-api test:   POST /api/guilds/connect\napps/admin-api test:     ✓ should return 200 when connecting with valid frontend payload (131 ms)\napps/admin-api test:     ✓ should return 200 if guild is ALREADY connected (184 ms)\napps/admin-api test:     ✓ should return 400 if guild ID is missing (37 ms)\napps/admin-api test:   guildService.connectGuild\napps/admin-api test:     ✓ upserts owner by discord id and links guild to the owner (11 ms)\napps/admin-api test:   console.info\napps/admin-api test:     [admin-api] readAuth: cookie missing { cookieName: 'slimy_admin_token' }\napps/admin-api test:       at info (src/middleware/auth.js:22:13)\napps/admin-api test:   console.info\napps/admin-api test:     [admin-api] readAuth: cookie present { cookieName: 'slimy_admin_token' }\napps/admin-api test:       at info (src/middleware/auth.js:22:13)\napps/admin-api test:   console.info\napps/admin-api test:     [admin-api] readAuth: token verification failed { error: 'jwt malformed' }\napps/admin-api test:       at info (src/middleware/auth.js:22:13)\napps/admin-api test:   console.info\napps/admin-api test:     [admin-api] readAuth: cookie present { cookieName: 'slimy_admin' }\napps/admin-api test:       at info (src/middleware/auth.js:22:13)\napps/admin-api test:   console.info\napps/admin-api test:     [admin-api] readAuth: user hydrated { userId: 'test-user' }\napps/admin-api test:       at info (src/middleware/auth.js:22:13)\napps/admin-api test:   console.info\napps/admin-api test:     [admin-api] readAuth: cookie present { cookieName: 'slimy_admin_token' }\napps/admin-api test:       at info (src/middleware/auth.js:22:13)\napps/admin-api test:   console.info\napps/admin-api test:     [admin-api] readAuth: user hydrated { userId: 'test-user' }\napps/admin-api test:       at info (src/middleware/auth.js:22:13)\napps/admin-api test:   console.info\napps/admin-api test:     [admin-api] readAuth: cookie present { cookieName: 'slimy_admin_token' }\napps/admin-api test:       at info (src/middleware/auth.js:22:13)\napps/admin-api test:   console.info\napps/admin-api test:     [admin-api] readAuth: user hydrated { userId: 'test-user' }\napps/admin-api test:       at info (src/middleware/auth.js:22:13)\napps/admin-api test:   console.info\napps/admin-api test:     [admin-api] readAuth: cookie present { cookieName: 'slimy_admin_token' }\napps/admin-api test:       at info (src/middleware/auth.js:22:13)\napps/admin-api test:   console.info\napps/admin-api test:     [admin-api] readAuth: user hydrated { userId: 'test-user' }\napps/admin-api test:       at info (src/middleware/auth.js:22:13)\napps/admin-api test: PASS tests/settings-auth-500-v0.test.js\napps/admin-api test:   web-settings-auth-500-v0 regression\napps/admin-api test:     ✓ GET /api/settings/user/:userId returns settings for authed self (90 ms)\napps/admin-api test:     ✓ GET /api/settings/user/:userId forbids cross-user reads (22 ms)\napps/admin-api test:     ✓ GET /api/settings/changes-v0 returns events for authed self (user scope) (27 ms)\napps/admin-api test:     ✓ GET /api/settings/changes-v0 returns events for platform admin (guild scope) (27 ms)\napps/admin-api test:   console.info\napps/admin-api test:     [admin-api] readAuth: cookie missing { cookieName: 'slimy_admin_token' }\napps/admin-api test:       at info (src/middleware/auth.js:22:13)\napps/admin-api test:   console.info\napps/admin-api test:     [admin-api] readAuth: cookie present { cookieName: 'slimy_admin_token' }\napps/admin-api test:       at info (src/middleware/auth.js:22:13)\napps/admin-api test:   console.info\napps/admin-api test:     [admin-api] readAuth: user hydrated { userId: 'test-user' }\napps/admin-api test:       at info (src/middleware/auth.js:22:13)\napps/admin-api test:   console.info\napps/admin-api test:     [admin-api] readAuth: cookie present { cookieName: 'slimy_admin_token' }\napps/admin-api test:       at info (src/middleware/auth.js:22:13)\napps/admin-api test:   console.info\napps/admin-api test:     [admin-api] readAuth: user hydrated { userId: 'test-admin' }\napps/admin-api test:       at info (src/middleware/auth.js:22:13)\napps/admin-api test:   console.info\napps/admin-api test:     [admin-api] readAuth: cookie present { cookieName: 'slimy_admin_token' }\napps/admin-api test:       at info (src/middleware/auth.js:22:13)\napps/admin-api test:   console.info\napps/admin-api test:     [admin-api] readAuth: user hydrated { userId: 'test-member' }\napps/admin-api test:       at info (src/middleware/auth.js:22:13)\napps/admin-api test:   console.info\napps/admin-api test:     [admin-api] readAuth: cookie missing { cookieName: 'slimy_admin_token' }\napps/admin-api test:       at info (src/middleware/auth.js:22:13)\napps/admin-api test:   console.info\napps/admin-api test:     [admin-api] readAuth: cookie present { cookieName: 'slimy_admin_token' }\napps/admin-api test:       at info (src/middleware/auth.js:22:13)\napps/admin-api test:   console.info\napps/admin-api test:     [admin-api] readAuth: user hydrated { userId: 'test-admin' }\napps/admin-api test:       at info (src/middleware/auth.js:22:13)\napps/admin-api test:   console.info\napps/admin-api test:     [admin-api] readAuth: cookie present { cookieName: 'slimy_admin_token' }\napps/admin-api test:       at info (src/middleware/auth.js:22:13)\napps/admin-api test:   console.info\napps/admin-api test:     [admin-api] readAuth: user hydrated { userId: 'test-member' }\napps/admin-api test:       at info (src/middleware/auth.js:22:13)\napps/admin-api test:   console.info\napps/admin-api test:     [admin-api] readAuth: cookie present { cookieName: 'slimy_admin_token' }\napps/admin-api test:       at info (src/middleware/auth.js:22:13)\napps/admin-api test:   console.info\napps/admin-api test:     [admin-api] readAuth: user hydrated { userId: 'test-member' }\napps/admin-api test:       at info (src/middleware/auth.js:22:13)\napps/admin-api test:   console.warn\napps/admin-api test:     [admin-api] guild membership check failed {\napps/admin-api test:       userId: 'test-member',\napps/admin-api test:       guildId: 'different-guild-456',\napps/admin-api test:       guildIds: [ 'guild-123' ]\napps/admin-api test:     }\napps/admin-api test:       384 |     if (!guild) {\napps/admin-api test:       385 |       if (shouldDebugAuth()) {\napps/admin-api test:     > 386 |         console.warn(\"[admin-api] guild membership check failed\", {\napps/admin-api test:           |                 ^\napps/admin-api test:       387 |           userId: user.id,\napps/admin-api test:       388 |           guildId: guildIdStr,\napps/admin-api test:       389 |           guildIds: guilds.map((g) => String(g?.id)).slice(0, 25),\napps/admin-api test:       at warn (src/middleware/auth.js:386:17)\napps/admin-api test:       at Object.<anonymous> (tests/auth/auth-middleware.test.js:183:7)\napps/admin-api test:   console.info\napps/admin-api test:     [admin-api] readAuth: cookie present { cookieName: 'slimy_admin_token' }\napps/admin-api test:       at info (src/middleware/auth.js:22:13)\napps/admin-api test:   console.info\napps/admin-api test:     [admin-api] readAuth: user hydrated { userId: 'test-member' }\napps/admin-api test:       at info (src/middleware/auth.js:22:13)\napps/web test: \u001b[90mstderr\u001b[2m | tests/unit/codes-cache.test.ts\u001b[2m > \u001b[22m\u001b[2mCodesCache\u001b[2m > \u001b[22m\u001b[2merror handling\u001b[2m > \u001b[22m\u001b[2mshould handle redis operation failures gracefully\napps/web test: \u001b[22m\u001b[39mCache get attempt 3 failed: Error: Redis error\napps/web test:     at \u001b[90m/opt/slimy/slimy-monorepo/apps/web/\u001b[39mtests/unit/codes-cache.test.ts:184:45\napps/web test:     at file:///opt/slimy/slimy-monorepo/node_modules/\u001b[4m.pnpm\u001b[24m/@vitest+runner@4.0.15/node_modules/\u001b[4m@vitest/runner\u001b[24m/dist/index.js:145:11\napps/web test:     at file:///opt/slimy/slimy-monorepo/node_modules/\u001b[4m.pnpm\u001b[24m/@vitest+runner@4.0.15/node_modules/\u001b[4m@vitest/runner\u001b[24m/dist/index.js:915:26\napps/web test:     at file:///opt/slimy/slimy-monorepo/node_modules/\u001b[4m.pnpm\u001b[24m/@vitest+runner@4.0.15/node_modules/\u001b[4m@vitest/runner\u001b[24m/dist/index.js:1240:20\napps/web test:     at new Promise (<anonymous>)\napps/web test:     at runWithTimeout (file:///opt/slimy/slimy-monorepo/node_modules/\u001b[4m.pnpm\u001b[24m/@vitest+runner@4.0.15/node_modules/\u001b[4m@vitest/runner\u001b[24m/dist/index.js:1206:10)\napps/web test:     at file:///opt/slimy/slimy-monorepo/node_modules/\u001b[4m.pnpm\u001b[24m/@vitest+runner@4.0.15/node_modules/\u001b[4m@vitest/runner\u001b[24m/dist/index.js:1650:37\napps/web test:     at Traces.$ (file:///opt/slimy/slimy-monorepo/node_modules/\u001b[4m.pnpm\u001b[24m/vitest@4.0.15_@opentelemetry+api@1.9.0_@types+node@20.19.25_@vitest+ui@4.0.15_jiti@2.6._6f4799287cc307d0b976628207bcb6be/node_modules/\u001b[4mvitest\u001b[24m/dist/chunks/traces.U4xDYhzZ.js:115:27)\napps/web test:     at trace (file:///opt/slimy/slimy-monorepo/node_modules/\u001b[4m.pnpm\u001b[24m/vitest@4.0.15_@opentelemetry+api@1.9.0_@types+node@20.19.25_@vitest+ui@4.0.15_jiti@2.6._6f4799287cc307d0b976628207bcb6be/node_modules/\u001b[4mvitest\u001b[24m/dist/chunks/test.BT8LKgU9.js:239:21)\napps/web test:     at runTest (file:///opt/slimy/slimy-monorepo/node_modules/\u001b[4m.pnpm\u001b[24m/@vitest+runner@4.0.15/node_modules/\u001b[4m@vitest/runner\u001b[24m/dist/index.js:1650:12)\napps/web test: Cache get failed after 3 attempts\napps/admin-api test:   console.info\napps/admin-api test:     [admin-api] readAuth: cookie missing { cookieName: 'slimy_admin_token' }\napps/admin-api test:       at info (src/middleware/auth.js:22:13)\napps/web test: \u001b[90mstderr\u001b[2m | tests/unit/codes-cache.test.ts\u001b[2m > \u001b[22m\u001b[2mCodesCache\u001b[2m > \u001b[22m\u001b[2merror handling\u001b[2m > \u001b[22m\u001b[2mshould retry operations on failure\napps/web test: \u001b[22m\u001b[39mCache get attempt 1 failed: Error: First failure\napps/web test:     at \u001b[90m/opt/slimy/slimy-monorepo/apps/web/\u001b[39mtests/unit/codes-cache.test.ts:201:32\napps/web test:     at file:///opt/slimy/slimy-monorepo/node_modules/\u001b[4m.pnpm\u001b[24m/@vitest+runner@4.0.15/node_modules/\u001b[4m@vitest/runner\u001b[24m/dist/index.js:145:11\napps/web test:     at file:///opt/slimy/slimy-monorepo/node_modules/\u001b[4m.pnpm\u001b[24m/@vitest+runner@4.0.15/node_modules/\u001b[4m@vitest/runner\u001b[24m/dist/index.js:915:26\napps/web test:     at file:///opt/slimy/slimy-monorepo/node_modules/\u001b[4m.pnpm\u001b[24m/@vitest+runner@4.0.15/node_modules/\u001b[4m@vitest/runner\u001b[24m/dist/index.js:1240:20\napps/web test:     at new Promise (<anonymous>)\napps/web test:     at runWithTimeout (file:///opt/slimy/slimy-monorepo/node_modules/\u001b[4m.pnpm\u001b[24m/@vitest+runner@4.0.15/node_modules/\u001b[4m@vitest/runner\u001b[24m/dist/index.js:1206:10)\napps/web test:     at file:///opt/slimy/slimy-monorepo/node_modules/\u001b[4m.pnpm\u001b[24m/@vitest+runner@4.0.15/node_modules/\u001b[4m@vitest/runner\u001b[24m/dist/index.js:1650:37\napps/web test:     at Traces.$ (file:///opt/slimy/slimy-monorepo/node_modules/\u001b[4m.pnpm\u001b[24m/vitest@4.0.15_@opentelemetry+api@1.9.0_@types+node@20.19.25_@vitest+ui@4.0.15_jiti@2.6._6f4799287cc307d0b976628207bcb6be/node_modules/\u001b[4mvitest\u001b[24m/dist/chunks/traces.U4xDYhzZ.js:115:27)\napps/web test:     at trace (file:///opt/slimy/slimy-monorepo/node_modules/\u001b[4m.pnpm\u001b[24m/vitest@4.0.15_@opentelemetry+api@1.9.0_@types+node@20.19.25_@vitest+ui@4.0.15_jiti@2.6._6f4799287cc307d0b976628207bcb6be/node_modules/\u001b[4mvitest\u001b[24m/dist/chunks/test.BT8LKgU9.js:239:21)\napps/web test:     at runTest (file:///opt/slimy/slimy-monorepo/node_modules/\u001b[4m.pnpm\u001b[24m/@vitest+runner@4.0.15/node_modules/\u001b[4m@vitest/runner\u001b[24m/dist/index.js:1650:12)\napps/admin-api test:   console.info\napps/admin-api test:     [admin-api] readAuth: cookie present { cookieName: 'slimy_admin_token' }\napps/admin-api test:       at info (src/middleware/auth.js:22:13)\napps/admin-api test:   console.info\napps/admin-api test:     [admin-api] readAuth: user hydrated { userId: 'test-member' }\napps/admin-api test:       at info (src/middleware/auth.js:22:13)\napps/admin-api test: PASS tests/auth/auth-middleware.test.js\napps/admin-api test:   Auth Middleware\napps/admin-api test:     resolveUser\napps/admin-api test:       ✓ should return null when no token in cookies (73 ms)\napps/admin-api test:       ✓ should return null when token is invalid (20 ms)\napps/admin-api test:       ✓ should return hydrated user when session exists (13 ms)\napps/admin-api test:       ✓ should return fallback user when no session exists (17 ms)\napps/admin-api test:       ✓ should cache user resolution (14 ms)\napps/admin-api test:     requireAuth\napps/admin-api test:       ✓ should call next when user is authenticated (17 ms)\napps/admin-api test:       ✓ should return 401 when user is not authenticated (19 ms)\napps/admin-api test:     requireRole\napps/admin-api test:       ✓ should call next when user has required role (member) (51 ms)\napps/admin-api test:       ✓ should call next when user has higher role than required (32 ms)\napps/admin-api test:       ✓ should return 403 when user has insufficient role (29 ms)\napps/admin-api test:       ✓ should return 401 when user is not authenticated (83 ms)\napps/admin-api test:     requireGuildMember\napps/admin-api test:       ✓ should call next for admin user regardless of guild membership (41 ms)\napps/admin-api test:       ✓ should call next when user is member of the guild (32 ms)\napps/admin-api test:       ✓ should return 403 when user is not member of the guild (39 ms)\napps/admin-api test:       ✓ should return 400 when guildId parameter is missing (44 ms)\napps/admin-api test:       ✓ should return 401 when user is not authenticated (16 ms)\napps/admin-api test:       ✓ should use custom parameter name (37 ms)\napps/admin-api test: PASS tests/discord-guilds.test.js\napps/admin-api test:   GET /discord/guilds\napps/admin-api test:     ✓ should return shared guilds with role labels (40 ms)\napps/admin-api test:     ✓ should fall back to DISCORD_BOT_TOKEN when SLIMYAI_BOT_TOKEN is missing (6 ms)\napps/admin-api test: PASS tests/central-settings.test.js\napps/admin-api test:   central settings endpoints\napps/admin-api test:     ✓ GET /api/me/settings auto-creates defaults (59 ms)\napps/admin-api test:     ✓ PATCH /api/me/settings merges updates (103 ms)\napps/admin-api test:     ✓ GET /api/guilds/:guildId/settings requires admin/manager (33 ms)\napps/admin-api test:     ✓ PUT /api/guilds/:guildId/settings allows admin and persists (60 ms)\napps/web test: \u001b[90mstderr\u001b[2m | tests/components/usage-page.test.tsx\u001b[2m > \u001b[22m\u001b[2mUsagePage\u001b[2m > \u001b[22m\u001b[2mError state\u001b[2m > \u001b[22m\u001b[2mshould display error message when API fails with 502\napps/web test: \u001b[22m\u001b[39mFailed to fetch usage: Error: HTTP 502: Bad Gateway\napps/web test:     at \u001b[90m/opt/slimy/slimy-monorepo/apps/web/\u001b[39mtests/components/usage-page.test.tsx:75:9\napps/web test:     at file:///opt/slimy/slimy-monorepo/node_modules/\u001b[4m.pnpm\u001b[24m/@vitest+runner@4.0.15/node_modules/\u001b[4m@vitest/runner\u001b[24m/dist/index.js:145:11\napps/web test:     at file:///opt/slimy/slimy-monorepo/node_modules/\u001b[4m.pnpm\u001b[24m/@vitest+runner@4.0.15/node_modules/\u001b[4m@vitest/runner\u001b[24m/dist/index.js:915:26\napps/web test:     at file:///opt/slimy/slimy-monorepo/node_modules/\u001b[4m.pnpm\u001b[24m/@vitest+runner@4.0.15/node_modules/\u001b[4m@vitest/runner\u001b[24m/dist/index.js:1240:20\napps/web test:     at new Promise (<anonymous>)\napps/web test:     at runWithTimeout (file:///opt/slimy/slimy-monorepo/node_modules/\u001b[4m.pnpm\u001b[24m/@vitest+runner@4.0.15/node_modules/\u001b[4m@vitest/runner\u001b[24m/dist/index.js:1206:10)\napps/web test:     at file:///opt/slimy/slimy-monorepo/node_modules/\u001b[4m.pnpm\u001b[24m/@vitest+runner@4.0.15/node_modules/\u001b[4m@vitest/runner\u001b[24m/dist/index.js:1650:37\napps/web test:     at Traces.$ (file:///opt/slimy/slimy-monorepo/node_modules/\u001b[4m.pnpm\u001b[24m/vitest@4.0.15_@opentelemetry+api@1.9.0_@types+node@20.19.25_@vitest+ui@4.0.15_jiti@2.6._6f4799287cc307d0b976628207bcb6be/node_modules/\u001b[4mvitest\u001b[24m/dist/chunks/traces.U4xDYhzZ.js:115:27)\napps/web test:     at trace (file:///opt/slimy/slimy-monorepo/node_modules/\u001b[4m.pnpm\u001b[24m/vitest@4.0.15_@opentelemetry+api@1.9.0_@types+node@20.19.25_@vitest+ui@4.0.15_jiti@2.6._6f4799287cc307d0b976628207bcb6be/node_modules/\u001b[4mvitest\u001b[24m/dist/chunks/test.BT8LKgU9.js:239:21)\napps/web test:     at runTest (file:///opt/slimy/slimy-monorepo/node_modules/\u001b[4m.pnpm\u001b[24m/@vitest+runner@4.0.15/node_modules/\u001b[4m@vitest/runner\u001b[24m/dist/index.js:1650:12)\napps/web test:  \u001b[32m✓\u001b[39m tests/unit/codes-cache.test.ts \u001b[2m(\u001b[22m\u001b[2m14 tests\u001b[22m\u001b[2m)\u001b[22m\u001b[33m 5304\u001b[2mms\u001b[22m\u001b[39m\napps/web test:        \u001b[33m\u001b[2m✓\u001b[22m\u001b[39m should handle cache set failures \u001b[33m 2030\u001b[2mms\u001b[22m\u001b[39m\napps/web test:        \u001b[33m\u001b[2m✓\u001b[22m\u001b[39m should handle redis operation failures gracefully \u001b[33m 2026\u001b[2mms\u001b[22m\u001b[39m\napps/web test:        \u001b[33m\u001b[2m✓\u001b[22m\u001b[39m should retry operations on failure \u001b[33m 1029\u001b[2mms\u001b[22m\u001b[39m\napps/admin-api test: PASS tests/routes/stats.test.js\napps/admin-api test:   Stats Routes\napps/admin-api test:     ✓ GET /api/stats should return system metrics by default (58 ms)\napps/admin-api test:     ✓ GET /api/stats?action=system-metrics should return metrics (20 ms)\napps/admin-api test:     ✓ GET /api/stats/events/stream should set SSE headers (14 ms)\napps/admin-api test: PASS tests/guilds-read.test.js\napps/admin-api test:   GET /api/guilds/:guildId\napps/admin-api test:     ✓ should return guild details for authenticated user (42 ms)\napps/admin-api test:     ✓ should return 404 for non-existent guild (11 ms)\napps/web test: \u001b[90mstderr\u001b[2m | tests/components/usage-page.test.tsx\u001b[2m > \u001b[22m\u001b[2mUsagePage\u001b[2m > \u001b[22m\u001b[2mError state\u001b[2m > \u001b[22m\u001b[2mshould display error message when API fails with network error\napps/web test: \u001b[22m\u001b[39mFailed to fetch usage: Error: Network error: Unable to connect to usage API\napps/web test:     at \u001b[90m/opt/slimy/slimy-monorepo/apps/web/\u001b[39mtests/components/usage-page.test.tsx:91:9\napps/web test:     at file:///opt/slimy/slimy-monorepo/node_modules/\u001b[4m.pnpm\u001b[24m/@vitest+runner@4.0.15/node_modules/\u001b[4m@vitest/runner\u001b[24m/dist/index.js:145:11\napps/web test:     at file:///opt/slimy/slimy-monorepo/node_modules/\u001b[4m.pnpm\u001b[24m/@vitest+runner@4.0.15/node_modules/\u001b[4m@vitest/runner\u001b[24m/dist/index.js:915:26\napps/web test:     at file:///opt/slimy/slimy-monorepo/node_modules/\u001b[4m.pnpm\u001b[24m/@vitest+runner@4.0.15/node_modules/\u001b[4m@vitest/runner\u001b[24m/dist/index.js:1240:20\napps/web test:     at new Promise (<anonymous>)\napps/web test:     at runWithTimeout (file:///opt/slimy/slimy-monorepo/node_modules/\u001b[4m.pnpm\u001b[24m/@vitest+runner@4.0.15/node_modules/\u001b[4m@vitest/runner\u001b[24m/dist/index.js:1206:10)\napps/web test:     at file:///opt/slimy/slimy-monorepo/node_modules/\u001b[4m.pnpm\u001b[24m/@vitest+runner@4.0.15/node_modules/\u001b[4m@vitest/runner\u001b[24m/dist/index.js:1650:37\napps/web test:     at Traces.$ (file:///opt/slimy/slimy-monorepo/node_modules/\u001b[4m.pnpm\u001b[24m/vitest@4.0.15_@opentelemetry+api@1.9.0_@types+node@20.19.25_@vitest+ui@4.0.15_jiti@2.6._6f4799287cc307d0b976628207bcb6be/node_modules/\u001b[4mvitest\u001b[24m/dist/chunks/traces.U4xDYhzZ.js:115:27)\napps/web test:     at trace (file:///opt/slimy/slimy-monorepo/node_modules/\u001b[4m.pnpm\u001b[24m/vitest@4.0.15_@opentelemetry+api@1.9.0_@types+node@20.19.25_@vitest+ui@4.0.15_jiti@2.6._6f4799287cc307d0b976628207bcb6be/node_modules/\u001b[4mvitest\u001b[24m/dist/chunks/test.BT8LKgU9.js:239:21)\napps/web test:     at runTest (file:///opt/slimy/slimy-monorepo/node_modules/\u001b[4m.pnpm\u001b[24m/@vitest+runner@4.0.15/node_modules/\u001b[4m@vitest/runner\u001b[24m/dist/index.js:1650:12)\napps/web test: \u001b[90mstderr\u001b[2m | tests/components/usage-page.test.tsx\u001b[2m > \u001b[22m\u001b[2mUsagePage\u001b[2m > \u001b[22m\u001b[2mError state\u001b[2m > \u001b[22m\u001b[2mshould not crash the page on error\napps/web test: \u001b[22m\u001b[39mFailed to fetch usage: Error: Unexpected error\napps/web test:     at \u001b[90m/opt/slimy/slimy-monorepo/apps/web/\u001b[39mtests/components/usage-page.test.tsx:103:9\napps/web test:     at file:///opt/slimy/slimy-monorepo/node_modules/\u001b[4m.pnpm\u001b[24m/@vitest+runner@4.0.15/node_modules/\u001b[4m@vitest/runner\u001b[24m/dist/index.js:145:11\napps/web test:     at file:///opt/slimy/slimy-monorepo/node_modules/\u001b[4m.pnpm\u001b[24m/@vitest+runner@4.0.15/node_modules/\u001b[4m@vitest/runner\u001b[24m/dist/index.js:915:26\napps/web test:     at file:///opt/slimy/slimy-monorepo/node_modules/\u001b[4m.pnpm\u001b[24m/@vitest+runner@4.0.15/node_modules/\u001b[4m@vitest/runner\u001b[24m/dist/index.js:1240:20\napps/web test:     at new Promise (<anonymous>)\napps/web test:     at runWithTimeout (file:///opt/slimy/slimy-monorepo/node_modules/\u001b[4m.pnpm\u001b[24m/@vitest+runner@4.0.15/node_modules/\u001b[4m@vitest/runner\u001b[24m/dist/index.js:1206:10)\napps/web test:     at file:///opt/slimy/slimy-monorepo/node_modules/\u001b[4m.pnpm\u001b[24m/@vitest+runner@4.0.15/node_modules/\u001b[4m@vitest/runner\u001b[24m/dist/index.js:1650:37\napps/web test:     at Traces.$ (file:///opt/slimy/slimy-monorepo/node_modules/\u001b[4m.pnpm\u001b[24m/vitest@4.0.15_@opentelemetry+api@1.9.0_@types+node@20.19.25_@vitest+ui@4.0.15_jiti@2.6._6f4799287cc307d0b976628207bcb6be/node_modules/\u001b[4mvitest\u001b[24m/dist/chunks/traces.U4xDYhzZ.js:115:27)\napps/web test:     at trace (file:///opt/slimy/slimy-monorepo/node_modules/\u001b[4m.pnpm\u001b[24m/vitest@4.0.15_@opentelemetry+api@1.9.0_@types+node@20.19.25_@vitest+ui@4.0.15_jiti@2.6._6f4799287cc307d0b976628207bcb6be/node_modules/\u001b[4mvitest\u001b[24m/dist/chunks/test.BT8LKgU9.js:239:21)\napps/web test:     at runTest (file:///opt/slimy/slimy-monorepo/node_modules/\u001b[4m.pnpm\u001b[24m/@vitest+runner@4.0.15/node_modules/\u001b[4m@vitest/runner\u001b[24m/dist/index.js:1650:12)\napps/admin-api test: PASS tests/routes/usage.test.js\napps/admin-api test:   GET /api/usage\napps/admin-api test:     ✓ should return 200 and correct usage data structure (64 ms)\napps/web test: \u001b[90mstderr\u001b[2m | tests/components/usage-page.test.tsx\u001b[2m > \u001b[22m\u001b[2mUsagePage\u001b[2m > \u001b[22m\u001b[2mError state\u001b[2m > \u001b[22m\u001b[2mshould handle unknown errors gracefully\napps/web test: \u001b[22m\u001b[39mFailed to fetch usage: String error\napps/admin-api test:   console.log\napps/admin-api test:     [requireGuildAccess] Checking access for user discord-user-id to guild guild-123\napps/admin-api test:       at log (src/middleware/rbac.js:33:13)\napps/admin-api test:   console.warn\napps/admin-api test:     [requireGuildAccess] User discord-user-id not found in DB\napps/admin-api test:       38 |\napps/admin-api test:       39 |     if (!user) {\napps/admin-api test:     > 40 |       console.warn(`[requireGuildAccess] User ${req.user.id} not found in DB`);\napps/admin-api test:          |               ^\napps/admin-api test:       41 |       return res.status(403).json({ error: \"guild-access-denied\" });\napps/admin-api test:       42 |     }\napps/admin-api test:       43 |\napps/admin-api test:       at warn (src/middleware/rbac.js:40:15)\napps/admin-api test:       at Object.<anonymous> (tests/middleware/rbac.test.js:53:5)\napps/admin-api test:   console.log\napps/admin-api test:     [requireGuildAccess] Checking access for user discord-user-id to guild guild-123\napps/admin-api test:       at log (src/middleware/rbac.js:33:13)\napps/admin-api test:   console.warn\napps/admin-api test:     [requireGuildAccess] User db-user-id is not a member of guild guild-123\napps/admin-api test:       56 |\napps/admin-api test:       57 |     if (!userGuild) {\napps/admin-api test:     > 58 |       console.warn(`[requireGuildAccess] User ${user.id} is not a member of guild ${guildId}`);\napps/admin-api test:          |               ^\napps/admin-api test:       59 |       return res.status(403).json({ error: \"guild-access-denied\" });\napps/admin-api test:       60 |     }\napps/admin-api test:       61 |\napps/admin-api test:       at warn (src/middleware/rbac.js:58:15)\napps/admin-api test:       at Object.<anonymous> (tests/middleware/rbac.test.js:63:5)\napps/admin-api test:   console.log\napps/admin-api test:     [requireGuildAccess] Checking access for user discord-user-id to guild guild-123\napps/admin-api test:       at log (src/middleware/rbac.js:33:13)\napps/admin-api test: PASS tests/middleware/rbac.test.js\napps/admin-api test:   requireGuildAccess Middleware\napps/admin-api test:     ✓ should return 400 if guildId is missing (17 ms)\napps/admin-api test:     ✓ should return 401 if user is not authenticated (22 ms)\napps/admin-api test:     ✓ should return 403 if user not found in DB (69 ms)\napps/admin-api test:     ✓ should return 403 if user is not a member of the guild (25 ms)\napps/admin-api test:     ✓ should call next() and attach guild info if user has access (11 ms)\napps/admin-api test: PASS src/lib/auth/post-login-redirect.test.js\napps/admin-api test:   resolvePostLoginRedirectUrl\napps/admin-api test:     ✓ prefers oauth_redirect_uri cookie origin + oauth_return_to (5 ms)\napps/admin-api test:     ✓ falls back to x-forwarded origin when cookie missing (1 ms)\napps/admin-api test:     ✓ falls back to CLIENT_URL when cookie and forwarded origin missing\napps/admin-api test: PASS tests/club-store.test.js\napps/admin-api test:   club-store shim\napps/admin-api test:     ✓ canonicalize lowercases input (1 ms)\napps/admin-api test:     ✓ canonicalize handles nullish values (52 ms)\napps/admin-api test: PASS tests/numparse.test.js\napps/admin-api test:   numparse shim\napps/admin-api test:     ✓ returns numeric values for plain numbers (3 ms)\napps/admin-api test:     ✓ returns null for non-numeric values or suffixed strings (11 ms)\napps/admin-api test:   console.log\napps/admin-api test:     !!! AUTH LOGIC LOADED v304 (ACTIVE GUILD) !!!\napps/admin-api test:       at Object.log (src/routes/auth.js:21:9)\napps/admin-api test:   console.log\napps/admin-api test:     [auth/me] req.user keys: id,username,role,guilds\napps/admin-api test:       at log (src/routes/auth.js:627:13)\napps/admin-api test:   console.log\napps/admin-api test:     [auth/me] rawUser keys: id,username,role,guilds\napps/admin-api test:       at log (src/routes/auth.js:628:13)\napps/admin-api test:   console.log\napps/admin-api test:     [auth/me] Lookup User ID: test-user-id\napps/admin-api test:       at log (src/routes/auth.js:629:13)\napps/admin-api test:   console.log\napps/admin-api test:     [auth/me] DB User Found: true\napps/admin-api test:       at log (src/routes/auth.js:747:13)\napps/admin-api test: PASS tests/diag.test.js\napps/admin-api test:   diagnostics placeholder\napps/admin-api test:     ✓ skipped in test mode (3 ms)\napps/admin-api test:   console.warn\napps/admin-api test:     [auth/me] DB guild lookup failed; returning session-only guilds { error: \"Cannot read properties of undefined (reading 'findMany')\" }\napps/admin-api test:       768 |         warnings.push(\"db_guilds_lookup_failed\");\napps/admin-api test:       769 |         if (shouldDebugAuth()) {\napps/admin-api test:     > 770 |           console.warn(\"[auth/me] DB guild lookup failed; returning session-only guilds\", {\napps/admin-api test:           |                   ^\napps/admin-api test:       771 |             error: err?.message || String(err),\napps/admin-api test:       772 |           });\napps/admin-api test:       773 |         }\napps/admin-api test:       at warn (src/routes/auth.js:770:19)\napps/web test:  \u001b[32m✓\u001b[39m tests/components/button.test.tsx \u001b[2m(\u001b[22m\u001b[2m9 tests\u001b[22m\u001b[2m)\u001b[22m\u001b[33m 4037\u001b[2mms\u001b[22m\u001b[39m\napps/web test:      \u001b[33m\u001b[2m✓\u001b[22m\u001b[39m renders with default props \u001b[33m 1249\u001b[2mms\u001b[22m\u001b[39m\napps/web test:      \u001b[33m\u001b[2m✓\u001b[22m\u001b[39m renders with different variants \u001b[33m 1214\u001b[2mms\u001b[22m\u001b[39m\napps/web test:      \u001b[33m\u001b[2m✓\u001b[22m\u001b[39m renders with different sizes \u001b[33m 441\u001b[2mms\u001b[22m\u001b[39m\napps/web test:      \u001b[33m\u001b[2m✓\u001b[22m\u001b[39m handles click events \u001b[33m 330\u001b[2mms\u001b[22m\u001b[39m\napps/web test:      \u001b[33m\u001b[2m✓\u001b[22m\u001b[39m supports disabled state \u001b[33m 310\u001b[2mms\u001b[22m\u001b[39m\napps/admin-api test:   console.log\napps/admin-api test:     [auth/me] req.user keys: id,username,role,guilds\napps/admin-api test:       at log (src/routes/auth.js:627:13)\napps/admin-api test:   console.log\napps/admin-api test:     [auth/me] rawUser keys: id,username,role,guilds\napps/admin-api test:       at log (src/routes/auth.js:628:13)\napps/admin-api test:   console.log\napps/admin-api test:     [auth/me] Lookup User ID: test-user-id\napps/admin-api test:       at log (src/routes/auth.js:629:13)\napps/admin-api test:   console.warn\napps/admin-api test:     [auth/me] DB user lookup failed; returning session-only response { error: 'DB Error' }\napps/admin-api test:       739 |       warnings.push(\"db_user_lookup_failed\");\napps/admin-api test:       740 |       if (shouldDebugAuth()) {\napps/admin-api test:     > 741 |         console.warn(\"[auth/me] DB user lookup failed; returning session-only response\", {\napps/admin-api test:           |                 ^\napps/admin-api test:       742 |           error: err?.message || String(err),\napps/admin-api test:       743 |         });\napps/admin-api test:       744 |       }\napps/admin-api test:       at warn (src/routes/auth.js:741:17)\napps/admin-api test:   console.log\napps/admin-api test:     [auth/me] DB User Found: false\napps/admin-api test:       at log (src/routes/auth.js:747:13)\napps/admin-api test:   console.warn\napps/admin-api test:     [auth/me] Fallback to cookie guilds: 0\napps/admin-api test:       784 |       // But ensure we at least pass the ID\napps/admin-api test:       785 |       const cookieGuilds = Array.isArray(rawUser?.guilds) ? rawUser.guilds : [];\napps/admin-api test:     > 786 |       console.warn(\"[auth/me] Fallback to cookie guilds:\", cookieGuilds.length);\napps/admin-api test:           |               ^\napps/admin-api test:       787 |       sessionGuilds = cookieGuilds.map((g) => ({\napps/admin-api test:       788 |         id: g?.id,\napps/admin-api test:       789 |         roles: g?.roles,\napps/admin-api test:       at warn (src/routes/auth.js:786:15)\napps/admin-api test: PASS tests/auth/me-context.test.js\napps/admin-api test:   GET /api/auth/me Context Hydration\napps/admin-api test:     ✓ should include lastActiveGuild from DB (142 ms)\napps/admin-api test:     ✓ should handle DB errors gracefully (80 ms)\napps/admin-api test: A worker process has failed to exit gracefully and has been force exited. This is likely caused by tests leaking due to improper teardown. Try running with --detectOpenHandles to find leaks. Active timers can also cause this, ensure that .unref() was called on them.\napps/admin-api test: Test Suites: 12 skipped, 22 passed, 22 of 34 total\napps/admin-api test: Tests:       12 skipped, 95 passed, 107 total\napps/admin-api test: Snapshots:   0 total\napps/admin-api test: Time:        17.882 s\napps/admin-api test: Ran all test suites.\napps/web test:  \u001b[32m✓\u001b[39m tests/components/usage-page.test.tsx \u001b[2m(\u001b[22m\u001b[2m22 tests\u001b[22m\u001b[2m)\u001b[22m\u001b[33m 2876\u001b[2mms\u001b[22m\u001b[39m\napps/web test:        \u001b[33m\u001b[2m✓\u001b[22m\u001b[39m should display loading skeletons while fetching data \u001b[33m 398\u001b[2mms\u001b[22m\u001b[39m\napps/web test:        \u001b[33m\u001b[2m✓\u001b[22m\u001b[39m should display error message when API fails with 502 \u001b[33m 335\u001b[2mms\u001b[22m\u001b[39m\napps/web test:        \u001b[33m\u001b[2m✓\u001b[22m\u001b[39m should render usage data correctly for pro tier with ok status \u001b[33m 363\u001b[2mms\u001b[22m\u001b[39m\napps/admin-api test: Done\napps/web test:  \u001b[32m✓\u001b[39m tests/components/club/results.test.tsx \u001b[2m(\u001b[22m\u001b[2m12 tests\u001b[22m\u001b[2m)\u001b[22m\u001b[33m 1225\u001b[2mms\u001b[22m\u001b[39m\napps/web test:      \u001b[33m\u001b[2m✓\u001b[22m\u001b[39m should render analysis results correctly \u001b[33m 392\u001b[2mms\u001b[22m\u001b[39m\napps/web test: \u001b[90mstderr\u001b[2m | tests/components/usage-badge.test.tsx\u001b[2m > \u001b[22m\u001b[2mUsageBadge\u001b[2m > \u001b[22m\u001b[2mError handling\u001b[2m > \u001b[22m\u001b[2mshould not crash on error\napps/web test: \u001b[22m\u001b[39mFailed to fetch usage: Error: Network error\napps/web test:     at \u001b[90m/opt/slimy/slimy-monorepo/apps/web/\u001b[39mtests/components/usage-badge.test.tsx:56:9\napps/web test:     at file:///opt/slimy/slimy-monorepo/node_modules/\u001b[4m.pnpm\u001b[24m/@vitest+runner@4.0.15/node_modules/\u001b[4m@vitest/runner\u001b[24m/dist/index.js:145:11\napps/web test:     at file:///opt/slimy/slimy-monorepo/node_modules/\u001b[4m.pnpm\u001b[24m/@vitest+runner@4.0.15/node_modules/\u001b[4m@vitest/runner\u001b[24m/dist/index.js:915:26\napps/web test:     at file:///opt/slimy/slimy-monorepo/node_modules/\u001b[4m.pnpm\u001b[24m/@vitest+runner@4.0.15/node_modules/\u001b[4m@vitest/runner\u001b[24m/dist/index.js:1240:20\napps/web test:     at new Promise (<anonymous>)\napps/web test:     at runWithTimeout (file:///opt/slimy/slimy-monorepo/node_modules/\u001b[4m.pnpm\u001b[24m/@vitest+runner@4.0.15/node_modules/\u001b[4m@vitest/runner\u001b[24m/dist/index.js:1206:10)\napps/web test:     at file:///opt/slimy/slimy-monorepo/node_modules/\u001b[4m.pnpm\u001b[24m/@vitest+runner@4.0.15/node_modules/\u001b[4m@vitest/runner\u001b[24m/dist/index.js:1650:37\napps/web test:     at Traces.$ (file:///opt/slimy/slimy-monorepo/node_modules/\u001b[4m.pnpm\u001b[24m/vitest@4.0.15_@opentelemetry+api@1.9.0_@types+node@20.19.25_@vitest+ui@4.0.15_jiti@2.6._6f4799287cc307d0b976628207bcb6be/node_modules/\u001b[4mvitest\u001b[24m/dist/chunks/traces.U4xDYhzZ.js:115:27)\napps/web test:     at trace (file:///opt/slimy/slimy-monorepo/node_modules/\u001b[4m.pnpm\u001b[24m/vitest@4.0.15_@opentelemetry+api@1.9.0_@types+node@20.19.25_@vitest+ui@4.0.15_jiti@2.6._6f4799287cc307d0b976628207bcb6be/node_modules/\u001b[4mvitest\u001b[24m/dist/chunks/test.BT8LKgU9.js:239:21)\napps/web test:     at runTest (file:///opt/slimy/slimy-monorepo/node_modules/\u001b[4m.pnpm\u001b[24m/@vitest+runner@4.0.15/node_modules/\u001b[4m@vitest/runner\u001b[24m/dist/index.js:1650:12)\napps/web test:  \u001b[32m✓\u001b[39m tests/components/usage-badge.test.tsx \u001b[2m(\u001b[22m\u001b[2m18 tests\u001b[22m\u001b[2m)\u001b[22m\u001b[33m 992\u001b[2mms\u001b[22m\u001b[39m\napps/web test: \u001b[90mstderr\u001b[2m | tests/components/message-bubble.test.tsx\u001b[2m > \u001b[22m\u001b[2mMessageBubble\u001b[2m > \u001b[22m\u001b[2mcopies message content to clipboard when copy button is clicked\napps/web test: \u001b[22m\u001b[39mAn update to MessageBubble inside a test was not wrapped in act(...).\napps/web test: When testing, code that causes React state updates should be wrapped into act(...):\napps/web test: act(() => {\napps/web test:   /* fire events that update state */\napps/web test: });\napps/web test: /* assert on the output */\napps/web test: This ensures that you're testing the behavior the user would see in the browser. Learn more at https://react.dev/link/wrap-tests-with-act\napps/web test:  \u001b[32m✓\u001b[39m tests/components/message-bubble.test.tsx \u001b[2m(\u001b[22m\u001b[2m11 tests\u001b[22m\u001b[2m)\u001b[22m\u001b[33m 587\u001b[2mms\u001b[22m\u001b[39m\napps/web test:      \u001b[33m\u001b[2m✓\u001b[22m\u001b[39m renders user message with correct styling \u001b[33m 360\u001b[2mms\u001b[22m\u001b[39m\napps/web test:  \u001b[32m✓\u001b[39m tests/unit/lib/env.test.ts \u001b[2m(\u001b[22m\u001b[2m5 tests\u001b[22m\u001b[2m)\u001b[22m\u001b[33m 416\u001b[2mms\u001b[22m\u001b[39m\napps/web test: \u001b[90mstderr\u001b[2m | tests/api/club/analyze.test.ts\u001b[2m > \u001b[22m\u001b[2m/api/club/analyze\u001b[2m > \u001b[22m\u001b[2mPOST /api/club/analyze\u001b[2m > \u001b[22m\u001b[2mshould return 400 when no imageUrls provided\napps/web test: \u001b[22m\u001b[39mError occurred: {\napps/web test:   name: \u001b[32m'ValidationError'\u001b[39m,\napps/web test:   code: \u001b[32m'VALIDATION_ERROR'\u001b[39m,\napps/web test:   message: \u001b[32m'At least one image URL is required'\u001b[39m,\napps/web test:   statusCode: \u001b[33m400\u001b[39m,\napps/web test:   details: \u001b[90mundefined\u001b[39m,\napps/web test:   stack: \u001b[32m'ValidationError: At least one image URL is required\\n'\u001b[39m +\napps/web test:     \u001b[32m'    at Module.POST (/opt/slimy/slimy-monorepo/apps/web/app/api/club/analyze/route.ts:17:13)\\n'\u001b[39m +\napps/web test:     \u001b[32m'    at processTicksAndRejections (node:internal/process/task_queues:95:5)\\n'\u001b[39m +\napps/web test:     \u001b[32m'    at /opt/slimy/slimy-monorepo/apps/web/tests/api/club/analyze.test.ts:144:24\\n'\u001b[39m +\napps/web test:     \u001b[32m'    at file:///opt/slimy/slimy-monorepo/node_modules/.pnpm/@vitest+runner@4.0.15/node_modules/@vitest/runner/dist/index.js:915:20'\u001b[39m,\napps/web test:   context: \u001b[90mundefined\u001b[39m,\napps/web test:   timestamp: \u001b[32m'2026-01-02T21:54:46.762Z'\u001b[39m\napps/web test: }\napps/web test: \u001b[90mstderr\u001b[2m | tests/api/club/analyze.test.ts\u001b[2m > \u001b[22m\u001b[2m/api/club/analyze\u001b[2m > \u001b[22m\u001b[2mPOST /api/club/analyze\u001b[2m > \u001b[22m\u001b[2mshould return 400 when no guildId provided\napps/web test: \u001b[22m\u001b[39mError occurred: {\napps/web test:   name: \u001b[32m'ValidationError'\u001b[39m,\napps/web test:   code: \u001b[32m'VALIDATION_ERROR'\u001b[39m,\napps/web test:   message: \u001b[32m'Guild ID is required'\u001b[39m,\napps/web test:   statusCode: \u001b[33m400\u001b[39m,\napps/web test:   details: \u001b[90mundefined\u001b[39m,\napps/web test:   stack: \u001b[32m'ValidationError: Guild ID is required\\n'\u001b[39m +\napps/web test:     \u001b[32m'    at Module.POST (/opt/slimy/slimy-monorepo/apps/web/app/api/club/analyze/route.ts:21:13)\\n'\u001b[39m +\napps/web test:     \u001b[32m'    at processTicksAndRejections (node:internal/process/task_queues:95:5)\\n'\u001b[39m +\napps/web test:     \u001b[32m'    at /opt/slimy/slimy-monorepo/apps/web/tests/api/club/analyze.test.ts:159:24\\n'\u001b[39m +\napps/web test:     \u001b[32m'    at file:///opt/slimy/slimy-monorepo/node_modules/.pnpm/@vitest+runner@4.0.15/node_modules/@vitest/runner/dist/index.js:915:20'\u001b[39m,\napps/web test:   context: \u001b[90mundefined\u001b[39m,\napps/web test:   timestamp: \u001b[32m'2026-01-02T21:54:46.811Z'\u001b[39m\napps/web test: }\napps/web test: \u001b[90mstderr\u001b[2m | tests/api/club/analyze.test.ts\u001b[2m > \u001b[22m\u001b[2m/api/club/analyze\u001b[2m > \u001b[22m\u001b[2mPOST /api/club/analyze\u001b[2m > \u001b[22m\u001b[2mshould return 400 when no valid image URLs\napps/web test: \u001b[22m\u001b[39mError occurred: {\napps/web test:   name: \u001b[32m'ValidationError'\u001b[39m,\napps/web test:   code: \u001b[32m'VALIDATION_ERROR'\u001b[39m,\napps/web test:   message: \u001b[32m'No valid image URLs provided'\u001b[39m,\napps/web test:   statusCode: \u001b[33m400\u001b[39m,\napps/web test:   details: \u001b[90mundefined\u001b[39m,\napps/web test:   stack: \u001b[32m'ValidationError: No valid image URLs provided\\n'\u001b[39m +\napps/web test:     \u001b[32m'    at Module.POST (/opt/slimy/slimy-monorepo/apps/web/app/api/club/analyze/route.ts:35:13)\\n'\u001b[39m +\napps/web test:     \u001b[32m'    at processTicksAndRejections (node:internal/process/task_queues:95:5)\\n'\u001b[39m +\napps/web test:     \u001b[32m'    at /opt/slimy/slimy-monorepo/apps/web/tests/api/club/analyze.test.ts:177:24\\n'\u001b[39m +\napps/web test:     \u001b[32m'    at file:///opt/slimy/slimy-monorepo/node_modules/.pnpm/@vitest+runner@4.0.15/node_modules/@vitest/runner/dist/index.js:915:20'\u001b[39m,\napps/web test:   context: \u001b[90mundefined\u001b[39m,\napps/web test:   timestamp: \u001b[32m'2026-01-02T21:54:46.819Z'\u001b[39m\napps/web test: }\napps/web test: \u001b[90mstderr\u001b[2m | tests/api/club/analyze.test.ts\u001b[2m > \u001b[22m\u001b[2m/api/club/analyze\u001b[2m > \u001b[22m\u001b[2mPOST /api/club/analyze\u001b[2m > \u001b[22m\u001b[2mshould handle analysis errors gracefully\napps/web test: \u001b[22m\u001b[39mAnalysis error: Error: API Error\napps/web test:     at \u001b[90m/opt/slimy/slimy-monorepo/apps/web/\u001b[39mtests/api/club/analyze.test.ts:267:56\napps/web test:     at file:///opt/slimy/slimy-monorepo/node_modules/\u001b[4m.pnpm\u001b[24m/@vitest+runner@4.0.15/node_modules/\u001b[4m@vitest/runner\u001b[24m/dist/index.js:145:11\napps/web test:     at file:///opt/slimy/slimy-monorepo/node_modules/\u001b[4m.pnpm\u001b[24m/@vitest+runner@4.0.15/node_modules/\u001b[4m@vitest/runner\u001b[24m/dist/index.js:915:26\napps/web test:     at file:///opt/slimy/slimy-monorepo/node_modules/\u001b[4m.pnpm\u001b[24m/@vitest+runner@4.0.15/node_modules/\u001b[4m@vitest/runner\u001b[24m/dist/index.js:1240:20\napps/web test:     at new Promise (<anonymous>)\napps/web test:     at runWithTimeout (file:///opt/slimy/slimy-monorepo/node_modules/\u001b[4m.pnpm\u001b[24m/@vitest+runner@4.0.15/node_modules/\u001b[4m@vitest/runner\u001b[24m/dist/index.js:1206:10)\napps/web test:     at file:///opt/slimy/slimy-monorepo/node_modules/\u001b[4m.pnpm\u001b[24m/@vitest+runner@4.0.15/node_modules/\u001b[4m@vitest/runner\u001b[24m/dist/index.js:1650:37\napps/web test:     at Traces.$ (file:///opt/slimy/slimy-monorepo/node_modules/\u001b[4m.pnpm\u001b[24m/vitest@4.0.15_@opentelemetry+api@1.9.0_@types+node@20.19.25_@vitest+ui@4.0.15_jiti@2.6._6f4799287cc307d0b976628207bcb6be/node_modules/\u001b[4mvitest\u001b[24m/dist/chunks/traces.U4xDYhzZ.js:115:27)\napps/web test:     at trace (file:///opt/slimy/slimy-monorepo/node_modules/\u001b[4m.pnpm\u001b[24m/vitest@4.0.15_@opentelemetry+api@1.9.0_@types+node@20.19.25_@vitest+ui@4.0.15_jiti@2.6._6f4799287cc307d0b976628207bcb6be/node_modules/\u001b[4mvitest\u001b[24m/dist/chunks/test.BT8LKgU9.js:239:21)\napps/web test:     at runTest (file:///opt/slimy/slimy-monorepo/node_modules/\u001b[4m.pnpm\u001b[24m/@vitest+runner@4.0.15/node_modules/\u001b[4m@vitest/runner\u001b[24m/dist/index.js:1650:12)\napps/web test: Error occurred: {\napps/web test:   name: \u001b[32m'AppError'\u001b[39m,\napps/web test:   code: \u001b[32m'INTERNAL_ERROR'\u001b[39m,\napps/web test:   message: \u001b[32m'API Error'\u001b[39m,\napps/web test:   statusCode: \u001b[33m500\u001b[39m,\napps/web test:   details: { originalError: \u001b[32m'Error'\u001b[39m },\napps/web test:   stack: \u001b[32m'AppError: API Error\\n'\u001b[39m +\napps/web test:     \u001b[32m'    at toAppError (/opt/slimy/slimy-monorepo/apps/web/lib/errors.ts:147:12)\\n'\u001b[39m +\napps/web test:     \u001b[32m'    at errorResponse (/opt/slimy/slimy-monorepo/apps/web/lib/errors.ts:186:20)\\n'\u001b[39m +\napps/web test:     \u001b[32m'    at Module.POST (/opt/slimy/slimy-monorepo/apps/web/app/api/club/analyze/route.ts:119:39)\\n'\u001b[39m +\napps/web test:     \u001b[32m'    at processTicksAndRejections (node:internal/process/task_queues:95:5)\\n'\u001b[39m +\napps/web test:     \u001b[32m'    at /opt/slimy/slimy-monorepo/apps/web/tests/api/club/analyze.test.ts:276:24\\n'\u001b[39m +\napps/web test:     \u001b[32m'    at file:///opt/slimy/slimy-monorepo/node_modules/.pnpm/@vitest+runner@4.0.15/node_modules/@vitest/runner/dist/index.js:915:20'\u001b[39m,\napps/web test:   context: \u001b[90mundefined\u001b[39m,\napps/web test:   timestamp: \u001b[32m'2026-01-02T21:54:46.989Z'\u001b[39m\napps/web test: }\napps/web test: \u001b[90mstderr\u001b[2m | tests/api/club/analyze.test.ts\u001b[2m > \u001b[22m\u001b[2m/api/club/analyze\u001b[2m > \u001b[22m\u001b[2mGET /api/club/analyze\u001b[2m > \u001b[22m\u001b[2mshould return 400 when no guildId provided\napps/web test: \u001b[22m\u001b[39mError occurred: {\napps/web test:   name: \u001b[32m'ValidationError'\u001b[39m,\napps/web test:   code: \u001b[32m'VALIDATION_ERROR'\u001b[39m,\napps/web test:   message: \u001b[32m'Guild ID is required'\u001b[39m,\napps/web test:   statusCode: \u001b[33m400\u001b[39m,\napps/web test:   details: \u001b[90mundefined\u001b[39m,\napps/web test:   stack: \u001b[32m'ValidationError: Guild ID is required\\n'\u001b[39m +\napps/web test:     \u001b[32m'    at Module.GET (/opt/slimy/slimy-monorepo/apps/web/app/api/club/analyze/route.ts:151:13)\\n'\u001b[39m +\napps/web test:     \u001b[32m'    at /opt/slimy/slimy-monorepo/apps/web/tests/api/club/analyze.test.ts:312:30\\n'\u001b[39m +\napps/web test:     \u001b[32m'    at file:///opt/slimy/slimy-monorepo/node_modules/.pnpm/@vitest+runner@4.0.15/node_modules/@vitest/runner/dist/index.js:145:11\\n'\u001b[39m +\napps/web test:     \u001b[32m'    at file:///opt/slimy/slimy-monorepo/node_modules/.pnpm/@vitest+runner@4.0.15/node_modules/@vitest/runner/dist/index.js:915:26\\n'\u001b[39m +\napps/web test:     \u001b[32m'    at file:///opt/slimy/slimy-monorepo/node_modules/.pnpm/@vitest+runner@4.0.15/node_modules/@vitest/runner/dist/index.js:1240:20\\n'\u001b[39m +\napps/web test:     \u001b[32m'    at new Promise (<anonymous>)\\n'\u001b[39m +\napps/web test:     \u001b[32m'    at runWithTimeout (file:///opt/slimy/slimy-monorepo/node_modules/.pnpm/@vitest+runner@4.0.15/node_modules/@vitest/runner/dist/index.js:1206:10)\\n'\u001b[39m +\napps/web test:     \u001b[32m'    at file:///opt/slimy/slimy-monorepo/node_modules/.pnpm/@vitest+runner@4.0.15/node_modules/@vitest/runner/dist/index.js:1650:37\\n'\u001b[39m +\napps/web test:     \u001b[32m'    at Traces.$ (file:///opt/slimy/slimy-monorepo/node_modules/.pnpm/vitest@4.0.15_@opentelemetry+api@1.9.0_@types+node@20.19.25_@vitest+ui@4.0.15_jiti@2.6._6f4799287cc307d0b976628207bcb6be/node_modules/vitest/dist/chunks/traces.U4xDYhzZ.js:115:27)\\n'\u001b[39m +\napps/web test:     \u001b[32m'    at trace (file:///opt/slimy/slimy-monorepo/node_modules/.pnpm/vitest@4.0.15_@opentelemetry+api@1.9.0_@types+node@20.19.25_@vitest+ui@4.0.15_jiti@2.6._6f4799287cc307d0b976628207bcb6be/node_modules/vitest/dist/chunks/test.BT8LKgU9.js:239:21)'\u001b[39m,\napps/web test:   context: \u001b[90mundefined\u001b[39m,\napps/web test:   timestamp: \u001b[32m'2026-01-02T21:54:47.049Z'\u001b[39m\napps/web test: }\napps/web test:  \u001b[32m✓\u001b[39m tests/api/club/analyze.test.ts \u001b[2m(\u001b[22m\u001b[2m11 tests\u001b[22m\u001b[2m)\u001b[22m\u001b[33m 364\u001b[2mms\u001b[22m\u001b[39m\napps/web test: \u001b[90mstderr\u001b[2m | tests/api/usage-route.test.ts\u001b[2m > \u001b[22m\u001b[2mGET /api/usage\u001b[2m > \u001b[22m\u001b[2mError handling\u001b[2m > \u001b[22m\u001b[2mshould handle errors from getMockUsageData gracefully\napps/web test: \u001b[22m\u001b[39mUsage API error: Error: Mock error\napps/web test:     at \u001b[90m/opt/slimy/slimy-monorepo/apps/web/\u001b[39mtests/api/usage-route.test.ts:82:15\napps/web test:     at Mock (file:///opt/slimy/slimy-monorepo/node_modules/\u001b[4m.pnpm\u001b[24m/@vitest+spy@4.0.15/node_modules/\u001b[4m@vitest/spy\u001b[24m/dist/index.js:285:34)\napps/web test:     at Module.GET \u001b[90m(/opt/slimy/slimy-monorepo/apps/web/\u001b[39mapp/api/usage/route.ts:19:23\u001b[90m)\u001b[39m\napps/web test:     at \u001b[90m/opt/slimy/slimy-monorepo/apps/web/\u001b[39mtests/api/usage-route.test.ts:85:30\napps/web test:     at file:///opt/slimy/slimy-monorepo/node_modules/\u001b[4m.pnpm\u001b[24m/@vitest+runner@4.0.15/node_modules/\u001b[4m@vitest/runner\u001b[24m/dist/index.js:145:11\napps/web test:     at file:///opt/slimy/slimy-monorepo/node_modules/\u001b[4m.pnpm\u001b[24m/@vitest+runner@4.0.15/node_modules/\u001b[4m@vitest/runner\u001b[24m/dist/index.js:915:26\napps/web test:     at file:///opt/slimy/slimy-monorepo/node_modules/\u001b[4m.pnpm\u001b[24m/@vitest+runner@4.0.15/node_modules/\u001b[4m@vitest/runner\u001b[24m/dist/index.js:1240:20\napps/web test:     at new Promise (<anonymous>)\napps/web test:     at runWithTimeout (file:///opt/slimy/slimy-monorepo/node_modules/\u001b[4m.pnpm\u001b[24m/@vitest+runner@4.0.15/node_modules/\u001b[4m@vitest/runner\u001b[24m/dist/index.js:1206:10)\napps/web test:     at file:///opt/slimy/slimy-monorepo/node_modules/\u001b[4m.pnpm\u001b[24m/@vitest+runner@4.0.15/node_modules/\u001b[4m@vitest/runner\u001b[24m/dist/index.js:1650:37\napps/web test: \u001b[90mstderr\u001b[2m | tests/api/usage-route.test.ts\u001b[2m > \u001b[22m\u001b[2mGET /api/usage\u001b[2m > \u001b[22m\u001b[2mError handling\u001b[2m > \u001b[22m\u001b[2mshould return error response with correct structure\napps/web test: \u001b[22m\u001b[39mUsage API error: Error: Test error\napps/web test:     at \u001b[90m/opt/slimy/slimy-monorepo/apps/web/\u001b[39mtests/api/usage-route.test.ts:116:15\napps/web test:     at Mock (file:///opt/slimy/slimy-monorepo/node_modules/\u001b[4m.pnpm\u001b[24m/@vitest+spy@4.0.15/node_modules/\u001b[4m@vitest/spy\u001b[24m/dist/index.js:285:34)\napps/web test:     at Module.GET \u001b[90m(/opt/slimy/slimy-monorepo/apps/web/\u001b[39mapp/api/usage/route.ts:19:23\u001b[90m)\u001b[39m\napps/web test:     at \u001b[90m/opt/slimy/slimy-monorepo/apps/web/\u001b[39mtests/api/usage-route.test.ts:119:30\napps/web test:     at file:///opt/slimy/slimy-monorepo/node_modules/\u001b[4m.pnpm\u001b[24m/@vitest+runner@4.0.15/node_modules/\u001b[4m@vitest/runner\u001b[24m/dist/index.js:145:11\napps/web test:     at file:///opt/slimy/slimy-monorepo/node_modules/\u001b[4m.pnpm\u001b[24m/@vitest+runner@4.0.15/node_modules/\u001b[4m@vitest/runner\u001b[24m/dist/index.js:915:26\napps/web test:     at file:///opt/slimy/slimy-monorepo/node_modules/\u001b[4m.pnpm\u001b[24m/@vitest+runner@4.0.15/node_modules/\u001b[4m@vitest/runner\u001b[24m/dist/index.js:1240:20\napps/web test:     at new Promise (<anonymous>)\napps/web test:     at runWithTimeout (file:///opt/slimy/slimy-monorepo/node_modules/\u001b[4m.pnpm\u001b[24m/@vitest+runner@4.0.15/node_modules/\u001b[4m@vitest/runner\u001b[24m/dist/index.js:1206:10)\napps/web test:     at file:///opt/slimy/slimy-monorepo/node_modules/\u001b[4m.pnpm\u001b[24m/@vitest+runner@4.0.15/node_modules/\u001b[4m@vitest/runner\u001b[24m/dist/index.js:1650:37\napps/web test:  \u001b[32m✓\u001b[39m tests/api/usage-route.test.ts \u001b[2m(\u001b[22m\u001b[2m14 tests\u001b[22m\u001b[2m)\u001b[22m\u001b[32m 170\u001b[2mms\u001b[22m\u001b[39m\napps/web test: \u001b[90mstderr\u001b[2m | tests/unit/club/vision.test.ts\u001b[2m > \u001b[22m\u001b[2mClub Vision Library\u001b[2m > \u001b[22m\u001b[2manalyzeClubScreenshot\u001b[2m > \u001b[22m\u001b[2mshould handle API errors gracefully\napps/web test: \u001b[22m\u001b[39mError analyzing club screenshot: Error: API Error\napps/web test:     at \u001b[90m/opt/slimy/slimy-monorepo/apps/web/\u001b[39mtests/unit/club/vision.test.ts:109:60\napps/web test:     at file:///opt/slimy/slimy-monorepo/node_modules/\u001b[4m.pnpm\u001b[24m/@vitest+runner@4.0.15/node_modules/\u001b[4m@vitest/runner\u001b[24m/dist/index.js:145:11\napps/web test:     at file:///opt/slimy/slimy-monorepo/node_modules/\u001b[4m.pnpm\u001b[24m/@vitest+runner@4.0.15/node_modules/\u001b[4m@vitest/runner\u001b[24m/dist/index.js:915:26\napps/web test:     at file:///opt/slimy/slimy-monorepo/node_modules/\u001b[4m.pnpm\u001b[24m/@vitest+runner@4.0.15/node_modules/\u001b[4m@vitest/runner\u001b[24m/dist/index.js:1240:20\napps/web test:     at new Promise (<anonymous>)\napps/web test:     at runWithTimeout (file:///opt/slimy/slimy-monorepo/node_modules/\u001b[4m.pnpm\u001b[24m/@vitest+runner@4.0.15/node_modules/\u001b[4m@vitest/runner\u001b[24m/dist/index.js:1206:10)\napps/web test:     at file:///opt/slimy/slimy-monorepo/node_modules/\u001b[4m.pnpm\u001b[24m/@vitest+runner@4.0.15/node_modules/\u001b[4m@vitest/runner\u001b[24m/dist/index.js:1650:37\napps/web test:     at Traces.$ (file:///opt/slimy/slimy-monorepo/node_modules/\u001b[4m.pnpm\u001b[24m/vitest@4.0.15_@opentelemetry+api@1.9.0_@types+node@20.19.25_@vitest+ui@4.0.15_jiti@2.6._6f4799287cc307d0b976628207bcb6be/node_modules/\u001b[4mvitest\u001b[24m/dist/chunks/traces.U4xDYhzZ.js:115:27)\napps/web test:     at trace (file:///opt/slimy/slimy-monorepo/node_modules/\u001b[4m.pnpm\u001b[24m/vitest@4.0.15_@opentelemetry+api@1.9.0_@types+node@20.19.25_@vitest+ui@4.0.15_jiti@2.6._6f4799287cc307d0b976628207bcb6be/node_modules/\u001b[4mvitest\u001b[24m/dist/chunks/test.BT8LKgU9.js:239:21)\napps/web test:     at runTest (file:///opt/slimy/slimy-monorepo/node_modules/\u001b[4m.pnpm\u001b[24m/@vitest+runner@4.0.15/node_modules/\u001b[4m@vitest/runner\u001b[24m/dist/index.js:1650:12)\napps/web test: \u001b[90mstderr\u001b[2m | tests/unit/club/vision.test.ts\u001b[2m > \u001b[22m\u001b[2mClub Vision Library\u001b[2m > \u001b[22m\u001b[2manalyzeClubScreenshot\u001b[2m > \u001b[22m\u001b[2mshould handle invalid JSON response\napps/web test: \u001b[22m\u001b[39mError analyzing club screenshot: SyntaxError: Unexpected token 'I', \"Invalid JS\"... is not valid JSON\napps/web test:     at JSON.parse (<anonymous>)\napps/web test:     at Module.analyzeClubScreenshot \u001b[90m(/opt/slimy/slimy-monorepo/apps/web/\u001b[39mlib/club/vision.ts:90:33\u001b[90m)\u001b[39m\napps/web test: \u001b[90m    at processTicksAndRejections (node:internal/process/task_queues:95:5)\u001b[39m\napps/web test: \u001b[90mstderr\u001b[2m | tests/unit/club/vision.test.ts\u001b[2m > \u001b[22m\u001b[2mClub Vision Library\u001b[2m > \u001b[22m\u001b[2manalyzeClubScreenshot\u001b[2m > \u001b[22m\u001b[2mshould handle empty response\napps/web test: \u001b[22m\u001b[39mError analyzing club screenshot: Error: No response content from GPT-4 Vision\napps/web test:     at Module.analyzeClubScreenshot \u001b[90m(/opt/slimy/slimy-monorepo/apps/web/\u001b[39mlib/club/vision.ts:87:13\u001b[90m)\u001b[39m\napps/web test: \u001b[90m    at processTicksAndRejections (node:internal/process/task_queues:95:5)\u001b[39m\napps/web test: \u001b[90mstderr\u001b[2m | tests/api/club/upload.test.ts\u001b[2m > \u001b[22m\u001b[2m/api/club/upload\u001b[2m > \u001b[22m\u001b[2mshould return 400 when no screenshots provided\napps/web test: \u001b[22m\u001b[39mError occurred: {\napps/web test:   name: \u001b[32m'ValidationError'\u001b[39m,\napps/web test:   code: \u001b[32m'VALIDATION_ERROR'\u001b[39m,\napps/web test:   message: \u001b[32m'No screenshots provided'\u001b[39m,\napps/web test:   statusCode: \u001b[33m400\u001b[39m,\napps/web test:   details: \u001b[90mundefined\u001b[39m,\napps/web test:   stack: \u001b[32m'ValidationError: No screenshots provided\\n'\u001b[39m +\napps/web test:     \u001b[32m'    at Module.POST (/opt/slimy/slimy-monorepo/apps/web/app/api/club/upload/route.ts:23:13)\\n'\u001b[39m +\napps/web test:     \u001b[32m'    at processTicksAndRejections (node:internal/process/task_queues:95:5)\\n'\u001b[39m +\napps/web test:     \u001b[32m'    at /opt/slimy/slimy-monorepo/apps/web/tests/api/club/upload.test.ts:123:22\\n'\u001b[39m +\napps/web test:     \u001b[32m'    at file:///opt/slimy/slimy-monorepo/node_modules/.pnpm/@vitest+runner@4.0.15/node_modules/@vitest/runner/dist/index.js:915:20'\u001b[39m,\napps/web test:   context: \u001b[90mundefined\u001b[39m,\napps/web test:   timestamp: \u001b[32m'2026-01-02T21:54:50.896Z'\u001b[39m\napps/web test: }\napps/web test: \u001b[90mstderr\u001b[2m | tests/unit/club/vision.test.ts\u001b[2m > \u001b[22m\u001b[2mClub Vision Library\u001b[2m > \u001b[22m\u001b[2manalyzeClubScreenshots\u001b[2m > \u001b[22m\u001b[2mshould handle partial failures gracefully\napps/web test: \u001b[22m\u001b[39mError analyzing club screenshot: Error: API Error\napps/web test:     at \u001b[90m/opt/slimy/slimy-monorepo/apps/web/\u001b[39mtests/unit/club/vision.test.ts:189:32\napps/web test:     at file:///opt/slimy/slimy-monorepo/node_modules/\u001b[4m.pnpm\u001b[24m/@vitest+runner@4.0.15/node_modules/\u001b[4m@vitest/runner\u001b[24m/dist/index.js:145:11\napps/web test:     at file:///opt/slimy/slimy-monorepo/node_modules/\u001b[4m.pnpm\u001b[24m/@vitest+runner@4.0.15/node_modules/\u001b[4m@vitest/runner\u001b[24m/dist/index.js:915:26\napps/web test:     at file:///opt/slimy/slimy-monorepo/node_modules/\u001b[4m.pnpm\u001b[24m/@vitest+runner@4.0.15/node_modules/\u001b[4m@vitest/runner\u001b[24m/dist/index.js:1240:20\napps/web test:     at new Promise (<anonymous>)\napps/web test:     at runWithTimeout (file:///opt/slimy/slimy-monorepo/node_modules/\u001b[4m.pnpm\u001b[24m/@vitest+runner@4.0.15/node_modules/\u001b[4m@vitest/runner\u001b[24m/dist/index.js:1206:10)\napps/web test:     at file:///opt/slimy/slimy-monorepo/node_modules/\u001b[4m.pnpm\u001b[24m/@vitest+runner@4.0.15/node_modules/\u001b[4m@vitest/runner\u001b[24m/dist/index.js:1650:37\napps/web test:     at Traces.$ (file:///opt/slimy/slimy-monorepo/node_modules/\u001b[4m.pnpm\u001b[24m/vitest@4.0.15_@opentelemetry+api@1.9.0_@types+node@20.19.25_@vitest+ui@4.0.15_jiti@2.6._6f4799287cc307d0b976628207bcb6be/node_modules/\u001b[4mvitest\u001b[24m/dist/chunks/traces.U4xDYhzZ.js:115:27)\napps/web test:     at trace (file:///opt/slimy/slimy-monorepo/node_modules/\u001b[4m.pnpm\u001b[24m/vitest@4.0.15_@opentelemetry+api@1.9.0_@types+node@20.19.25_@vitest+ui@4.0.15_jiti@2.6._6f4799287cc307d0b976628207bcb6be/node_modules/\u001b[4mvitest\u001b[24m/dist/chunks/test.BT8LKgU9.js:239:21)\napps/web test:     at runTest (file:///opt/slimy/slimy-monorepo/node_modules/\u001b[4m.pnpm\u001b[24m/@vitest+runner@4.0.15/node_modules/\u001b[4m@vitest/runner\u001b[24m/dist/index.js:1650:12)\napps/web test: \u001b[90mstderr\u001b[2m | tests/api/club/upload.test.ts\u001b[2m > \u001b[22m\u001b[2m/api/club/upload\u001b[2m > \u001b[22m\u001b[2mshould return 400 when no guildId provided\napps/web test: \u001b[22m\u001b[39mError occurred: {\napps/web test:   name: \u001b[32m'ValidationError'\u001b[39m,\napps/web test:   code: \u001b[32m'VALIDATION_ERROR'\u001b[39m,\napps/web test:   message: \u001b[32m'Guild ID is required'\u001b[39m,\napps/web test:   statusCode: \u001b[33m400\u001b[39m,\napps/web test:   details: \u001b[90mundefined\u001b[39m,\napps/web test:   stack: \u001b[32m'ValidationError: Guild ID is required\\n'\u001b[39m +\napps/web test:     \u001b[32m'    at Module.POST (/opt/slimy/slimy-monorepo/apps/web/app/api/club/upload/route.ts:27:13)\\n'\u001b[39m +\napps/web test:     \u001b[32m'    at processTicksAndRejections (node:internal/process/task_queues:95:5)\\n'\u001b[39m +\napps/web test:     \u001b[32m'    at /opt/slimy/slimy-monorepo/apps/web/tests/api/club/upload.test.ts:142:22\\n'\u001b[39m +\napps/web test:     \u001b[32m'    at file:///opt/slimy/slimy-monorepo/node_modules/.pnpm/@vitest+runner@4.0.15/node_modules/@vitest/runner/dist/index.js:915:20'\u001b[39m,\napps/web test:   context: \u001b[90mundefined\u001b[39m,\napps/web test:   timestamp: \u001b[32m'2026-01-02T21:54:50.932Z'\u001b[39m\napps/web test: }\napps/web test: \u001b[90mstderr\u001b[2m | tests/unit/club/vision.test.ts\u001b[2m > \u001b[22m\u001b[2mClub Vision Library\u001b[2m > \u001b[22m\u001b[2manalyzeClubScreenshots\u001b[2m > \u001b[22m\u001b[2mshould handle partial failures gracefully\napps/web test: \u001b[22m\u001b[39mFailed to analyze http://example.com/image2.png: Error: Failed to analyze screenshot: API Error\napps/web test:     at analyzeClubScreenshot \u001b[90m(/opt/slimy/slimy-monorepo/apps/web/\u001b[39mlib/club/vision.ts:107:11\u001b[90m)\u001b[39m\napps/web test: \u001b[90m    at processTicksAndRejections (node:internal/process/task_queues:95:5)\u001b[39m\napps/web test:     at Module.analyzeClubScreenshots \u001b[90m(/opt/slimy/slimy-monorepo/apps/web/\u001b[39mlib/club/vision.ts:123:22\u001b[90m)\u001b[39m\napps/web test:     at \u001b[90m/opt/slimy/slimy-monorepo/apps/web/\u001b[39mtests/unit/club/vision.test.ts:192:23\napps/web test:     at file:///opt/slimy/slimy-monorepo/node_modules/\u001b[4m.pnpm\u001b[24m/@vitest+runner@4.0.15/node_modules/\u001b[4m@vitest/runner\u001b[24m/dist/index.js:915:20\napps/web test: \u001b[90mstderr\u001b[2m | tests/unit/club/vision.test.ts\u001b[2m > \u001b[22m\u001b[2mClub Vision Library\u001b[2m > \u001b[22m\u001b[2mvalidateImageUrl\u001b[2m > \u001b[22m\u001b[2mshould return false when fetch fails\napps/web test: \u001b[22m\u001b[39mError validating image URL: Error: Network error\napps/web test:     at \u001b[90m/opt/slimy/slimy-monorepo/apps/web/\u001b[39mtests/unit/club/vision.test.ts:223:49\napps/web test:     at Mock (file:///opt/slimy/slimy-monorepo/node_modules/\u001b[4m.pnpm\u001b[24m/@vitest+spy@4.0.15/node_modules/\u001b[4m@vitest/spy\u001b[24m/dist/index.js:285:34)\napps/web test:     at Module.validateImageUrl \u001b[90m(/opt/slimy/slimy-monorepo/apps/web/\u001b[39mlib/club/vision.ts:140:28\u001b[90m)\u001b[39m\napps/web test:     at \u001b[90m/opt/slimy/slimy-monorepo/apps/web/\u001b[39mtests/unit/club/vision.test.ts:225:28\napps/web test:     at file:///opt/slimy/slimy-monorepo/node_modules/\u001b[4m.pnpm\u001b[24m/@vitest+runner@4.0.15/node_modules/\u001b[4m@vitest/runner\u001b[24m/dist/index.js:145:11\napps/web test:     at file:///opt/slimy/slimy-monorepo/node_modules/\u001b[4m.pnpm\u001b[24m/@vitest+runner@4.0.15/node_modules/\u001b[4m@vitest/runner\u001b[24m/dist/index.js:915:26\napps/web test:     at file:///opt/slimy/slimy-monorepo/node_modules/\u001b[4m.pnpm\u001b[24m/@vitest+runner@4.0.15/node_modules/\u001b[4m@vitest/runner\u001b[24m/dist/index.js:1240:20\napps/web test:     at new Promise (<anonymous>)\napps/web test:     at runWithTimeout (file:///opt/slimy/slimy-monorepo/node_modules/\u001b[4m.pnpm\u001b[24m/@vitest+runner@4.0.15/node_modules/\u001b[4m@vitest/runner\u001b[24m/dist/index.js:1206:10)\napps/web test:     at file:///opt/slimy/slimy-monorepo/node_modules/\u001b[4m.pnpm\u001b[24m/@vitest+runner@4.0.15/node_modules/\u001b[4m@vitest/runner\u001b[24m/dist/index.js:1650:37\napps/web test:  \u001b[32m✓\u001b[39m tests/unit/club/vision.test.ts \u001b[2m(\u001b[22m\u001b[2m13 tests\u001b[22m\u001b[2m)\u001b[22m\u001b[32m 155\u001b[2mms\u001b[22m\u001b[39m\napps/web test: \u001b[90mstderr\u001b[2m | tests/api/club/upload.test.ts\u001b[2m > \u001b[22m\u001b[2m/api/club/upload\u001b[2m > \u001b[22m\u001b[2mshould handle file upload errors gracefully\napps/web test: \u001b[22m\u001b[39mError occurred: {\napps/web test:   name: \u001b[32m'AppError'\u001b[39m,\napps/web test:   code: \u001b[32m'INTERNAL_ERROR'\u001b[39m,\napps/web test:   message: \u001b[32m'Disk full'\u001b[39m,\napps/web test:   statusCode: \u001b[33m500\u001b[39m,\napps/web test:   details: { originalError: \u001b[32m'Error'\u001b[39m },\napps/web test:   stack: \u001b[32m'AppError: Disk full\\n'\u001b[39m +\napps/web test:     \u001b[32m'    at toAppError (/opt/slimy/slimy-monorepo/apps/web/lib/errors.ts:147:12)\\n'\u001b[39m +\napps/web test:     \u001b[32m'    at errorResponse (/opt/slimy/slimy-monorepo/apps/web/lib/errors.ts:186:20)\\n'\u001b[39m +\napps/web test:     \u001b[32m'    at Module.POST (/opt/slimy/slimy-monorepo/apps/web/app/api/club/upload/route.ts:128:39)\\n'\u001b[39m +\napps/web test:     \u001b[32m'    at processTicksAndRejections (node:internal/process/task_queues:95:5)\\n'\u001b[39m +\napps/web test:     \u001b[32m'    at /opt/slimy/slimy-monorepo/apps/web/tests/api/club/upload.test.ts:228:22\\n'\u001b[39m +\napps/web test:     \u001b[32m'    at file:///opt/slimy/slimy-monorepo/node_modules/.pnpm/@vitest+runner@4.0.15/node_modules/@vitest/runner/dist/index.js:915:20'\u001b[39m,\napps/web test:   context: \u001b[90mundefined\u001b[39m,\napps/web test:   timestamp: \u001b[32m'2026-01-02T21:54:51.006Z'\u001b[39m\napps/web test: }\napps/web test: \u001b[90mstderr\u001b[2m | tests/api/club/upload.test.ts\u001b[2m > \u001b[22m\u001b[2m/api/club/upload\u001b[2m > \u001b[22m\u001b[2mshould continue upload even if analysis fails\napps/web test: \u001b[22m\u001b[39mAnalysis failed: Error: Analysis failed\napps/web test:     at \u001b[90m/opt/slimy/slimy-monorepo/apps/web/\u001b[39mtests/api/club/upload.test.ts:243:55\napps/web test:     at file:///opt/slimy/slimy-monorepo/node_modules/\u001b[4m.pnpm\u001b[24m/@vitest+runner@4.0.15/node_modules/\u001b[4m@vitest/runner\u001b[24m/dist/index.js:145:11\napps/web test:     at file:///opt/slimy/slimy-monorepo/node_modules/\u001b[4m.pnpm\u001b[24m/@vitest+runner@4.0.15/node_modules/\u001b[4m@vitest/runner\u001b[24m/dist/index.js:915:26\napps/web test:     at file:///opt/slimy/slimy-monorepo/node_modules/\u001b[4m.pnpm\u001b[24m/@vitest+runner@4.0.15/node_modules/\u001b[4m@vitest/runner\u001b[24m/dist/index.js:1240:20\napps/web test:     at new Promise (<anonymous>)\napps/web test:     at runWithTimeout (file:///opt/slimy/slimy-monorepo/node_modules/\u001b[4m.pnpm\u001b[24m/@vitest+runner@4.0.15/node_modules/\u001b[4m@vitest/runner\u001b[24m/dist/index.js:1206:10)\napps/web test:     at file:///opt/slimy/slimy-monorepo/node_modules/\u001b[4m.pnpm\u001b[24m/@vitest+runner@4.0.15/node_modules/\u001b[4m@vitest/runner\u001b[24m/dist/index.js:1650:37\napps/web test:     at Traces.$ (file:///opt/slimy/slimy-monorepo/node_modules/\u001b[4m.pnpm\u001b[24m/vitest@4.0.15_@opentelemetry+api@1.9.0_@types+node@20.19.25_@vitest+ui@4.0.15_jiti@2.6._6f4799287cc307d0b976628207bcb6be/node_modules/\u001b[4mvitest\u001b[24m/dist/chunks/traces.U4xDYhzZ.js:115:27)\napps/web test:     at trace (file:///opt/slimy/slimy-monorepo/node_modules/\u001b[4m.pnpm\u001b[24m/vitest@4.0.15_@opentelemetry+api@1.9.0_@types+node@20.19.25_@vitest+ui@4.0.15_jiti@2.6._6f4799287cc307d0b976628207bcb6be/node_modules/\u001b[4mvitest\u001b[24m/dist/chunks/test.BT8LKgU9.js:239:21)\napps/web test:     at runTest (file:///opt/slimy/slimy-monorepo/node_modules/\u001b[4m.pnpm\u001b[24m/@vitest+runner@4.0.15/node_modules/\u001b[4m@vitest/runner\u001b[24m/dist/index.js:1650:12)\napps/web test:  \u001b[32m✓\u001b[39m tests/api/club/upload.test.ts \u001b[2m(\u001b[22m\u001b[2m6 tests\u001b[22m\u001b[2m)\u001b[22m\u001b[32m 167\u001b[2mms\u001b[22m\u001b[39m\napps/web test: \u001b[90mstderr\u001b[2m | tests/api/usage.test.ts\u001b[2m > \u001b[22m\u001b[2mUsage API Client\u001b[2m > \u001b[22m\u001b[2mfetchUsageDataSafe\u001b[2m > \u001b[22m\u001b[2mshould return null on error (default fallback)\napps/web test: \u001b[22m\u001b[39mFailed to fetch usage data: UsageApiError: Network error\napps/web test:     at fetchUsageData \u001b[90m(/opt/slimy/slimy-monorepo/apps/web/\u001b[39mlib/api/usage.ts:108:11\u001b[90m)\u001b[39m\napps/web test: \u001b[90m    at processTicksAndRejections (node:internal/process/task_queues:95:5)\u001b[39m\napps/web test:     at fetchUsageDataSafe \u001b[90m(/opt/slimy/slimy-monorepo/apps/web/\u001b[39mlib/api/usage.ts:126:12\u001b[90m)\u001b[39m\napps/web test:     at \u001b[90m/opt/slimy/slimy-monorepo/apps/web/\u001b[39mtests/api/usage.test.ts:345:22\napps/web test:     at file:///opt/slimy/slimy-monorepo/node_modules/\u001b[4m.pnpm\u001b[24m/@vitest+runner@4.0.15/node_modules/\u001b[4m@vitest/runner\u001b[24m/dist/index.js:915:20 {\napps/web test:   code: \u001b[32m'UNKNOWN_ERROR'\u001b[39m,\napps/web test:   status: \u001b[90mundefined\u001b[39m\napps/web test: }\napps/web test: \u001b[90mstderr\u001b[2m | tests/api/usage.test.ts\u001b[2m > \u001b[22m\u001b[2mUsage API Client\u001b[2m > \u001b[22m\u001b[2mfetchUsageDataSafe\u001b[2m > \u001b[22m\u001b[2mshould return custom fallback on error\napps/web test: \u001b[22m\u001b[39mFailed to fetch usage data: UsageApiError: Network error\napps/web test:     at fetchUsageData \u001b[90m(/opt/slimy/slimy-monorepo/apps/web/\u001b[39mlib/api/usage.ts:108:11\u001b[90m)\u001b[39m\napps/web test: \u001b[90m    at processTicksAndRejections (node:internal/process/task_queues:95:5)\u001b[39m\napps/web test:     at fetchUsageDataSafe \u001b[90m(/opt/slimy/slimy-monorepo/apps/web/\u001b[39mlib/api/usage.ts:126:12\u001b[90m)\u001b[39m\napps/web test:     at \u001b[90m/opt/slimy/slimy-monorepo/apps/web/\u001b[39mtests/api/usage.test.ts:359:22\napps/web test:     at file:///opt/slimy/slimy-monorepo/node_modules/\u001b[4m.pnpm\u001b[24m/@vitest+runner@4.0.15/node_modules/\u001b[4m@vitest/runner\u001b[24m/dist/index.js:915:20 {\napps/web test:   code: \u001b[32m'UNKNOWN_ERROR'\u001b[39m,\napps/web test:   status: \u001b[90mundefined\u001b[39m\napps/web test: }\napps/web test:  \u001b[32m✓\u001b[39m tests/api/usage.test.ts \u001b[2m(\u001b[22m\u001b[2m25 tests\u001b[22m\u001b[2m)\u001b[22m\u001b[32m 120\u001b[2mms\u001b[22m\u001b[39m\napps/web test:  \u001b[32m✓\u001b[39m tests/api/screenshot/route.test.ts \u001b[2m(\u001b[22m\u001b[2m11 tests\u001b[22m\u001b[2m)\u001b[22m\u001b[32m 55\u001b[2mms\u001b[22m\u001b[39m\napps/web test: \u001b[90mstderr\u001b[2m | tests/unit/screenshot/analyzer.test.ts\u001b[2m > \u001b[22m\u001b[2mScreenshot Analyzer\u001b[2m > \u001b[22m\u001b[2manalyzeScreenshot\u001b[2m > \u001b[22m\u001b[2mshould handle API errors gracefully\napps/web test: \u001b[22m\u001b[39mError analyzing screenshot: Error: API Error\napps/web test:     at \u001b[90m/opt/slimy/slimy-monorepo/apps/web/\u001b[39mtests/unit/screenshot/analyzer.test.ts:134:60\napps/web test:     at file:///opt/slimy/slimy-monorepo/node_modules/\u001b[4m.pnpm\u001b[24m/@vitest+runner@4.0.15/node_modules/\u001b[4m@vitest/runner\u001b[24m/dist/index.js:145:11\napps/web test:     at file:///opt/slimy/slimy-monorepo/node_modules/\u001b[4m.pnpm\u001b[24m/@vitest+runner@4.0.15/node_modules/\u001b[4m@vitest/runner\u001b[24m/dist/index.js:915:26\napps/web test:     at file:///opt/slimy/slimy-monorepo/node_modules/\u001b[4m.pnpm\u001b[24m/@vitest+runner@4.0.15/node_modules/\u001b[4m@vitest/runner\u001b[24m/dist/index.js:1240:20\napps/web test:     at new Promise (<anonymous>)\napps/web test:     at runWithTimeout (file:///opt/slimy/slimy-monorepo/node_modules/\u001b[4m.pnpm\u001b[24m/@vitest+runner@4.0.15/node_modules/\u001b[4m@vitest/runner\u001b[24m/dist/index.js:1206:10)\napps/web test:     at file:///opt/slimy/slimy-monorepo/node_modules/\u001b[4m.pnpm\u001b[24m/@vitest+runner@4.0.15/node_modules/\u001b[4m@vitest/runner\u001b[24m/dist/index.js:1650:37\napps/web test:     at Traces.$ (file:///opt/slimy/slimy-monorepo/node_modules/\u001b[4m.pnpm\u001b[24m/vitest@4.0.15_@opentelemetry+api@1.9.0_@types+node@20.19.25_@vitest+ui@4.0.15_jiti@2.6._6f4799287cc307d0b976628207bcb6be/node_modules/\u001b[4mvitest\u001b[24m/dist/chunks/traces.U4xDYhzZ.js:115:27)\napps/web test:     at trace (file:///opt/slimy/slimy-monorepo/node_modules/\u001b[4m.pnpm\u001b[24m/vitest@4.0.15_@opentelemetry+api@1.9.0_@types+node@20.19.25_@vitest+ui@4.0.15_jiti@2.6._6f4799287cc307d0b976628207bcb6be/node_modules/\u001b[4mvitest\u001b[24m/dist/chunks/test.BT8LKgU9.js:239:21)\napps/web test:     at runTest (file:///opt/slimy/slimy-monorepo/node_modules/\u001b[4m.pnpm\u001b[24m/@vitest+runner@4.0.15/node_modules/\u001b[4m@vitest/runner\u001b[24m/dist/index.js:1650:12)\napps/web test: \u001b[90mstderr\u001b[2m | tests/unit/screenshot/analyzer.test.ts\u001b[2m > \u001b[22m\u001b[2mScreenshot Analyzer\u001b[2m > \u001b[22m\u001b[2manalyzeScreenshots\u001b[2m > \u001b[22m\u001b[2mshould handle partial failures\napps/web test: \u001b[22m\u001b[39mError analyzing screenshot: Error: API Error\napps/web test:     at \u001b[90m/opt/slimy/slimy-monorepo/apps/web/\u001b[39mtests/unit/screenshot/analyzer.test.ts:190:32\napps/web test:     at file:///opt/slimy/slimy-monorepo/node_modules/\u001b[4m.pnpm\u001b[24m/@vitest+runner@4.0.15/node_modules/\u001b[4m@vitest/runner\u001b[24m/dist/index.js:145:11\napps/web test:     at file:///opt/slimy/slimy-monorepo/node_modules/\u001b[4m.pnpm\u001b[24m/@vitest+runner@4.0.15/node_modules/\u001b[4m@vitest/runner\u001b[24m/dist/index.js:915:26\napps/web test:     at file:///opt/slimy/slimy-monorepo/node_modules/\u001b[4m.pnpm\u001b[24m/@vitest+runner@4.0.15/node_modules/\u001b[4m@vitest/runner\u001b[24m/dist/index.js:1240:20\napps/web test:     at new Promise (<anonymous>)\napps/web test:     at runWithTimeout (file:///opt/slimy/slimy-monorepo/node_modules/\u001b[4m.pnpm\u001b[24m/@vitest+runner@4.0.15/node_modules/\u001b[4m@vitest/runner\u001b[24m/dist/index.js:1206:10)\napps/web test:     at file:///opt/slimy/slimy-monorepo/node_modules/\u001b[4m.pnpm\u001b[24m/@vitest+runner@4.0.15/node_modules/\u001b[4m@vitest/runner\u001b[24m/dist/index.js:1650:37\napps/web test:     at Traces.$ (file:///opt/slimy/slimy-monorepo/node_modules/\u001b[4m.pnpm\u001b[24m/vitest@4.0.15_@opentelemetry+api@1.9.0_@types+node@20.19.25_@vitest+ui@4.0.15_jiti@2.6._6f4799287cc307d0b976628207bcb6be/node_modules/\u001b[4mvitest\u001b[24m/dist/chunks/traces.U4xDYhzZ.js:115:27)\napps/web test:     at trace (file:///opt/slimy/slimy-monorepo/node_modules/\u001b[4m.pnpm\u001b[24m/vitest@4.0.15_@opentelemetry+api@1.9.0_@types+node@20.19.25_@vitest+ui@4.0.15_jiti@2.6._6f4799287cc307d0b976628207bcb6be/node_modules/\u001b[4mvitest\u001b[24m/dist/chunks/test.BT8LKgU9.js:239:21)\napps/web test:     at runTest (file:///opt/slimy/slimy-monorepo/node_modules/\u001b[4m.pnpm\u001b[24m/@vitest+runner@4.0.15/node_modules/\u001b[4m@vitest/runner\u001b[24m/dist/index.js:1650:12)\napps/web test: \u001b[90mstderr\u001b[2m | tests/unit/screenshot/analyzer.test.ts\u001b[2m > \u001b[22m\u001b[2mScreenshot Analyzer\u001b[2m > \u001b[22m\u001b[2manalyzeScreenshots\u001b[2m > \u001b[22m\u001b[2mshould handle partial failures\napps/web test: \u001b[22m\u001b[39mFailed to analyze http://example.com/image2.png: Error: Failed to analyze screenshot: API Error\napps/web test:     at analyzeScreenshot \u001b[90m(/opt/slimy/slimy-monorepo/apps/web/\u001b[39mlib/screenshot/analyzer.ts:213:11\u001b[90m)\u001b[39m\napps/web test: \u001b[90m    at processTicksAndRejections (node:internal/process/task_queues:95:5)\u001b[39m\napps/web test:     at Module.analyzeScreenshots \u001b[90m(/opt/slimy/slimy-monorepo/apps/web/\u001b[39mlib/screenshot/analyzer.ts:229:22\u001b[90m)\u001b[39m\napps/web test:     at \u001b[90m/opt/slimy/slimy-monorepo/apps/web/\u001b[39mtests/unit/screenshot/analyzer.test.ts:193:23\napps/web test:     at file:///opt/slimy/slimy-monorepo/node_modules/\u001b[4m.pnpm\u001b[24m/@vitest+runner@4.0.15/node_modules/\u001b[4m@vitest/runner\u001b[24m/dist/index.js:915:20\napps/web test:  \u001b[32m✓\u001b[39m tests/unit/screenshot/analyzer.test.ts \u001b[2m(\u001b[22m\u001b[2m13 tests\u001b[22m\u001b[2m)\u001b[22m\u001b[32m 274\u001b[2mms\u001b[22m\u001b[39m\napps/web test: \u001b[90mstdout\u001b[2m | tests/unit/codes-aggregator.test.ts\u001b[2m > \u001b[22m\u001b[2mCodes Aggregator\u001b[2m > \u001b[22m\u001b[2mCodesAggregator\u001b[2m > \u001b[22m\u001b[2mshould aggregate codes from all sources\napps/web test: \u001b[22m\u001b[39mStarted auto-refresh for aggregated_codes every 300s\napps/web test: \u001b[90mstdout\u001b[2m | tests/unit/codes-aggregator.test.ts\u001b[2m > \u001b[22m\u001b[2mCodes Aggregator\u001b[2m > \u001b[22m\u001b[2mCodesAggregator\u001b[2m > \u001b[22m\u001b[2mshould handle source failures gracefully\napps/web test: \u001b[22m\u001b[39mStarted auto-refresh for aggregated_codes every 300s\napps/web test: \u001b[90mstdout\u001b[2m | tests/unit/codes-aggregator.test.ts\u001b[2m > \u001b[22m\u001b[2mCodes Aggregator\u001b[2m > \u001b[22m\u001b[2mCodesAggregator\u001b[2m > \u001b[22m\u001b[2mshould get health status\napps/web test: \u001b[22m\u001b[39mStarted auto-refresh for aggregated_codes every 300s\napps/web test: \u001b[90mstdout\u001b[2m | tests/unit/codes-aggregator.test.ts\u001b[2m > \u001b[22m\u001b[2mCodes Aggregator\u001b[2m > \u001b[22m\u001b[2mCodesAggregator\u001b[2m > \u001b[22m\u001b[2mshould deduplicate codes\napps/web test: \u001b[22m\u001b[39mStarted auto-refresh for aggregated_codes every 300s\napps/web test: \u001b[90mstdout\u001b[2m | tests/unit/codes-aggregator.test.ts\u001b[2m > \u001b[22m\u001b[2mCodes Aggregator\u001b[2m > \u001b[22m\u001b[2mgetAggregator\u001b[2m > \u001b[22m\u001b[2mshould return singleton instance\napps/web test: \u001b[22m\u001b[39mStarted auto-refresh for aggregated_codes every 300s\napps/web test:  \u001b[32m✓\u001b[39m tests/unit/codes-aggregator.test.ts \u001b[2m(\u001b[22m\u001b[2m14 tests\u001b[22m\u001b[2m)\u001b[22m\u001b[32m 103\u001b[2mms\u001b[22m\u001b[39m\napps/web test:  \u001b[32m✓\u001b[39m tests/unit/codes-deduplication.test.ts \u001b[2m(\u001b[22m\u001b[2m18 tests\u001b[22m\u001b[2m)\u001b[22m\u001b[32m 81\u001b[2mms\u001b[22m\u001b[39m\napps/web test:  \u001b[32m✓\u001b[39m tests/unit/lib/config.test.ts \u001b[2m(\u001b[22m\u001b[2m12 tests\u001b[22m\u001b[2m)\u001b[22m\u001b[32m 45\u001b[2mms\u001b[22m\u001b[39m\napps/web test:  \u001b[32m✓\u001b[39m tests/unit/lib/errors.test.ts \u001b[2m(\u001b[22m\u001b[2m18 tests\u001b[22m\u001b[2m)\u001b[22m\u001b[32m 63\u001b[2mms\u001b[22m\u001b[39m\napps/web test:  \u001b[32m✓\u001b[39m tests/api/diag.test.ts \u001b[2m(\u001b[22m\u001b[2m2 tests\u001b[22m\u001b[2m)\u001b[22m\u001b[32m 44\u001b[2mms\u001b[22m\u001b[39m\napps/web test:  \u001b[32m✓\u001b[39m tests/unit/stats-scrubber.test.ts \u001b[2m(\u001b[22m\u001b[2m1 test\u001b[22m\u001b[2m)\u001b[22m\u001b[32m 34\u001b[2mms\u001b[22m\u001b[39m\napps/web test:  \u001b[32m✓\u001b[39m tests/unit/rate-limiter.test.ts \u001b[2m(\u001b[22m\u001b[2m4 tests\u001b[22m\u001b[2m)\u001b[22m\u001b[32m 39\u001b[2mms\u001b[22m\u001b[39m\napps/web test:  \u001b[32m✓\u001b[39m tests/unit/lib/admin-client.test.ts \u001b[2m(\u001b[22m\u001b[2m1 test\u001b[22m\u001b[2m)\u001b[22m\u001b[32m 23\u001b[2mms\u001b[22m\u001b[39m\napps/web test:  \u001b[32m✓\u001b[39m tests/unit/snelp-source.test.ts \u001b[2m(\u001b[22m\u001b[2m2 tests\u001b[22m\u001b[2m)\u001b[22m\u001b[32m 28\u001b[2mms\u001b[22m\u001b[39m\napps/web test:  \u001b[32m✓\u001b[39m tests/unit/usage-thresholds.test.ts \u001b[2m(\u001b[22m\u001b[2m6 tests\u001b[22m\u001b[2m)\u001b[22m\u001b[32m 14\u001b[2mms\u001b[22m\u001b[39m\napps/web test:  \u001b[32m✓\u001b[39m tests/unit/role-mapping.test.ts \u001b[2m(\u001b[22m\u001b[2m5 tests\u001b[22m\u001b[2m)\u001b[22m\u001b[32m 7\u001b[2mms\u001b[22m\u001b[39m\napps/web test: \u001b[2m Test Files \u001b[22m \u001b[1m\u001b[32m25 passed\u001b[39m\u001b[22m\u001b[90m (25)\u001b[39m\napps/web test: \u001b[2m      Tests \u001b[22m \u001b[1m\u001b[32m267 passed\u001b[39m\u001b[22m\u001b[90m (267)\u001b[39m\napps/web test: \u001b[2m   Start at \u001b[22m 21:54:20\napps/web test: \u001b[2m   Duration \u001b[22m 50.58s\u001b[2m (transform 5.92s, setup 11.14s, import 19.73s, tests 17.22s, environment 76.41s)\u001b[22m\napps/web test: Done"
    },
    "docker": {
      "ok": true,
      "output": "NAME                   STATUS                PORTS\nslimy-monorepo-db-1    Up 5 days (healthy)   3306/tcp, 33060/tcp\nslimy-monorepo-web-1   Up 5 days             0.0.0.0:3000->3000/tcp, :::3000->3000/tcp",
      "skipped": false
    },
    "adminHealth": {
      "ok": true,
      "output": "{\"status\":\"ok\",\"uptime\":16007,\"timestamp\":\"2026-01-02T21:55:12.143Z\",\"version\":\"1.0.0\"}"
    },
    "socketIo": {
      "ok": true,
      "output": "0{\"sid\":\"00Ra77aGPJVHQRDNAAAr\",\"upgrades\":[\"websocket\"],\"pingInterval\":25000,\"pingTimeout\":20000,\"maxPayload\":1000000}"
    }
  },
  "stats": {
    "languages": {
      "__WARNING__": "tokei not installed or failed"
    },
    "folders": [
      {
        "path": "apps",
        "bytes": 494636007
      },
      {
        "path": "apps/web",
        "bytes": 238920351
      },
      {
        "path": "apps/admin-api",
        "bytes": 151347188
      },
      {
        "path": "apps/admin-ui",
        "bytes": 104243459
      },
      {
        "path": "docs",
        "bytes": 2368764
      },
      {
        "path": "scripts",
        "bytes": 317016
      },
      {
        "path": "apps/bot",
        "bytes": 125009
      },
      {
        "path": "packages",
        "bytes": 81103
      },
      {
        "path": "packages/contracts",
        "bytes": 38944
      },
      {
        "path": "infra",
        "bytes": 36273
      }
    ]
  },
  "delta": {
    "previousHead": "bfa1495",
    "previousBranch": "nuc2/verify-role-b33e616",
    "headChanged": true,
    "branchChanged": false,
    "testsChanged": false,
    "previousTestsOk": true
  },
  "pruned": {
    "host": "nuc2",
    "kept": 2,
    "deleted": []
  }
}